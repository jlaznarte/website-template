(function() {var require=("function"==typeof hypothesisRequire&&hypothesisRequire);(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
function parents(e,n){var o=[];n=n||noop;do{o.push(e),e=e.parentNode}while(e&&e.tagName&&n(e));return o.slice(1)}function noop(e){return!0}module.exports=parents;

},{}],2:[function(require,module,exports){
!function(){"use strict";var e={}.hasOwnProperty;function n(){for(var r=[],t=0;t<arguments.length;t++){var f=arguments[t];if(f){var o=typeof f;if("string"===o||"number"===o)r.push(f);else if(Array.isArray(f)&&f.length){var i=n.apply(null,f);i&&r.push(i)}else if("object"===o)for(var a in f)e.call(f,a)&&f[a]&&r.push(a)}}return r.join(" ")}"undefined"!=typeof module&&module.exports?(n.default=n,module.exports=n):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return n}):window.classNames=n}();

},{}],3:[function(require,module,exports){
(function (global){
var NativeCustomEvent=global.CustomEvent;function useNative(){try{var e=new NativeCustomEvent("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}module.exports=useNative()?NativeCustomEvent:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n};

}).call(this,window)

},{}],4:[function(require,module,exports){
function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(t,e,n,i){void 0===i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var h=i;if(null==t||null==e)throw new Error("Null input. (diff_main)");if(t==e)return t?[[DIFF_EQUAL,t]]:[];void 0===n&&(n=!0);var r=n,a=this.diff_commonPrefix(t,e),f=t.substring(0,a);t=t.substring(a),e=e.substring(a),a=this.diff_commonSuffix(t,e);var s=t.substring(t.length-a);t=t.substring(0,t.length-a),e=e.substring(0,e.length-a);var l=this.diff_compute_(t,e,r,h);return f&&l.unshift([DIFF_EQUAL,f]),s&&l.push([DIFF_EQUAL,s]),this.diff_cleanupMerge(l),l},diff_match_patch.prototype.diff_compute_=function(t,e,n,i){var h;if(!t)return[[DIFF_INSERT,e]];if(!e)return[[DIFF_DELETE,t]];var r=t.length>e.length?t:e,a=t.length>e.length?e:t,f=r.indexOf(a);if(-1!=f)return h=[[DIFF_INSERT,r.substring(0,f)],[DIFF_EQUAL,a],[DIFF_INSERT,r.substring(f+a.length)]],t.length>e.length&&(h[0][0]=h[2][0]=DIFF_DELETE),h;if(1==a.length)return[[DIFF_DELETE,t],[DIFF_INSERT,e]];var s=this.diff_halfMatch_(t,e);if(s){var l=s[0],_=s[1],c=s[2],g=s[3],o=s[4],p=this.diff_main(l,c,n,i),u=this.diff_main(_,g,n,i);return p.concat([[DIFF_EQUAL,o]],u)}return n&&t.length>100&&e.length>100?this.diff_lineMode_(t,e,i):this.diff_bisect_(t,e,i)},diff_match_patch.prototype.diff_lineMode_=function(t,e,n){t=(_=this.diff_linesToChars_(t,e)).chars1,e=_.chars2;var i=_.lineArray,h=this.diff_main(t,e,!1,n);this.diff_charsToLines_(h,i),this.diff_cleanupSemantic(h),h.push([DIFF_EQUAL,""]);for(var r=0,a=0,f=0,s="",l="";r<h.length;){switch(h[r][0]){case DIFF_INSERT:f++,l+=h[r][1];break;case DIFF_DELETE:a++,s+=h[r][1];break;case DIFF_EQUAL:if(a>=1&&f>=1){h.splice(r-a-f,a+f),r=r-a-f;for(var _,c=(_=this.diff_main(s,l,!1,n)).length-1;c>=0;c--)h.splice(r,0,_[c]);r+=_.length}f=0,a=0,s="",l=""}r++}return h.pop(),h},diff_match_patch.prototype.diff_bisect_=function(t,e,n){for(var i=t.length,h=e.length,r=Math.ceil((i+h)/2),a=r,f=2*r,s=new Array(f),l=new Array(f),_=0;_<f;_++)s[_]=-1,l[_]=-1;s[a+1]=0,l[a+1]=0;for(var c=i-h,g=c%2!=0,o=0,p=0,u=0,d=0,F=0;F<r&&!((new Date).getTime()>n);F++){for(var E=-F+o;E<=F-p;E+=2){for(var m=a+E,D=(T=E==-F||E!=F&&s[m-1]<s[m+1]?s[m+1]:s[m-1]+1)-E;T<i&&D<h&&t.charAt(T)==e.charAt(D);)T++,D++;if(s[m]=T,T>i)p+=2;else if(D>h)o+=2;else if(g){if((v=a+c-E)>=0&&v<f&&-1!=l[v])if(T>=(b=i-l[v]))return this.diff_bisectSplit_(t,e,T,D,n)}}for(var I=-F+u;I<=F-d;I+=2){for(var b,v=a+I,L=(b=I==-F||I!=F&&l[v-1]<l[v+1]?l[v+1]:l[v-1]+1)-I;b<i&&L<h&&t.charAt(i-b-1)==e.charAt(h-L-1);)b++,L++;if(l[v]=b,b>i)d+=2;else if(L>h)u+=2;else if(!g){if((m=a+c-I)>=0&&m<f&&-1!=s[m]){var T;D=a+(T=s[m])-m;if(T>=(b=i-b))return this.diff_bisectSplit_(t,e,T,D,n)}}}}return[[DIFF_DELETE,t],[DIFF_INSERT,e]]},diff_match_patch.prototype.diff_bisectSplit_=function(t,e,n,i,h){var r=t.substring(0,n),a=e.substring(0,i),f=t.substring(n),s=e.substring(i),l=this.diff_main(r,a,!1,h),_=this.diff_main(f,s,!1,h);return l.concat(_)},diff_match_patch.prototype.diff_linesToChars_=function(t,e){var n=[],i={};function h(t){for(var e="",h=0,r=-1,a=n.length;r<t.length-1;){-1==(r=t.indexOf("\n",h))&&(r=t.length-1);var f=t.substring(h,r+1);h=r+1,(i.hasOwnProperty?i.hasOwnProperty(f):void 0!==i[f])?e+=String.fromCharCode(i[f]):(e+=String.fromCharCode(a),i[f]=a,n[a++]=f)}return e}return n[0]="",{chars1:h(t),chars2:h(e),lineArray:n}},diff_match_patch.prototype.diff_charsToLines_=function(t,e){for(var n=0;n<t.length;n++){for(var i=t[n][1],h=[],r=0;r<i.length;r++)h[r]=e[i.charCodeAt(r)];t[n][1]=h.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,i=Math.min(t.length,e.length),h=i,r=0;n<h;)t.substring(r,h)==e.substring(r,h)?r=n=h:i=h,h=Math.floor((i-n)/2+n);return h},diff_match_patch.prototype.diff_commonSuffix=function(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,i=Math.min(t.length,e.length),h=i,r=0;n<h;)t.substring(t.length-h,t.length-r)==e.substring(e.length-h,e.length-r)?r=n=h:i=h,h=Math.floor((i-n)/2+n);return h},diff_match_patch.prototype.diff_commonOverlap_=function(t,e){var n=t.length,i=e.length;if(0==n||0==i)return 0;n>i?t=t.substring(n-i):n<i&&(e=e.substring(0,n));var h=Math.min(n,i);if(t==e)return h;for(var r=0,a=1;;){var f=t.substring(h-a),s=e.indexOf(f);if(-1==s)return r;a+=s,0!=s&&t.substring(h-a)!=e.substring(0,a)||(r=a,a++)}},diff_match_patch.prototype.diff_halfMatch_=function(t,e){if(this.Diff_Timeout<=0)return null;var n=t.length>e.length?t:e,i=t.length>e.length?e:t;if(n.length<4||2*i.length<n.length)return null;var h=this;function r(t,e,n){for(var i,r,a,f,s=t.substring(n,n+Math.floor(t.length/4)),l=-1,_="";-1!=(l=e.indexOf(s,l+1));){var c=h.diff_commonPrefix(t.substring(n),e.substring(l)),g=h.diff_commonSuffix(t.substring(0,n),e.substring(0,l));_.length<g+c&&(_=e.substring(l-g,l)+e.substring(l,l+c),i=t.substring(0,n-g),r=t.substring(n+c),a=e.substring(0,l-g),f=e.substring(l+c))}return 2*_.length>=t.length?[i,r,a,f,_]:null}var a,f,s,l,_,c=r(n,i,Math.ceil(n.length/4)),g=r(n,i,Math.ceil(n.length/2));return c||g?(a=g?c&&c[4].length>g[4].length?c:g:c,t.length>e.length?(f=a[0],s=a[1],l=a[2],_=a[3]):(l=a[0],_=a[1],f=a[2],s=a[3]),[f,s,l,_,a[4]]):null},diff_match_patch.prototype.diff_cleanupSemantic=function(t){for(var e=!1,n=[],i=0,h=null,r=0,a=0,f=0,s=0,l=0;r<t.length;)t[r][0]==DIFF_EQUAL?(n[i++]=r,a=s,f=l,s=0,l=0,h=t[r][1]):(t[r][0]==DIFF_INSERT?s+=t[r][1].length:l+=t[r][1].length,h&&h.length<=Math.max(a,f)&&h.length<=Math.max(s,l)&&(t.splice(n[i-1],0,[DIFF_DELETE,h]),t[n[i-1]+1][0]=DIFF_INSERT,i--,r=--i>0?n[i-1]:-1,a=0,f=0,s=0,l=0,h=null,e=!0)),r++;for(e&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),r=1;r<t.length;){if(t[r-1][0]==DIFF_DELETE&&t[r][0]==DIFF_INSERT){var _=t[r-1][1],c=t[r][1],g=this.diff_commonOverlap_(_,c),o=this.diff_commonOverlap_(c,_);g>=o?(g>=_.length/2||g>=c.length/2)&&(t.splice(r,0,[DIFF_EQUAL,c.substring(0,g)]),t[r-1][1]=_.substring(0,_.length-g),t[r+1][1]=c.substring(g),r++):(o>=_.length/2||o>=c.length/2)&&(t.splice(r,0,[DIFF_EQUAL,_.substring(0,o)]),t[r-1][0]=DIFF_INSERT,t[r-1][1]=c.substring(0,c.length-o),t[r+1][0]=DIFF_DELETE,t[r+1][1]=_.substring(o),r++),r++}r++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(t){function e(t,e){if(!t||!e)return 6;var n=t.charAt(t.length-1),i=e.charAt(0),h=n.match(diff_match_patch.nonAlphaNumericRegex_),r=i.match(diff_match_patch.nonAlphaNumericRegex_),a=h&&n.match(diff_match_patch.whitespaceRegex_),f=r&&i.match(diff_match_patch.whitespaceRegex_),s=a&&n.match(diff_match_patch.linebreakRegex_),l=f&&i.match(diff_match_patch.linebreakRegex_),_=s&&t.match(diff_match_patch.blanklineEndRegex_),c=l&&e.match(diff_match_patch.blanklineStartRegex_);return _||c?5:s||l?4:h&&!a&&f?3:a||f?2:h||r?1:0}for(var n=1;n<t.length-1;){if(t[n-1][0]==DIFF_EQUAL&&t[n+1][0]==DIFF_EQUAL){var i=t[n-1][1],h=t[n][1],r=t[n+1][1],a=this.diff_commonSuffix(i,h);if(a){var f=h.substring(h.length-a);i=i.substring(0,i.length-a),h=f+h.substring(0,h.length-a),r=f+r}for(var s=i,l=h,_=r,c=e(i,h)+e(h,r);h.charAt(0)===r.charAt(0);){i+=h.charAt(0),h=h.substring(1)+r.charAt(0),r=r.substring(1);var g=e(i,h)+e(h,r);g>=c&&(c=g,s=i,l=h,_=r)}t[n-1][1]!=s&&(s?t[n-1][1]=s:(t.splice(n-1,1),n--),t[n][1]=l,_?t[n+1][1]=_:(t.splice(n+1,1),n--))}n++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(t){for(var e=!1,n=[],i=0,h=null,r=0,a=!1,f=!1,s=!1,l=!1;r<t.length;)t[r][0]==DIFF_EQUAL?(t[r][1].length<this.Diff_EditCost&&(s||l)?(n[i++]=r,a=s,f=l,h=t[r][1]):(i=0,h=null),s=l=!1):(t[r][0]==DIFF_DELETE?l=!0:s=!0,h&&(a&&f&&s&&l||h.length<this.Diff_EditCost/2&&a+f+s+l==3)&&(t.splice(n[i-1],0,[DIFF_DELETE,h]),t[n[i-1]+1][0]=DIFF_INSERT,i--,h=null,a&&f?(s=l=!0,i=0):(r=--i>0?n[i-1]:-1,s=l=!1),e=!0)),r++;e&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_cleanupMerge=function(t){t.push([DIFF_EQUAL,""]);for(var e,n=0,i=0,h=0,r="",a="";n<t.length;)switch(t[n][0]){case DIFF_INSERT:h++,a+=t[n][1],n++;break;case DIFF_DELETE:i++,r+=t[n][1],n++;break;case DIFF_EQUAL:i+h>1?(0!==i&&0!==h&&(0!==(e=this.diff_commonPrefix(a,r))&&(n-i-h>0&&t[n-i-h-1][0]==DIFF_EQUAL?t[n-i-h-1][1]+=a.substring(0,e):(t.splice(0,0,[DIFF_EQUAL,a.substring(0,e)]),n++),a=a.substring(e),r=r.substring(e)),0!==(e=this.diff_commonSuffix(a,r))&&(t[n][1]=a.substring(a.length-e)+t[n][1],a=a.substring(0,a.length-e),r=r.substring(0,r.length-e))),0===i?t.splice(n-h,i+h,[DIFF_INSERT,a]):0===h?t.splice(n-i,i+h,[DIFF_DELETE,r]):t.splice(n-i-h,i+h,[DIFF_DELETE,r],[DIFF_INSERT,a]),n=n-i-h+(i?1:0)+(h?1:0)+1):0!==n&&t[n-1][0]==DIFF_EQUAL?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,h=0,i=0,r="",a=""}""===t[t.length-1][1]&&t.pop();var f=!1;for(n=1;n<t.length-1;)t[n-1][0]==DIFF_EQUAL&&t[n+1][0]==DIFF_EQUAL&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),f=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),f=!0)),n++;f&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_xIndex=function(t,e){var n,i=0,h=0,r=0,a=0;for(n=0;n<t.length&&(t[n][0]!==DIFF_INSERT&&(i+=t[n][1].length),t[n][0]!==DIFF_DELETE&&(h+=t[n][1].length),!(i>e));n++)r=i,a=h;return t.length!=n&&t[n][0]===DIFF_DELETE?a:a+(e-r)},diff_match_patch.prototype.diff_prettyHtml=function(t){for(var e=[],n=/&/g,i=/</g,h=/>/g,r=/\n/g,a=0;a<t.length;a++){var f=t[a][0],s=t[a][1].replace(n,"&amp;").replace(i,"&lt;").replace(h,"&gt;").replace(r,"&para;<br>");switch(f){case DIFF_INSERT:e[a]='<ins style="background:#e6ffe6;">'+s+"</ins>";break;case DIFF_DELETE:e[a]='<del style="background:#ffe6e6;">'+s+"</del>";break;case DIFF_EQUAL:e[a]="<span>"+s+"</span>"}}return e.join("")},diff_match_patch.prototype.diff_text1=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==DIFF_INSERT&&(e[n]=t[n][1]);return e.join("")},diff_match_patch.prototype.diff_text2=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==DIFF_DELETE&&(e[n]=t[n][1]);return e.join("")},diff_match_patch.prototype.diff_levenshtein=function(t){for(var e=0,n=0,i=0,h=0;h<t.length;h++){var r=t[h][0],a=t[h][1];switch(r){case DIFF_INSERT:n+=a.length;break;case DIFF_DELETE:i+=a.length;break;case DIFF_EQUAL:e+=Math.max(n,i),n=0,i=0}}return e+=Math.max(n,i)},diff_match_patch.prototype.diff_toDelta=function(t){for(var e=[],n=0;n<t.length;n++)switch(t[n][0]){case DIFF_INSERT:e[n]="+"+encodeURI(t[n][1]);break;case DIFF_DELETE:e[n]="-"+t[n][1].length;break;case DIFF_EQUAL:e[n]="="+t[n][1].length}return e.join("\t").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(t,e){for(var n=[],i=0,h=0,r=e.split(/\t/g),a=0;a<r.length;a++){var f=r[a].substring(1);switch(r[a].charAt(0)){case"+":try{n[i++]=[DIFF_INSERT,decodeURI(f)]}catch(t){throw new Error("Illegal escape in diff_fromDelta: "+f)}break;case"-":case"=":var s=parseInt(f,10);if(isNaN(s)||s<0)throw new Error("Invalid number in diff_fromDelta: "+f);var l=t.substring(h,h+=s);"="==r[a].charAt(0)?n[i++]=[DIFF_EQUAL,l]:n[i++]=[DIFF_DELETE,l];break;default:if(r[a])throw new Error("Invalid diff operation in diff_fromDelta: "+r[a])}}if(h!=t.length)throw new Error("Delta length ("+h+") does not equal source text length ("+t.length+").");return n},diff_match_patch.prototype.match_main=function(t,e,n){if(null==t||null==e||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,t.length)),t==e?0:t.length?t.substring(n,n+e.length)==e?n:this.match_bitap_(t,e,n):-1},diff_match_patch.prototype.match_bitap_=function(t,e,n){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(e),h=this;function r(t,i){var r=t/e.length,a=Math.abs(n-i);return h.Match_Distance?r+a/h.Match_Distance:a?1:r}var a=this.Match_Threshold,f=t.indexOf(e,n);-1!=f&&(a=Math.min(r(0,f),a),-1!=(f=t.lastIndexOf(e,n+e.length))&&(a=Math.min(r(0,f),a)));var s,l,_=1<<e.length-1;f=-1;for(var c,g=e.length+t.length,o=0;o<e.length;o++){for(s=0,l=g;s<l;)r(o,n+l)<=a?s=l:g=l,l=Math.floor((g-s)/2+s);g=l;var p=Math.max(1,n-l+1),u=Math.min(n+l,t.length)+e.length,d=Array(u+2);d[u+1]=(1<<o)-1;for(var F=u;F>=p;F--){var E=i[t.charAt(F-1)];if(d[F]=0===o?(d[F+1]<<1|1)&E:(d[F+1]<<1|1)&E|(c[F+1]|c[F])<<1|1|c[F+1],d[F]&_){var m=r(o,F-1);if(m<=a){if(a=m,!((f=F-1)>n))break;p=Math.max(1,2*n-f)}}}if(r(o+1,n)>a)break;c=d}return f},diff_match_patch.prototype.match_alphabet_=function(t){for(var e={},n=0;n<t.length;n++)e[t.charAt(n)]=0;for(n=0;n<t.length;n++)e[t.charAt(n)]|=1<<t.length-n-1;return e},diff_match_patch.prototype.patch_addContext_=function(t,e){if(0!=e.length){for(var n=e.substring(t.start2,t.start2+t.length1),i=0;e.indexOf(n)!=e.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=e.substring(t.start2-i,t.start2+t.length1+i);i+=this.Patch_Margin;var h=e.substring(t.start2-i,t.start2);h&&t.diffs.unshift([DIFF_EQUAL,h]);var r=e.substring(t.start2+t.length1,t.start2+t.length1+i);r&&t.diffs.push([DIFF_EQUAL,r]),t.start1-=h.length,t.start2-=h.length,t.length1+=h.length+r.length,t.length2+=h.length+r.length}},diff_match_patch.prototype.patch_make=function(t,e,n){var i,h;if("string"==typeof t&&"string"==typeof e&&void 0===n)i=t,(h=this.diff_main(i,e,!0)).length>2&&(this.diff_cleanupSemantic(h),this.diff_cleanupEfficiency(h));else if(t&&"object"==typeof t&&void 0===e&&void 0===n)h=t,i=this.diff_text1(h);else if("string"==typeof t&&e&&"object"==typeof e&&void 0===n)i=t,h=e;else{if("string"!=typeof t||"string"!=typeof e||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");i=t,h=n}if(0===h.length)return[];for(var r=[],a=new diff_match_patch.patch_obj,f=0,s=0,l=0,_=i,c=i,g=0;g<h.length;g++){var o=h[g][0],p=h[g][1];switch(f||o===DIFF_EQUAL||(a.start1=s,a.start2=l),o){case DIFF_INSERT:a.diffs[f++]=h[g],a.length2+=p.length,c=c.substring(0,l)+p+c.substring(l);break;case DIFF_DELETE:a.length1+=p.length,a.diffs[f++]=h[g],c=c.substring(0,l)+c.substring(l+p.length);break;case DIFF_EQUAL:p.length<=2*this.Patch_Margin&&f&&h.length!=g+1?(a.diffs[f++]=h[g],a.length1+=p.length,a.length2+=p.length):p.length>=2*this.Patch_Margin&&f&&(this.patch_addContext_(a,_),r.push(a),a=new diff_match_patch.patch_obj,f=0,_=c,s=l)}o!==DIFF_INSERT&&(s+=p.length),o!==DIFF_DELETE&&(l+=p.length)}return f&&(this.patch_addContext_(a,_),r.push(a)),r},diff_match_patch.prototype.patch_deepCopy=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n],h=new diff_match_patch.patch_obj;h.diffs=[];for(var r=0;r<i.diffs.length;r++)h.diffs[r]=i.diffs[r].slice();h.start1=i.start1,h.start2=i.start2,h.length1=i.length1,h.length2=i.length2,e[n]=h}return e},diff_match_patch.prototype.patch_apply=function(t,e){if(0==t.length)return[e,[]];t=this.patch_deepCopy(t);var n=this.patch_addPadding(t);e=n+e+n,this.patch_splitMax(t);for(var i=0,h=[],r=0;r<t.length;r++){var a,f,s=t[r].start2+i,l=this.diff_text1(t[r].diffs),_=-1;if(l.length>this.Match_MaxBits?-1!=(a=this.match_main(e,l.substring(0,this.Match_MaxBits),s))&&(-1==(_=this.match_main(e,l.substring(l.length-this.Match_MaxBits),s+l.length-this.Match_MaxBits))||a>=_)&&(a=-1):a=this.match_main(e,l,s),-1==a)h[r]=!1,i-=t[r].length2-t[r].length1;else if(h[r]=!0,i=a-s,l==(f=-1==_?e.substring(a,a+l.length):e.substring(a,_+this.Match_MaxBits)))e=e.substring(0,a)+this.diff_text2(t[r].diffs)+e.substring(a+l.length);else{var c=this.diff_main(l,f,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(c)/l.length>this.Patch_DeleteThreshold)h[r]=!1;else{this.diff_cleanupSemanticLossless(c);for(var g,o=0,p=0;p<t[r].diffs.length;p++){var u=t[r].diffs[p];u[0]!==DIFF_EQUAL&&(g=this.diff_xIndex(c,o)),u[0]===DIFF_INSERT?e=e.substring(0,a+g)+u[1]+e.substring(a+g):u[0]===DIFF_DELETE&&(e=e.substring(0,a+g)+e.substring(a+this.diff_xIndex(c,o+u[1].length))),u[0]!==DIFF_DELETE&&(o+=u[1].length)}}}}return[e=e.substring(n.length,e.length-n.length),h]},diff_match_patch.prototype.patch_addPadding=function(t){for(var e=this.Patch_Margin,n="",i=1;i<=e;i++)n+=String.fromCharCode(i);for(i=0;i<t.length;i++)t[i].start1+=e,t[i].start2+=e;var h=t[0],r=h.diffs;if(0==r.length||r[0][0]!=DIFF_EQUAL)r.unshift([DIFF_EQUAL,n]),h.start1-=e,h.start2-=e,h.length1+=e,h.length2+=e;else if(e>r[0][1].length){var a=e-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],h.start1-=a,h.start2-=a,h.length1+=a,h.length2+=a}if(0==(r=(h=t[t.length-1]).diffs).length||r[r.length-1][0]!=DIFF_EQUAL)r.push([DIFF_EQUAL,n]),h.length1+=e,h.length2+=e;else if(e>r[r.length-1][1].length){a=e-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,a),h.length1+=a,h.length2+=a}return n},diff_match_patch.prototype.patch_splitMax=function(t){for(var e=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=e)){var i=t[n];t.splice(n--,1);for(var h=i.start1,r=i.start2,a="";0!==i.diffs.length;){var f=new diff_match_patch.patch_obj,s=!0;for(f.start1=h-a.length,f.start2=r-a.length,""!==a&&(f.length1=f.length2=a.length,f.diffs.push([DIFF_EQUAL,a]));0!==i.diffs.length&&f.length1<e-this.Patch_Margin;){var l=i.diffs[0][0],_=i.diffs[0][1];l===DIFF_INSERT?(f.length2+=_.length,r+=_.length,f.diffs.push(i.diffs.shift()),s=!1):l===DIFF_DELETE&&1==f.diffs.length&&f.diffs[0][0]==DIFF_EQUAL&&_.length>2*e?(f.length1+=_.length,h+=_.length,s=!1,f.diffs.push([l,_]),i.diffs.shift()):(_=_.substring(0,e-f.length1-this.Patch_Margin),f.length1+=_.length,h+=_.length,l===DIFF_EQUAL?(f.length2+=_.length,r+=_.length):s=!1,f.diffs.push([l,_]),_==i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(_.length))}a=(a=this.diff_text2(f.diffs)).substring(a.length-this.Patch_Margin);var c=this.diff_text1(i.diffs).substring(0,this.Patch_Margin);""!==c&&(f.length1+=c.length,f.length2+=c.length,0!==f.diffs.length&&f.diffs[f.diffs.length-1][0]===DIFF_EQUAL?f.diffs[f.diffs.length-1][1]+=c:f.diffs.push([DIFF_EQUAL,c])),s||t.splice(++n,0,f)}}},diff_match_patch.prototype.patch_toText=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return e.join("")},diff_match_patch.prototype.patch_fromText=function(t){var e=[];if(!t)return e;for(var n=t.split("\n"),i=0,h=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<n.length;){var r=n[i].match(h);if(!r)throw new Error("Invalid patch string: "+n[i]);var a=new diff_match_patch.patch_obj;for(e.push(a),a.start1=parseInt(r[1],10),""===r[2]?(a.start1--,a.length1=1):"0"==r[2]?a.length1=0:(a.start1--,a.length1=parseInt(r[2],10)),a.start2=parseInt(r[3],10),""===r[4]?(a.start2--,a.length2=1):"0"==r[4]?a.length2=0:(a.start2--,a.length2=parseInt(r[4],10)),i++;i<n.length;){var f=n[i].charAt(0);try{var s=decodeURI(n[i].substring(1))}catch(t){throw new Error("Illegal escape in patch_fromText: "+s)}if("-"==f)a.diffs.push([DIFF_DELETE,s]);else if("+"==f)a.diffs.push([DIFF_INSERT,s]);else if(" "==f)a.diffs.push([DIFF_EQUAL,s]);else{if("@"==f)break;if(""!==f)throw new Error('Invalid patch mode "'+f+'" in: '+s)}i++}}return e},diff_match_patch.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},diff_match_patch.patch_obj.prototype.toString=function(){for(var t,e=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case DIFF_INSERT:t="+";break;case DIFF_DELETE:t="-";break;case DIFF_EQUAL:t=" "}e[n+1]=t+encodeURI(this.diffs[n][1])+"\n"}return e.join("").replace(/%20/g," ")},module.exports=diff_match_patch,module.exports.diff_match_patch=diff_match_patch,module.exports.DIFF_DELETE=DIFF_DELETE,module.exports.DIFF_INSERT=DIFF_INSERT,module.exports.DIFF_EQUAL=DIFF_EQUAL;

},{}],5:[function(require,module,exports){
module.exports=function(){var e=document.baseURI;if(!e)for(var t=document.getElementsByTagName("base"),n=0;n<t.length;n++)if(t[n].href){e=t[n].href;break}return e||document.documentURI}();

},{}],6:[function(require,module,exports){
!function(e,r){if("function"==typeof define&&define.amd)define(["exports","module"],r);else if("undefined"!=typeof exports&&"undefined"!=typeof module)r(exports,module);else{var t={exports:{}};r(t.exports,t),e.FragmentAnchor=t.exports}}(this,function(e,r){"use strict";var t=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}();var o=function(){function e(r,t){if(function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===r)throw new Error('missing required parameter "root"');if(void 0===t)throw new Error('missing required parameter "id"');this.root=r,this.id=t}return t(e,[{key:"toRange",value:function(){var e=this.root.querySelector("#"+this.id);if(null==e)throw new Error('no element found with id "'+this.id+'"');var r=this.root.ownerDocument.createRange();return r.selectNodeContents(e),r}},{key:"toSelector",value:function(){var e=this.root.querySelector("#"+this.id);if(null==e)throw new Error('no element found with id "'+this.id+'"');var r="https://tools.ietf.org/html/rfc3236";return e instanceof SVGElement&&(r="http://www.w3.org/TR/SVG/"),{type:"FragmentSelector",value:this.id,conformsTo:r}}}],[{key:"fromRange",value:function(r,t){if(void 0===r)throw new Error('missing required parameter "root"');if(void 0===t)throw new Error('missing required parameter "range"');for(var o=t.commonAncestorContainer;null!=o&&!o.id;){if(!(r.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINED_BY))throw new Error("no fragment identifier found");o=o.parentElement}return new e(r,o.id)}},{key:"fromSelector",value:function(r){return new e(r,(arguments.length<=1||void 0===arguments[1]?{}:arguments[1]).value)}}]),e}();r.exports=o});

},{}],7:[function(require,module,exports){
module.exports=require("./lib");

},{"./lib":8}],8:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromRange=fromRange,exports.toRange=toRange;var _domNodeIterator=require("dom-node-iterator"),_domNodeIterator2=_interopRequireDefault(_domNodeIterator),_domSeek=require("dom-seek"),_domSeek2=_interopRequireDefault(_domSeek),_rangeToString=require("./range-to-string"),_rangeToString2=_interopRequireDefault(_rangeToString);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var SHOW_TEXT=4;function fromRange(e,r){if(void 0===e)throw new Error('missing required parameter "root"');if(void 0===r)throw new Error('missing required parameter "range"');var t=e.ownerDocument.createRange(),o=r.startContainer,n=r.startOffset;t.setStart(e,0),t.setEnd(o,n);var a=(0,_rangeToString2.default)(t).length;return{start:a,end:a+(0,_rangeToString2.default)(r).length}}function toRange(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(void 0===e)throw new Error('missing required parameter "root"');var t=e.ownerDocument.createRange(),o=(0,_domNodeIterator2.default)(e,SHOW_TEXT),n=r.start||0,a=r.end||n,d=(0,_domSeek2.default)(o,n),i=n-d;o.pointerBeforeReferenceNode?t.setStart(o.referenceNode,i):(t.setStart(o.nextNode(),i),o.previousNode());var u=a-n+i;return i=u-(d=(0,_domSeek2.default)(o,u)),o.pointerBeforeReferenceNode?t.setEnd(o.referenceNode,i):t.setEnd(o.nextNode(),i),t}

},{"./range-to-string":9,"dom-node-iterator":13,"dom-seek":22}],9:[function(require,module,exports){
"use strict";function nextNode(e,t){if(!t&&e.firstChild)return e.firstChild;do{if(e.nextSibling)return e.nextSibling;e=e.parentNode}while(e);return e}function firstNode(e){return e.startContainer.nodeType===Node.ELEMENT_NODE?e.startContainer.childNodes[e.startOffset]||nextNode(e.startContainer,!0):e.startContainer}function firstNodeAfter(e){return e.endContainer.nodeType===Node.ELEMENT_NODE?e.endContainer.childNodes[e.endOffset]||nextNode(e.endContainer,!0):nextNode(e.endContainer)}function forEachNodeInRange(e,t){for(var n=firstNode(e),r=firstNodeAfter(e);n!==r;)t(n),n=nextNode(n)}function rangeToString(e){var t="";return forEachNodeInRange(e,function(n){if(n.nodeType===Node.TEXT_NODE){var r=n===e.startContainer?e.startOffset:0,o=n===e.endContainer?e.endOffset:n.textContent.length;t+=n.textContent.slice(r,o)}}),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=rangeToString;

},{}],10:[function(require,module,exports){
module.exports=require("./lib");

},{"./lib":11}],11:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromRange=fromRange,exports.fromTextPosition=fromTextPosition,exports.toRange=toRange,exports.toTextPosition=toTextPosition;var _diffMatchPatch=require("diff-match-patch"),_diffMatchPatch2=_interopRequireDefault(_diffMatchPatch),_domAnchorTextPosition=require("dom-anchor-text-position"),textPosition=_interopRequireWildcard(_domAnchorTextPosition);function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var SLICE_LENGTH=32,SLICE_RE=new RegExp("(.|[\r\n]){1,"+String(SLICE_LENGTH)+"}","g"),CONTEXT_LENGTH=SLICE_LENGTH;function fromRange(t,e){if(void 0===t)throw new Error('missing required parameter "root"');if(void 0===e)throw new Error('missing required parameter "range"');return fromTextPosition(t,textPosition.fromRange(t,e))}function fromTextPosition(t,e){if(void 0===t)throw new Error('missing required parameter "root"');if(void 0===e)throw new Error('missing required parameter "selector"');var r=e.start;if(void 0===r)throw new Error('selector missing required property "start"');if(r<0)throw new Error('property "start" must be a non-negative integer');var n=e.end;if(void 0===n)throw new Error('selector missing required property "end"');if(n<0)throw new Error('property "end" must be a non-negative integer');var o=t.textContent.substr(r,n-r),i=Math.max(0,r-CONTEXT_LENGTH),a=t.textContent.substr(i,r-i),s=Math.min(t.textContent.length,n+CONTEXT_LENGTH);return{exact:o,prefix:a,suffix:t.textContent.substr(n,s-n)}}function toRange(t,e){var r=toTextPosition(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});return null===r?null:textPosition.toRange(t,r)}function toTextPosition(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(void 0===t)throw new Error('missing required parameter "root"');if(void 0===e)throw new Error('missing required parameter "selector"');var n=e.exact;if(void 0===n)throw new Error('selector missing required property "exact"');var o=e.prefix,i=e.suffix,a=r.hint,s=new _diffMatchPatch2.default;s.Match_Distance=2*t.textContent.length;var u=n.match(SLICE_RE),f=void 0===a?t.textContent.length/2|0:a,d=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,c=-1,l=void 0!==i,m=!1;void 0!==o&&(c=s.match_main(t.textContent,o,f))>-1&&(f=c+o.length,m=!0),l&&!m&&(c=s.match_main(t.textContent,i,f+n.length))>-1&&(f=c-n.length);var x=u.shift();if(!((c=s.match_main(t.textContent,x,f))>-1))return null;f=h=(d=c)+x.length;s.Match_Distance=64;var g=u.reduce(function(e,r){if(!e)return null;var n=s.match_main(t.textContent,r,e.loc);return-1===n?null:(e.loc=n+r.length,e.start=Math.min(e.start,n),e.end=Math.max(e.end,n+r.length),e)},{start:d,end:h,loc:f});return g?{start:g.start,end:g.end}:null}

},{"diff-match-patch":4,"dom-anchor-text-position":7}],12:[function(require,module,exports){
module.exports=require("./lib/implementation").default;

},{"./lib/implementation":16}],13:[function(require,module,exports){
module.exports=require("./lib").default,module.exports.getPolyfill=require("./polyfill"),module.exports.implementation=require("./implementation"),module.exports.shim=require("./shim");

},{"./implementation":12,"./lib":17,"./polyfill":20,"./shim":21}],14:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function createNodeIterator(e){var t=arguments.length<=1||void 0===arguments[1]?4294967295:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],o=(9==e.nodeType||e.ownerDocument).createNodeIterator(e,t,r,!1);return new NodeIterator(o,e,t,r)}exports.__esModule=!0,exports.default=createNodeIterator;var NodeIterator=function(){function e(t,r,o,n){_classCallCheck(this,e),this.root=r,this.whatToShow=o,this.filter=n,this.referenceNode=r,this.pointerBeforeReferenceNode=!0,this._iter=t}return e.prototype.nextNode=function(){var e=this._iter.nextNode();return this.pointerBeforeReferenceNode=!1,null===e?null:(this.referenceNode=e,this.referenceNode)},e.prototype.previousNode=function(){var e=this._iter.previousNode();return this.pointerBeforeReferenceNode=!0,null===e?null:(this.referenceNode=e,this.referenceNode)},e.prototype.toString=function(){return"[object NodeIterator]"},e}();

},{}],15:[function(require,module,exports){
"use strict";function createNodeIterator(e){var t=arguments.length<=1||void 0===arguments[1]?4294967295:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],o=e.ownerDocument;return o.createNodeIterator.call(o,e,t,r)}exports.__esModule=!0,exports.default=createNodeIterator;

},{}],16:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function createNodeIterator(e){var t=arguments.length<=1||void 0===arguments[1]?4294967295:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return new NodeIterator(e,t,r)}exports.__esModule=!0,exports.default=createNodeIterator;var NodeIterator=function(){function e(t,r,o){_classCallCheck(this,e),this.root=t,this.whatToShow=r,this.filter=o,this.referenceNode=t,this.pointerBeforeReferenceNode=!0,this._filter=function(e){return!o||1===o(e)},this._show=function(e){return r>>e.nodeType-1&!0}}return e.prototype.nextNode=function(){var e=this.pointerBeforeReferenceNode;this.pointerBeforeReferenceNode=!1;var t=this.referenceNode;if(e&&this._show(t)&&this._filter(t))return t;do{if(t.firstChild)t=t.firstChild;else{do{if(t===this.root)return null;if(t.nextSibling)break;t=t.parentNode}while(t);t=t.nextSibling}}while(!this._show(t)||!this._filter(t));return this.referenceNode=t,this.pointerBeforeReferenceNode=!1,t},e.prototype.previousNode=function(){var e=this.pointerBeforeReferenceNode;this.pointerBeforeReferenceNode=!0;var t=this.referenceNode;if(!e&&this._show(t)&&this._filter(t))return t;do{if(t===this.root)return null;if(t.previousSibling)for(t=t.previousSibling;t.lastChild;)t=t.lastChild;else t=t.parentNode}while(!this._show(t)||!this._filter(t));return this.referenceNode=t,this.pointerBeforeReferenceNode=!0,t},e.prototype.toString=function(){return"[object NodeIterator]"},e}();

},{}],17:[function(require,module,exports){
"use strict";exports.__esModule=!0;var _polyfill=require("./polyfill"),_polyfill2=_interopRequireDefault(_polyfill),_implementation=require("./implementation"),_implementation2=_interopRequireDefault(_implementation),_shim=require("./shim"),_shim2=_interopRequireDefault(_shim);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var polyfill=(0,_polyfill2.default)();polyfill.implementation=_implementation2.default,polyfill.shim=_shim2.default,exports.default=polyfill;

},{"./implementation":16,"./polyfill":18,"./shim":19}],18:[function(require,module,exports){
"use strict";exports.__esModule=!0,exports.default=getPolyfill;var _adapter=require("./adapter"),_adapter2=_interopRequireDefault(_adapter),_builtin=require("./builtin"),_builtin2=_interopRequireDefault(_builtin),_implementation=require("./implementation"),_implementation2=_interopRequireDefault(_implementation);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getPolyfill(){try{var e="undefined"==typeof document?{}:document;return(0,_builtin2.default)(e,4294967295,null,!1).referenceNode===e?_builtin2.default:_adapter2.default}catch(e){return _implementation2.default}}

},{"./adapter":14,"./builtin":15,"./implementation":16}],19:[function(require,module,exports){
"use strict";exports.__esModule=!0,exports.default=shim;var _builtin=require("./builtin"),_builtin2=_interopRequireDefault(_builtin),_polyfill=require("./polyfill"),_polyfill2=_interopRequireDefault(_polyfill);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function shim(){var e="undefined"==typeof document?{}:document,i=(0,_polyfill2.default)();return i!==_builtin2.default&&(e.createNodeIterator=i),i}

},{"./builtin":15,"./polyfill":18}],20:[function(require,module,exports){
module.exports=require("./lib/polyfill").default;

},{"./lib/polyfill":18}],21:[function(require,module,exports){
module.exports=require("./lib/shim").default;

},{"./lib/shim":19}],22:[function(require,module,exports){
module.exports=require("./lib").default;

},{"./lib":23}],23:[function(require,module,exports){
"use strict";exports.__esModule=!0,exports.default=seek;var _ancestors=require("ancestors"),_ancestors2=_interopRequireDefault(_ancestors),_indexOf=require("index-of"),_indexOf2=_interopRequireDefault(_indexOf);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var E_SHOW="Argument 1 of seek must use filter NodeFilter.SHOW_TEXT.",E_WHERE="Argument 2 of seek must be a number or a Text Node.",SHOW_TEXT=4,TEXT_NODE=3;function seek(e,r){if(e.whatToShow!==SHOW_TEXT)throw new Error(E_SHOW);var n=0,t=e.referenceNode,o=null;if(isNumber(r))o={forward:function(){return n<r},backward:function(){return n>r}};else{if(!isText(r))throw new Error(E_WHERE);o={forward:before(t,r)?function(){return!1}:function(){return t!==r},backward:function(){return t!=r||!e.pointerBeforeReferenceNode}}}for(;o.forward()&&null!==(t=e.nextNode());)n+=t.nodeValue.length;for(;o.backward()&&null!==(t=e.previousNode());)n-=t.nodeValue.length;return n}function isNumber(e){return!isNaN(parseInt(e))&&isFinite(e)}function isText(e){return e.nodeType===TEXT_NODE}function before(e,r){if(e===r)return!1;for(var n=null,t=[e].concat((0,_ancestors2.default)(e)).reverse(),o=[r].concat((0,_ancestors2.default)(r)).reverse();t[0]===o[0];)n=t.shift(),o.shift();return t=t[0],o=o[0],(0,_indexOf2.default)(n.childNodes,t)>(0,_indexOf2.default)(n.childNodes,o)}

},{"ancestors":1,"index-of":26}],24:[function(require,module,exports){
"use strict";var hasOwn=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,defineProperty=Object.defineProperty,gOPD=Object.getOwnPropertyDescriptor,isArray=function(r){return"function"==typeof Array.isArray?Array.isArray(r):"[object Array]"===toStr.call(r)},isPlainObject=function(r){if(!r||"[object Object]"!==toStr.call(r))return!1;var t,e=hasOwn.call(r,"constructor"),o=r.constructor&&r.constructor.prototype&&hasOwn.call(r.constructor.prototype,"isPrototypeOf");if(r.constructor&&!e&&!o)return!1;for(t in r);return void 0===t||hasOwn.call(r,t)},setProperty=function(r,t){defineProperty&&"__proto__"===t.name?defineProperty(r,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):r[t.name]=t.newValue},getProperty=function(r,t){if("__proto__"===t){if(!hasOwn.call(r,t))return;if(gOPD)return gOPD(r,t).value}return r[t]};module.exports=function r(){var t,e,o,n,a,i,c=arguments[0],u=1,l=arguments.length,p=!1;for("boolean"==typeof c&&(p=c,c=arguments[1]||{},u=2),(null==c||"object"!=typeof c&&"function"!=typeof c)&&(c={});u<l;++u)if(null!=(t=arguments[u]))for(e in t)o=getProperty(c,e),c!==(n=getProperty(t,e))&&(p&&n&&(isPlainObject(n)||(a=isArray(n)))?(a?(a=!1,i=o&&isArray(o)?o:[]):i=o&&isPlainObject(o)?o:{},setProperty(c,{name:e,newValue:r(p,i,n)})):void 0!==n&&setProperty(c,{name:e,newValue:n}));return c};

},{}],25:[function(require,module,exports){
(function (global){
var __browserify_shim_require__=require;(function(t,e,i,n,r){!function(e,i,r,s){"use strict";var o,a=["","webkit","Moz","MS","ms","o"],h=i.createElement("div"),u="function",c=Math.round,l=Math.abs,p=Date.now;function f(t,e,i){return setTimeout(E(t,i),e)}function v(t,e,i){return!!Array.isArray(t)&&(d(t,i[e],i),!0)}function d(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function m(t,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=e.console&&(e.console.warn||e.console.log);return s&&s.call(e.console,r,n),t.apply(this,arguments)}}o="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==s&&null!==n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}:Object.assign;var g=m(function(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===s)&&(t[n[r]]=e[n[r]]),r++;return t},"extend","Use `assign`."),T=m(function(t,e){return g(t,e,!0)},"merge","Use `assign`.");function y(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&o(n,i)}function E(t,e){return function(){return t.apply(e,arguments)}}function I(t,e){return typeof t==u?t.apply(e&&e[0]||s,e):t}function _(t,e){return t===s?e:t}function A(t,e,i){d(P(e),function(e){t.addEventListener(e,i,!1)})}function b(t,e,i){d(P(e),function(e){t.removeEventListener(e,i,!1)})}function C(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function S(t,e){return t.indexOf(e)>-1}function P(t){return t.trim().split(/\s+/g)}function D(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function w(t){return Array.prototype.slice.call(t,0)}function x(t,e,i){for(var n=[],r=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];D(r,o)<0&&n.push(t[s]),r[s]=o,s++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function O(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),o=0;o<a.length;){if((n=(i=a[o])?i+r:e)in t)return n;o++}return s}var R=1;function M(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}var z="ontouchstart"in e,N=O(e,"PointerEvent")!==s,X=z&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),Y=25,F=1,q=2,H=4,W=8,k=1,L=2,U=4,V=8,j=16,G=L|U,Z=V|j,B=G|Z,$=["x","y"],J=["clientX","clientY"];function K(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){I(t.options.enable,[t])&&i.handler(e)},this.init()}function Q(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,o=e&F&&n-r==0,a=e&(H|W)&&n-r==0;i.isFirst=!!o,i.isFinal=!!a,o&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=tt(e));r>1&&!i.firstMultiple?i.firstMultiple=tt(e):1===r&&(i.firstMultiple=!1);var o=i.firstInput,a=i.firstMultiple,h=a?a.center:o.center,u=e.center=et(n);e.timeStamp=p(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=st(h,u),e.distance=rt(h,u),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};e.eventType!==F&&s.eventType!==H||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y});e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=nt(e.deltaX,e.deltaY);var c=it(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=l(c.x)>l(c.y)?c.x:c.y,e.scale=a?(f=a.pointers,v=n,rt(v[0],v[1],J)/rt(f[0],f[1],J)):1,e.rotation=a?function(t,e){return st(e[1],e[0],J)+st(t[1],t[0],J)}(a.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,function(t,e){var i,n,r,o,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(e.eventType!=W&&(h>Y||a.velocity===s)){var u=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,p=it(h,u,c);n=p.x,r=p.y,i=l(p.x)>l(p.y)?p.x:p.y,o=nt(u,c),t.lastInterval=e}else i=a.velocity,n=a.velocityX,r=a.velocityY,o=a.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=o}(i,e);var f,v;var d=t.element;C(e.srcEvent.target,d)&&(d=e.srcEvent.target);e.target=d}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function tt(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:c(t.pointers[i].clientX),clientY:c(t.pointers[i].clientY)},i++;return{timeStamp:p(),pointers:e,center:et(e),deltaX:t.deltaX,deltaY:t.deltaY}}function et(t){var e=t.length;if(1===e)return{x:c(t[0].clientX),y:c(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:c(i/e),y:c(n/e)}}function it(t,e,i){return{x:e/t||0,y:i/t||0}}function nt(t,e){return t===e?k:l(t)>=l(e)?t<0?L:U:e<0?V:j}function rt(t,e,i){i||(i=$);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function st(t,e,i){i||(i=$);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}K.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(M(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&b(this.element,this.evEl,this.domHandler),this.evTarget&&b(this.target,this.evTarget,this.domHandler),this.evWin&&b(M(this.element),this.evWin,this.domHandler)}};var ot={mousedown:F,mousemove:q,mouseup:H},at="mousedown",ht="mousemove mouseup";function ut(){this.evEl=at,this.evWin=ht,this.pressed=!1,K.apply(this,arguments)}y(ut,K,{handler:function(t){var e=ot[t.type];e&F&&0===t.button&&(this.pressed=!0),e&q&&1!==t.which&&(e=H),this.pressed&&(e&H&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var ct={pointerdown:F,pointermove:q,pointerup:H,pointercancel:W,pointerout:W},lt={2:"touch",3:"pen",4:"mouse",5:"kinect"},pt="pointerdown",ft="pointermove pointerup pointercancel";function vt(){this.evEl=pt,this.evWin=ft,K.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(pt="MSPointerDown",ft="MSPointerMove MSPointerUp MSPointerCancel"),y(vt,K,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=ct[n],s=lt[t.pointerType]||t.pointerType,o="touch"==s,a=D(e,t.pointerId,"pointerId");r&F&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):r&(H|W)&&(i=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(a,1))}});var dt={touchstart:F,touchmove:q,touchend:H,touchcancel:W},mt="touchstart",gt="touchstart touchmove touchend touchcancel";function Tt(){this.evTarget=mt,this.evWin=gt,this.started=!1,K.apply(this,arguments)}y(Tt,K,{handler:function(t){var e=dt[t.type];if(e===F&&(this.started=!0),this.started){var i=function(t,e){var i=w(t.touches),n=w(t.changedTouches);e&(H|W)&&(i=x(i.concat(n),"identifier",!0));return[i,n]}.call(this,t,e);e&(H|W)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var yt={touchstart:F,touchmove:q,touchend:H,touchcancel:W},Et="touchstart touchmove touchend touchcancel";function It(){this.evTarget=Et,this.targetIds={},K.apply(this,arguments)}y(It,K,{handler:function(t){var e=yt[t.type],i=function(t,e){var i=w(t.touches),n=this.targetIds;if(e&(F|q)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s,o=w(t.changedTouches),a=[],h=this.target;if(s=i.filter(function(t){return C(t.target,h)}),e===F)for(r=0;r<s.length;)n[s[r].identifier]=!0,r++;r=0;for(;r<o.length;)n[o[r].identifier]&&a.push(o[r]),e&(H|W)&&delete n[o[r].identifier],r++;if(!a.length)return;return[x(s.concat(a),"identifier",!0),a]}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}});var _t=2500,At=25;function bt(){K.apply(this,arguments);var t=E(this.handler,this);this.touch=new It(this.manager,t),this.mouse=new ut(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Ct(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout(function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)},_t)}}y(bt,K,{handler:function(t,e,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(t,e){t&F?(this.primaryTouch=e.changedPointers[0].identifier,Ct.call(this,e)):t&(H|W)&&Ct.call(this,e)}).call(this,e,i);else if(r&&function(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],s=Math.abs(e-r.x),o=Math.abs(i-r.y);if(s<=At&&o<=At)return!0}return!1}.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var St=O(h.style,"touchAction"),Pt=St!==s,Dt="auto",wt="manipulation",xt="none",Ot="pan-x",Rt="pan-y",Mt=function(){if(!Pt)return!1;var t={},i=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!i||e.CSS.supports("touch-action",n)}),t}();function zt(t,e){this.manager=t,this.set(e)}zt.prototype={set:function(t){"compute"==t&&(t=this.compute()),Pt&&this.manager.element.style&&Mt[t]&&(this.manager.element.style[St]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return d(this.manager.recognizers,function(e){I(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(S(t,xt))return xt;var e=S(t,Ot),i=S(t,Rt);if(e&&i)return xt;if(e||i)return e?Ot:Rt;if(S(t,wt))return wt;return Dt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,r=S(n,xt)&&!Mt[xt],s=S(n,Rt)&&!Mt[Rt],o=S(n,Ot)&&!Mt[Ot];if(r){var a=1===t.pointers.length,h=t.distance<2,u=t.deltaTime<250;if(a&&h&&u)return}if(!o||!s)return r||s&&i&G||o&&i&Z?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Nt=1,Xt=2,Yt=4,Ft=8,qt=Ft,Ht=16;function Wt(t){this.options=o({},this.defaults,t||{}),this.id=R++,this.manager=null,this.options.enable=_(this.options.enable,!0),this.state=Nt,this.simultaneous={},this.requireFail=[]}function kt(t){return t&Ht?"cancel":t&Ft?"end":t&Yt?"move":t&Xt?"start":""}function Lt(t){return t==j?"down":t==V?"up":t==L?"left":t==U?"right":""}function Ut(t,e){var i=e.manager;return i?i.get(t):t}function Vt(){Wt.apply(this,arguments)}function jt(){Vt.apply(this,arguments),this.pX=null,this.pY=null}function Gt(){Vt.apply(this,arguments)}function Zt(){Wt.apply(this,arguments),this._timer=null,this._input=null}function Bt(){Vt.apply(this,arguments)}function $t(){Vt.apply(this,arguments)}function Jt(){Wt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Kt(t,e){return(e=e||{}).recognizers=_(e.recognizers,Kt.defaults.preset),new Qt(t,e)}Wt.prototype={defaults:{},set:function(t){return o(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(v(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Ut(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return v(t,"dropRecognizeWith",this)?this:(t=Ut(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(v(t,"requireFailure",this))return this;var e=this.requireFail;return-1===D(e,t=Ut(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(v(t,"dropRequireFailure",this))return this;t=Ut(t,this);var e=D(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,i=this.state;function n(i){e.manager.emit(i,t)}i<Ft&&n(e.options.event+kt(i)),n(e.options.event),t.additionalEvent&&n(t.additionalEvent),i>=Ft&&n(e.options.event+kt(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Nt)))return!1;t++}return!0},recognize:function(t){var e=o({},t);if(!I(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(qt|Ht|32)&&(this.state=Nt),this.state=this.process(e),this.state&(Xt|Yt|Ft|Ht)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},y(Vt,Wt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Xt|Yt),r=this.attrTest(t);return n&&(i&W||!r)?e|Ht:n||r?i&H?e|Ft:e&Xt?e|Yt:Xt:32}}),y(jt,Vt,{defaults:{event:"pan",threshold:10,pointers:1,direction:B},getTouchAction:function(){var t=this.options.direction,e=[];return t&G&&e.push(Rt),t&Z&&e.push(Ot),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&G?(r=0===s?k:s<0?L:U,i=s!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?k:o<0?V:j,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return Vt.prototype.attrTest.call(this,t)&&(this.state&Xt||!(this.state&Xt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Lt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),y(Gt,Vt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Xt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),y(Zt,Wt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Dt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(H|W)&&!r)this.reset();else if(t.eventType&F)this.reset(),this._timer=f(function(){this.state=qt,this.tryEmit()},e.time,this);else if(t.eventType&H)return qt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===qt&&(t&&t.eventType&H?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),y(Bt,Vt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Xt)}}),y($t,Vt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:G|Z,pointers:1},getTouchAction:function(){return jt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(G|Z)?e=t.overallVelocity:i&G?e=t.overallVelocityX:i&Z&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&l(e)>this.options.velocity&&t.eventType&H},emit:function(t){var e=Lt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),y(Jt,Wt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[wt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&F&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=H)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||rt(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=f(function(){this.state=qt,this.tryEmit()},e.interval,this),Xt):qt}return 32},failTimeout:function(){return this._timer=f(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==qt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Kt.VERSION="2.0.7",Kt.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Bt,{enable:!1}],[Gt,{enable:!1},["rotate"]],[$t,{direction:G}],[jt,{direction:G},["swipe"]],[Jt],[Jt,{event:"doubletap",taps:2},["tap"]],[Zt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Qt(t,e){var i;this.options=o({},Kt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((i=this).options.inputClass||(N?vt:X?It:z?bt:ut))(i,Q),this.touchAction=new zt(this,this.options.touchAction),te(this,!0),d(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function te(t,e){var i,n=t.element;n.style&&(d(t.options.cssProps,function(r,s){i=O(n.style,s),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={}))}Qt.prototype={set:function(t){return o(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var i;this.touchAction.preventDefaults(t);var n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&qt)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(Xt|Yt|Ft)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof Wt)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(v(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(v(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=D(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var i=this.handlers;return d(P(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==s){var i=this.handlers;return d(P(t),function(t){e?i[t]&&i[t].splice(D(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=i.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&te(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(Kt,{INPUT_START:F,INPUT_MOVE:q,INPUT_END:H,INPUT_CANCEL:W,STATE_POSSIBLE:Nt,STATE_BEGAN:Xt,STATE_CHANGED:Yt,STATE_ENDED:Ft,STATE_RECOGNIZED:qt,STATE_CANCELLED:Ht,STATE_FAILED:32,DIRECTION_NONE:k,DIRECTION_LEFT:L,DIRECTION_RIGHT:U,DIRECTION_UP:V,DIRECTION_DOWN:j,DIRECTION_HORIZONTAL:G,DIRECTION_VERTICAL:Z,DIRECTION_ALL:B,Manager:Qt,Input:K,TouchAction:zt,TouchInput:It,MouseInput:ut,PointerEventInput:vt,TouchMouseInput:bt,SingleTouchInput:Tt,Recognizer:Wt,AttrRecognizer:Vt,Tap:Jt,Pan:jt,Swipe:$t,Pinch:Gt,Rotate:Bt,Press:Zt,on:A,off:b,each:d,merge:T,extend:g,assign:o,inherit:y,bindFn:E,prefixed:O}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Kt,"function"==typeof n&&n.amd?n(function(){return Kt}):void 0!==t&&t.exports?t.exports=Kt:e.Hammer=Kt}(window,document),r("undefined"!=typeof Hammer?Hammer:window.Hammer)}).call(global,void 0,void 0,void 0,void 0,function(t){module.exports=t});

}).call(this,window)

},{}],26:[function(require,module,exports){
"use strict";module.exports=function(r,t,e){e=e||0;if(null==r)return-1;var n=r.length,u=e<0?n+e:e;if(u>=r.length)return-1;for(;u<n;){if(r[u]===t)return u;u++}return-1};

},{}],27:[function(require,module,exports){
(function (global){
var FUNC_ERROR_TEXT="Expected a function",NAN=NaN,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce(e,t,r){var o,n,i,u,a,f,c=0,l=!1,b=!1,s=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function v(t){var r=o,i=n;return o=n=void 0,c=t,u=e.apply(i,r)}function m(e){var r=e-f;return void 0===f||r>=t||r<0||b&&e-c>=i}function j(){var e=now();if(m(e))return y(e);a=setTimeout(j,function(e){var r=t-(e-f);return b?nativeMin(r,i-(e-c)):r}(e))}function y(e){return a=void 0,s&&o?v(e):(o=n=void 0,u)}function p(){var e=now(),r=m(e);if(o=arguments,n=this,f=e,r){if(void 0===a)return function(e){return c=e,a=setTimeout(j,t),l?v(e):u}(f);if(b)return a=setTimeout(j,t),v(f)}return void 0===a&&(a=setTimeout(j,t)),u}return t=toNumber(t)||0,isObject(r)&&(l=!!r.leading,i=(b="maxWait"in r)?nativeMax(toNumber(r.maxWait)||0,t):i,s="trailing"in r?!!r.trailing:s),p.cancel=function(){void 0!==a&&clearTimeout(a),c=0,o=f=n=a=void 0},p.flush=function(){return void 0===a?u:y(now())},p}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}module.exports=debounce;

}).call(this,window)

},{}],28:[function(require,module,exports){
(function (process){
(function(){var e,n,r,o,t,u;"undefined"!=typeof performance&&null!==performance&&performance.now?module.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(module.exports=function(){return(e()-t)/1e6},n=process.hrtime,o=(e=function(){var e;return 1e9*(e=n())[0]+e[1]})(),u=1e9*process.uptime(),t=o-u):Date.now?(module.exports=function(){return Date.now()-r},r=Date.now()):(module.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this);

}).call(this,require('_process'))

},{"_process":29}],29:[function(require,module,exports){
var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],30:[function(require,module,exports){
(function (global){
for(var now=require("performance-now"),root="undefined"==typeof window?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix],i=0;!raf&&i<vendors.length;i++)raf=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(e){if(0===queue.length){var o=now(),a=Math.max(0,frameDuration-(o-last));last=a+o,setTimeout(function(){var e=queue.slice(0);queue.length=0;for(var o=0;o<e.length;o++)if(!e[o].cancelled)try{e[o].callback(last)}catch(e){setTimeout(function(){throw e},0)}},Math.round(a))}return queue.push({handle:++id,callback:e,cancelled:!1}),id},caf=function(e){for(var o=0;o<queue.length;o++)queue[o].handle===e&&(queue[o].cancelled=!0)}}module.exports=function(e){return raf.call(root,e)},module.exports.cancel=function(){caf.apply(root,arguments)},module.exports.polyfill=function(e){e||(e=root),e.requestAnimationFrame=raf,e.cancelAnimationFrame=caf};

}).call(this,window)

},{"performance-now":28}],31:[function(require,module,exports){
var COMPLETE="complete",CANCELED="canceled";function raf(e){if("requestAnimationFrame"in window)return window.requestAnimationFrame(e);setTimeout(e,16)}function setElementScroll(e,t,n){e.self===e?e.scrollTo(t,n):(e.scrollLeft=t,e.scrollTop=n)}function getTargetScrollLocation(e,t,n){var l,i,r,a,o,s,f,c=e.getBoundingClientRect(),u=n&&null!=n.left?n.left:.5,d=n&&null!=n.top?n.top:.5,m=n&&null!=n.leftOffset?n.leftOffset:0,g=n&&null!=n.topOffset?n.topOffset:0,h=u,p=d;if(t.self===t)s=Math.min(c.width,t.innerWidth),f=Math.min(c.height,t.innerHeight),i=c.left+t.pageXOffset-t.innerWidth*h+s*h,r=c.top+t.pageYOffset-t.innerHeight*p+f*p,r-=g,a=(i-=m)-t.pageXOffset,o=r-t.pageYOffset;else{s=c.width,f=c.height,l=t.getBoundingClientRect();var E=c.left-(l.left-t.scrollLeft),S=c.top-(l.top-t.scrollTop);i=E+s*h-t.clientWidth*h,r=S+f*p-t.clientHeight*p,i=Math.max(Math.min(i,t.scrollWidth-t.clientWidth),0),r=Math.max(Math.min(r,t.scrollHeight-t.clientHeight),0),r-=g,a=(i-=m)-t.scrollLeft,o=r-t.scrollTop}return{x:i,y:r,differenceX:a,differenceY:o}}function animate(e){var t=e._scrollSettings;if(t){var n=getTargetScrollLocation(t.target,e,t.align),l=Date.now()-t.startTime,i=Math.min(1/t.time*l,1);if(l>t.time&&t.endIterations>3)return setElementScroll(e,n.x,n.y),e._scrollSettings=null,t.end(COMPLETE);t.endIterations++;var r=1-t.ease(i);if(setElementScroll(e,n.x-n.differenceX*r,n.y-n.differenceY*r),l>=t.time)return animate(e);raf(animate.bind(null,e))}}function transitionScrollTo(e,t,n,l){var i,r=!t._scrollSettings,a=t._scrollSettings,o=Date.now();function s(e){t._scrollSettings=null,t.parentElement&&t.parentElement._scrollSettings&&t.parentElement._scrollSettings.end(e),l(e),t.removeEventListener("touchstart",i,{passive:!0})}a&&a.end(CANCELED),t._scrollSettings={startTime:a?a.startTime:Date.now(),endIterations:0,target:e,time:n.time+(a?o-a.startTime:0),ease:n.ease,align:n.align,end:s},i=s.bind(null,CANCELED),t.addEventListener("touchstart",i,{passive:!0}),r&&animate(t)}function defaultIsScrollable(e){return"pageXOffset"in e||(e.scrollHeight!==e.clientHeight||e.scrollWidth!==e.clientWidth)&&"hidden"!==getComputedStyle(e).overflow}function defaultValidTarget(){return!0}module.exports=function(e,t,n){if(e){"function"==typeof t&&(n=t,t=null),t||(t={}),t.time=isNaN(t.time)?1e3:t.time,t.ease=t.ease||function(e){return 1-Math.pow(1-e,e/2)};for(var l=e.parentElement,i=0,r=t.validTarget||defaultValidTarget,a=t.isScrollable;l;){if(r(l,i)&&(a?a(l,defaultIsScrollable):defaultIsScrollable(l))&&(i++,transitionScrollTo(e,l,t,o)),!(l=l.parentElement))return;"BODY"===l.tagName&&(l=(l=l.ownerDocument).defaultView||l.ownerWindow)}}function o(e){--i||n&&n(e)}};

},{}],32:[function(require,module,exports){
module.exports=require("./zen-observable.js").Observable;

},{"./zen-observable.js":33}],33:[function(require,module,exports){
"use strict";!function(r,t){"undefined"!=typeof exports?r(exports,module):"undefined"!=typeof self&&r(self)}(function(r,t){function n(r){return"function"==typeof Symbol&&Boolean(Symbol[r])}function e(r){return n(r)?Symbol[r]:"@@"+r}function o(r,t){var n=r[t];if(null!=n){if("function"!=typeof n)throw new TypeError(n+" is not a function");return n}}function i(r){var t=e("species");return t?r[t]:r}function c(r,t){Object.keys(t).forEach(function(n){var e=Object.getOwnPropertyDescriptor(t,n);e.enumerable=!1,Object.defineProperty(r,n,e)})}function u(r){var t=r._cleanup;t&&(r._cleanup=void 0,t())}function s(r){return void 0===r._observer}function f(r){s(r)||(r._observer=void 0,u(r))}function a(r,t){if(Object(r)!==r)throw new TypeError("Observer must be an object");this._cleanup=void 0,this._observer=r;var n=o(r,"start");if(n&&n.call(r,this),!s(this)){r=new l(this);try{var e=t.call(void 0,r);if(null!=e){if("function"==typeof e.unsubscribe)i=e,e=function(r){i.unsubscribe()};else if("function"!=typeof e)throw new TypeError(e+" is not a function");this._cleanup=e}}catch(t){return void r.error(t)}var i;s(this)&&u(this)}}function l(r){this._subscription=r}function b(r){if("function"!=typeof r)throw new TypeError("Observable initializer must be a function");this._subscriber=r}c(a.prototype={},{get closed(){return s(this)},unsubscribe:function(){f(this)}}),c(l.prototype={},{get closed(){return s(this._subscription)},next:function(r){var t=this._subscription;if(!s(t)){var n=t._observer;try{var e=o(n,"next");if(!e)return;return e.call(n,r)}catch(r){try{f(t)}finally{throw r}}}},error:function(r){var t=this._subscription;if(s(t))throw r;var n=t._observer;t._observer=void 0;try{var e=o(n,"error");if(!e)throw r;r=e.call(n,r)}catch(r){try{u(t)}finally{throw r}}return u(t),r},complete:function(r){var t=this._subscription;if(!s(t)){var n=t._observer;t._observer=void 0;try{var e=o(n,"complete");r=e?e.call(n,r):void 0}catch(r){try{u(t)}finally{throw r}}return u(t),r}}}),c(b.prototype,{subscribe:function(r){for(var t=[],n=1;n<arguments.length;++n)t.push(arguments[n]);return"function"==typeof r&&(r={next:r,error:t[0],complete:t[1]}),new a(r,this._subscriber)},forEach:function(r){var t=this;return new Promise(function(n,e){if("function"!=typeof r)return Promise.reject(new TypeError(r+" is not a function"));t.subscribe({_subscription:null,start:function(r){if(Object(r)!==r)throw new TypeError(r+" is not an object");this._subscription=r},next:function(t){var n=this._subscription;if(!n.closed)try{return r(t)}catch(r){e(r),n.unsubscribe()}},error:e,complete:n})})},map:function(r){var t=this;if("function"!=typeof r)throw new TypeError(r+" is not a function");return new(i(this.constructor))(function(n){return t.subscribe({next:function(t){if(!n.closed){try{t=r(t)}catch(r){return n.error(r)}return n.next(t)}},error:function(r){return n.error(r)},complete:function(r){return n.complete(r)}})})},filter:function(r){var t=this;if("function"!=typeof r)throw new TypeError(r+" is not a function");return new(i(this.constructor))(function(n){return t.subscribe({next:function(t){if(!n.closed){try{if(!r(t))return}catch(r){return n.error(r)}return n.next(t)}},error:function(r){return n.error(r)},complete:function(){return n.complete()}})})},reduce:function(r){var t=this;if("function"!=typeof r)throw new TypeError(r+" is not a function");var n=i(this.constructor),e=arguments.length>1,o=!1,c=arguments[1];return new n(function(n){return t.subscribe({next:function(t){if(!n.closed){var i=!o;if(o=!0,!i||e)try{c=r(c,t)}catch(r){return n.error(r)}else c=t}},error:function(r){return n.error(r)},complete:function(){o||e?(n.next(c),n.complete()):n.error(new TypeError("Cannot reduce an empty sequence"))}})})},flatMap:function(r){var t=this;if("function"!=typeof r)throw new TypeError(r+" is not a function");return new(i(this.constructor))(function(n){var e=!1,o=[],i=t.subscribe({next:function(t){if(r)try{t=r(t)}catch(r){return void n.error(r)}b.from(t).subscribe({_subscription:null,start:function(r){o.push(this._subscription=r)},next:function(r){n.next(r)},error:function(r){n.error(r)},complete:function(){var r=o.indexOf(this._subscription);r>=0&&o.splice(r,1),c()}})},error:function(r){return n.error(r)},complete:function(){e=!0,c()}});function c(){e&&0===o.length&&n.complete()}return function(r){o.forEach(function(r){return r.unsubscribe()}),i.unsubscribe()}})}}),Object.defineProperty(b.prototype,e("observable"),{value:function(){return this},writable:!0,configurable:!0}),c(b,{from:function(r){var t="function"==typeof this?this:b;if(null==r)throw new TypeError(r+" is not an object");var i=o(r,e("observable"));if(i){var c=i.call(r);if(Object(c)!==c)throw new TypeError(c+" is not an object");return c.constructor===t?c:new t(function(r){return c.subscribe(r)})}if(n("iterator")&&(i=o(r,e("iterator"))))return new t(function(t){for(var n,e=i.call(r)[Symbol.iterator]();!(n=e.next()).done;){var o=n.value;if(t.next(o),t.closed)return}t.complete()});if(Array.isArray(r))return new t(function(t){for(var n=0;n<r.length;++n)if(t.next(r[n]),t.closed)return;t.complete()});throw new TypeError(r+" is not observable")},of:function(){for(var r=[],t=0;t<arguments.length;++t)r.push(arguments[t]);return new("function"==typeof this?this:b)(function(t){for(var n=0;n<r.length;++n)if(t.next(r[n]),t.closed)return;t.complete()})}}),Object.defineProperty(b,e("species"),{get:function(){return this},configurable:!0}),r.Observable=b});

},{}],34:[function(require,module,exports){
module.exports='<hypothesis-adder-toolbar class="annotator-adder js-adder">\n  <hypothesis-adder-actions class="annotator-adder-actions">\n    <button class="annotator-adder-actions__button h-icon-annotate js-annotate-btn">\n      <span class="annotator-adder-actions__label" data-action="comment">Annotate</span>\n    </button>\n    <button class="annotator-adder-actions__button h-icon-highlight js-highlight-btn">\n      <span class="annotator-adder-actions__label" data-action="highlight">Highlight</span>\n    </button>\n  </hypothesis-adder-actions>\n</hypothesis-adder-toolbar>\n';

},{}],35:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var classnames=require("classnames"),template=require("./adder.html"),ANNOTATE_BTN_SELECTOR=".js-annotate-btn",HIGHLIGHT_BTN_SELECTOR=".js-highlight-btn",ARROW_POINTING_DOWN=1,ARROW_POINTING_UP=2;function toPx(e){return e.toString()+"px"}var ARROW_HEIGHT=10,ARROW_H_MARGIN=20;function attachShadow(e){return e.attachShadow?e.attachShadow({mode:"open"}):e.createShadowRoot?e.createShadowRoot():null}function nearestPositionedAncestor(e){for(var t=e.parentElement;t.parentElement&&"static"===getComputedStyle(t).position;)t=t.parentElement;return t}function createAdderDOM(e){var t,n=attachShadow(e);if(n){n.innerHTML=template,t=n.querySelector(".js-adder");var i=Array.from(document.styleSheets).map(function(e){return e.href}).filter(function(e){return(e||"").match(/(icomoon|annotator)\.css/)}),r=document.createElement("style");r.textContent=i.map(function(e){return'@import "'+e+'";'}).join("\n"),n.appendChild(r)}else e.innerHTML=template,t=e.querySelector(".js-adder");return t}var Adder=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.element=createAdderDOM(t),this._container=t,Object.assign(t.style,{display:"block",position:"absolute",top:0,zIndex:999}),this.element.style.visibility="hidden",this._view=this.element.ownerDocument.defaultView,this._enterTimeout=null;var r=function(e,t){e.preventDefault(),e.stopPropagation(),t(),i.hide()};this.element.querySelector(ANNOTATE_BTN_SELECTOR).addEventListener("click",function(e){return r(e,n.onAnnotate)}),this.element.querySelector(HIGHLIGHT_BTN_SELECTOR).addEventListener("click",function(e){return r(e,n.onHighlight)}),this._width=function(){return i.element.getBoundingClientRect().width},this._height=function(){return i.element.getBoundingClientRect().height}}return _createClass(e,[{key:"hide",value:function(){clearTimeout(this._enterTimeout),this.element.className=classnames({"annotator-adder":!0}),this.element.style.visibility="hidden"}},{key:"target",value:function(e,t){var n,i,r;n=t?ARROW_POINTING_DOWN:ARROW_POINTING_UP;var a=Math.min(ARROW_H_MARGIN,e.width);return r=t?e.left-this._width()/2+a:e.left+e.width-this._width()/2-a,e.top-this._height()<0&&n===ARROW_POINTING_DOWN?n=ARROW_POINTING_UP:e.top+this._height()>this._view.innerHeight&&(n=ARROW_POINTING_DOWN),i=n===ARROW_POINTING_UP?e.top+e.height+ARROW_HEIGHT:e.top-this._height()-ARROW_HEIGHT,r=Math.max(r,0),r=Math.min(r,this._view.innerWidth-this._width()),i=Math.max(i,0),{top:i=Math.min(i,this._view.innerHeight-this._height()),left:r,arrowDirection:n}}},{key:"showAt",value:function(e,t,n){var i=this;this.element.className=classnames({"annotator-adder":!0,"annotator-adder--arrow-down":n===ARROW_POINTING_DOWN,"annotator-adder--arrow-up":n===ARROW_POINTING_UP}),this.element.querySelector(ANNOTATE_BTN_SELECTOR).style.display="",this.element.querySelector(HIGHLIGHT_BTN_SELECTOR).style.display="";var r=nearestPositionedAncestor(this._container).getBoundingClientRect();Object.assign(this._container.style,{top:toPx(t-r.top),left:toPx(e-r.left)}),this.element.style.visibility="visible",clearTimeout(this._enterTimeout),this._enterTimeout=setTimeout(function(){i.element.className+=" is-active"},1)}}]),e}();module.exports={ARROW_POINTING_DOWN:ARROW_POINTING_DOWN,ARROW_POINTING_UP:ARROW_POINTING_UP,Adder:Adder};

},{"./adder.html":34,"classnames":2}],36:[function(require,module,exports){
var FragmentAnchor,RangeAnchor,TextPositionAnchor,TextQuoteAnchor,querySelector,ref;ref=require("./types"),FragmentAnchor=ref.FragmentAnchor,RangeAnchor=ref.RangeAnchor,TextPositionAnchor=ref.TextPositionAnchor,TextQuoteAnchor=ref.TextQuoteAnchor,querySelector=function(e,r,n,t){return new Promise(function(o,c){try{return o(e.fromSelector(r,n,t).toRange(t))}catch(e){return c(e)}})},exports.anchor=function(e,r,n){var t,o,c,u,l,a,h,i,f,s;for(null==n&&(n={}),t=null,l=null,h=null,i=null,o=0,c=(f=null!=r?r:[]).length;o<c;o++)switch((s=f[o]).type){case"FragmentSelector":t=s;break;case"TextPositionSelector":l=s,n.hint=l.start;break;case"TextQuoteSelector":h=s;break;case"RangeSelector":i=s}return u=function(e){if(null!=(null!=h?h.exact:void 0)&&e.toString()!==h.exact)throw new Error("quote mismatch");return e},a=Promise.reject("unable to anchor"),null!=t&&(a=a.catch(function(){return querySelector(FragmentAnchor,e,t,n).then(u)})),null!=i&&(a=a.catch(function(){return querySelector(RangeAnchor,e,i,n).then(u)})),null!=l&&(a=a.catch(function(){return querySelector(TextPositionAnchor,e,l,n).then(u)})),null!=h&&(a=a.catch(function(){return querySelector(TextQuoteAnchor,e,h,n)})),a},exports.describe=function(e,r,n){var t,o,c;return null==n&&(n={}),c=[FragmentAnchor,RangeAnchor,TextPositionAnchor,TextQuoteAnchor],function(){var u,l,a;for(a=[],u=0,l=c.length;u<l;u++){o=c[u];try{t=o.fromRange(e,r,n),a.push(t.toSelector(n))}catch(e){continue}}return a}()};

},{"./types":39}],37:[function(require,module,exports){
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _iterableToArrayLimit(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}var seek=require("dom-seek"),createNodeIterator=require("dom-node-iterator/polyfill")(),xpathRange=require("./range"),html=require("./html"),RenderingStates=require("../pdfjs-rendering-states"),_require=require("./types"),TextPositionAnchor=_require.TextPositionAnchor,TextQuoteAnchor=_require.TextQuoteAnchor,pageTextCache={},quotePositionCache={};function getSiblingIndex(e){return Array.from(e.parentNode.childNodes).indexOf(e)}function getNodeTextLayer(e){for(;!e.classList||!e.classList.contains("page");)e=e.parentNode;return e.getElementsByClassName("textLayer")[0]}function getPage(e){return PDFViewerApplication.pdfViewer.getPageView(e)}function getPageTextContent(e){if(pageTextCache[e])return pageTextCache[e];return pageTextCache[e]=getPage(e).pdfPage.getTextContent({normalizeWhitespace:!0}).then(function(e){return e.items.filter(function(e){return/\S/.test(e.str)}).map(function(e){return e.str}).join("")}),pageTextCache[e]}function getPageOffset(e){var t=-1;return function r(n){return++t===e?Promise.resolve(n):getPageTextContent(t).then(function(e){return r(n+e.length)})}(0)}function findPage(e){var t=0,r=0;return getPageTextContent(0).then(function n(o){var a=PDFViewerApplication.pdfViewer.pagesCount-1;return r+o.length>e||t===a?(e=r,Promise.resolve({index:t,offset:e,textContent:o})):(++t,r+=o.length,getPageTextContent(t).then(n))})}function anchorByPosition(e,t,r){var n=!1;if(e.textLayer&&(n=e.textLayer.renderingDone),e.renderingState===RenderingStates.FINISHED&&n){var o=e.textLayer.textLayerDiv,a=t.toSelector(r);return html.anchor(o,[a])}var i=e.div||e.el,c=i.getElementsByClassName("annotator-placeholder")[0];c||((c=document.createElement("span")).classList.add("annotator-placeholder"),c.textContent="Loading annotations…",i.appendChild(c));var u=document.createRange();return u.setStartBefore(c),u.setEndAfter(c),u}function findInPages(e,t,r){if(0===e.length)return Promise.reject(new Error("Quote not found"));var n=_toArray(e),o=n[0],a=n.slice(1),i=getPageTextContent(o),c=getPage(o),u=getPageOffset(o);return Promise.all([c,i,u]).then(function(e){var n=_slicedToArray(e,3),o=n[1],a=n[2],i={textContent:o},c=TextQuoteAnchor.fromSelector(i,t);if(r){var u=r.start-a;return u=Math.max(0,u),u=Math.min(u,o.length),c.toPositionAnchor({hint:u})}return c.toPositionAnchor()}).then(function(e){return r&&(quotePositionCache[t.exact]||(quotePositionCache[t.exact]={}),quotePositionCache[t.exact][r.start]={page:c,anchor:e}),anchorByPosition(c,e)}).catch(function(){return findInPages(a,t,r)})}function prioritizePages(e){var t=PDFViewerApplication.pdfViewer.pagesCount,r=Array(t).fill(0).map(function(e,t){return t});if(!e)return Promise.resolve(r);return findPage(e.start).then(function(e){return function(e){for(var t=r.slice(0,e),n=r.slice(e),o=[];t.length>0||n.length>0;)n.length&&o.push(n.shift()),t.length&&o.push(t.pop());return o}(e.index)})}function anchor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.find(function(e){return"TextPositionSelector"===e.type}),o=t.find(function(e){return"TextQuoteSelector"===e.type}),a=Promise.reject("unable to anchor");return n&&(a=a.catch(function(){return findPage(n.start).then(function(t){var a=t.index,i=t.offset,c=t.textContent,u=getPage(a),s=n.start-i,l=n.end-i,f=l-s;return function(e){if(o&&o.exact!==e.toString())throw new Error("quote mismatch")}(c.substr(s,f)),anchorByPosition(u,new TextPositionAnchor(e,s,l),r)})})),o&&(a=a.catch(function(){if(n&&quotePositionCache[o.exact]&&quotePositionCache[o.exact][n.start]){var e=quotePositionCache[o.exact][n.start];return anchorByPosition(e.page,e.anchor,r)}return prioritizePages(n).then(function(e){return findInPages(e,o,n)})})),a}function describe(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new xpathRange.BrowserRange(t).normalize(),o=getNodeTextLayer(n.start),a=getNodeTextLayer(n.end);if(o!==a)return Promise.reject(new Error("selecting across page breaks is not supported"));var i=n.limit(o),c=n.limit(a),u=getSiblingIndex(o.parentNode),s=createNodeIterator.call(document,o,NodeFilter.SHOW_TEXT),l=seek(s,n.start),f=seek(s,n.end)+l+n.end.textContent.length;return getPageOffset(u).then(function(t){var n=new TextPositionAnchor(e,l+=t,f+=t).toSelector(r),o=document.createRange();o.setStartBefore(i.start),o.setEndAfter(c.end);var a=TextQuoteAnchor.fromRange(e,o,r).toSelector(r);return Promise.all([n,a])})}function purgeCache(){pageTextCache={},quotePositionCache={}}module.exports={anchor:anchor,describe:describe,purgeCache:purgeCache};

},{"../pdfjs-rendering-states":58,"./html":36,"./range":38,"./types":39,"dom-node-iterator/polyfill":20,"dom-seek":22}],38:[function(require,module,exports){
var $,Range,Util,extend=function(t,e){for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;$=require("jquery"),Util=require("./util"),(Range={}).sniff=function(t){return null!=t.commonAncestorContainer?new Range.BrowserRange(t):"string"==typeof t.start?new Range.SerializedRange(t):t.start&&"object"==typeof t.start?new Range.NormalizedRange(t):(console.error("Could not sniff range type"),!1)},Range.nodeFromXPath=function(t,e){var n,r,o,s,i;return null==e&&(e=document),r=function(t,n){null==n&&(n=null);try{return document.evaluate("."+t,e,n,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(n){return n,console.log("XPath evaluation failed."),console.log("Trying fallback..."),Util.nodeFromXPath(t,e)}},$.isXMLDoc(document.documentElement)?(n=document.createNSResolver(null===document.ownerDocument?document.documentElement:document.ownerDocument.documentElement),(s=r(t,n))||(t=function(){var e,n,r,o;for(o=[],e=0,n=(r=t.split("/")).length;e<n;e++)(i=r[e])&&-1===i.indexOf(":")?o.push(i.replace(/^([a-z]+)/,"xhtml:$1")):o.push(i);return o}().join("/"),o=document.lookupNamespaceURI(null),s=r(t,n=function(t){return"xhtml"===t?o:document.documentElement.getAttribute("xmlns:"+t)})),s):r(t)},Range.RangeError=function(t){function e(t,n,r){this.type=t,this.message=n,this.parent=null!=r?r:null,e.__super__.constructor.call(this,this.message)}return extend(e,t),e}(Error),Range.BrowserRange=function(){function t(t){this.commonAncestorContainer=t.commonAncestorContainer,this.startContainer=t.startContainer,this.startOffset=t.startOffset,this.endContainer=t.endContainer,this.endOffset=t.endOffset}return t.prototype.normalize=function(t){var e,n,r,o;if(this.tainted)return console.error("You may only call normalize() once on a BrowserRange!"),!1;if(this.tainted=!0,o={},this.startContainer.nodeType===Node.ELEMENT_NODE?(this.startOffset<this.startContainer.childNodes.length?o.start=Util.getFirstTextNodeNotBefore(this.startContainer.childNodes[this.startOffset]):o.start=Util.getFirstTextNodeNotBefore(this.startContainer),o.startOffset=0):(o.start=this.startContainer,o.startOffset=this.startOffset),this.endContainer.nodeType===Node.ELEMENT_NODE){if(null!=(n=this.endContainer.childNodes[this.endOffset])){for(e=n;null!=e&&e.nodeType!==Node.TEXT_NODE;)e=e.firstChild;null!=e&&(o.end=e,o.endOffset=0)}null==o.end&&(n=this.endOffset?this.endContainer.childNodes[this.endOffset-1]:this.endContainer.previousSibling,o.end=Util.getLastTextNodeUpTo(n),o.endOffset=o.end.nodeValue.length)}else o.end=this.endContainer,o.endOffset=this.endOffset;for(r={},o.startOffset>0?!o.start.nextSibling||o.start.nodeValue.length>o.startOffset?r.start=o.start.splitText(o.startOffset):r.start=o.start.nextSibling:r.start=o.start,o.start===o.end?(r.start.nodeValue.length>o.endOffset-o.startOffset&&r.start.splitText(o.endOffset-o.startOffset),r.end=r.start):(o.end.nodeValue.length>o.endOffset&&o.end.splitText(o.endOffset),r.end=o.end),r.commonAncestor=this.commonAncestorContainer;r.commonAncestor.nodeType!==Node.ELEMENT_NODE;)r.commonAncestor=r.commonAncestor.parentNode;return new Range.NormalizedRange(r)},t.prototype.serialize=function(t,e){return this.normalize(t).serialize(t,e)},t}(),Range.NormalizedRange=function(){function t(t){this.commonAncestor=t.commonAncestor,this.start=t.start,this.end=t.end}return t.prototype.normalize=function(t){return this},t.prototype.limit=function(t){var e,n,r,o,s,i;if(!(r=$.grep(this.textNodes(),function(e){return e.parentNode===t||$.contains(t,e.parentNode)})).length)return null;for(this.start=r[0],this.end=r[r.length-1],i=$(this.start).parents(),e=0,n=(s=$(this.end).parents()).length;e<n;e++)if(o=s[e],-1!==i.index(o)){this.commonAncestor=o;break}return this},t.prototype.serialize=function(t,e){var n,r,o;return o=(r=function(n,r){var o,s,i,a,f,l,d;for(f=e?$(n).parents(":not("+e+")").eq(0):$(n).parent(),d=Util.xpathFromNode(f,t)[0],a=0,o=0,s=(i=(l=Util.getTextNodes(f)).slice(0,l.index(n))).length;o<s;o++)a+=i[o].nodeValue.length;return r?[d,a+n.nodeValue.length]:[d,a]})(this.start),n=r(this.end,!0),new Range.SerializedRange({start:o[0],end:n[0],startOffset:o[1],endOffset:n[1]})},t.prototype.text=function(){var t;return function(){var e,n,r,o;for(o=[],e=0,n=(r=this.textNodes()).length;e<n;e++)t=r[e],o.push(t.nodeValue);return o}.call(this).join("")},t.prototype.textNodes=function(){var t,e,n,r;return n=(e=[(r=Util.getTextNodes($(this.commonAncestor))).index(this.start),r.index(this.end)])[0],t=e[1],$.makeArray(r.slice(n,+t+1||9e9))},t.prototype.toRange=function(){var t;return(t=document.createRange()).setStartBefore(this.start),t.setEndAfter(this.end),t},t}(),Range.SerializedRange=function(){function t(t){this.start=t.start,this.startOffset=t.startOffset,this.end=t.end,this.endOffset=t.endOffset}return t.prototype.normalize=function(t){var e,n,r,o,s,i,a,f,l,d,u,c,h,m;for(d={},r=0,s=(u=["start","end"]).length;r<s;r++){l=u[r];try{f=Range.nodeFromXPath(this[l],t)}catch(t){throw n=t,new Range.RangeError(l,"Error while finding "+l+" node: "+this[l]+": "+n,n)}if(!f)throw new Range.RangeError(l,"Couldn't find "+l+" node: "+this[l]);for(a=0,h=this[l+"Offset"],"end"===l&&h--,o=0,i=(c=Util.getTextNodes($(f))).length;o<i;o++){if(a+(m=c[o]).nodeValue.length>h){d[l+"Container"]=m,d[l+"Offset"]=this[l+"Offset"]-a;break}a+=m.nodeValue.length}if(null==d[l+"Offset"])throw new Range.RangeError(l+"offset","Couldn't find offset "+this[l+"Offset"]+" in element "+this[l])}return e=null==document.compareDocumentPosition?function(t,e){return t.contains(e)}:function(t,e){return 16&t.compareDocumentPosition(e)},$(d.startContainer).parents().each(function(){if(e(this,d.endContainer))return d.commonAncestorContainer=this,!1}),new Range.BrowserRange(d).normalize(t)},t.prototype.serialize=function(t,e){return this.normalize(t).serialize(t,e)},t.prototype.toObject=function(){return{start:this.start,startOffset:this.startOffset,end:this.end,endOffset:this.endOffset}},t}(),module.exports=Range;

},{"./util":40,"jquery":"jquery"}],39:[function(require,module,exports){
var RangeAnchor,TextPositionAnchor,TextQuoteAnchor,domAnchorTextPosition,domAnchorTextQuote,missingParameter,xpathRange;domAnchorTextPosition=require("dom-anchor-text-position"),domAnchorTextQuote=require("dom-anchor-text-quote"),xpathRange=require("./range"),missingParameter=function(t){throw new Error('missing required parameter "'+t+'"')},RangeAnchor=function(){function t(t,e){null==t&&missingParameter("root"),null==e&&missingParameter("range"),this.root=t,this.range=xpathRange.sniff(e).normalize(this.root)}return t.fromRange=function(e,o){return new t(e,o)},t.fromSelector=function(e,o){var n;return n={start:o.startContainer,startOffset:o.startOffset,end:o.endContainer,endOffset:o.endOffset},new t(e,new xpathRange.SerializedRange(n))},t.prototype.toRange=function(){return this.range.toRange()},t.prototype.toSelector=function(t){var e;return null==t&&(t={}),{type:"RangeSelector",startContainer:(e=this.range.serialize(this.root,t.ignoreSelector)).start,startOffset:e.startOffset,endContainer:e.end,endOffset:e.endOffset}},t}(),TextPositionAnchor=function(){function t(t,e,o){this.root=t,this.start=e,this.end=o}return t.fromRange=function(e,o){var n;return n=domAnchorTextPosition.fromRange(e,o),t.fromSelector(e,n)},t.fromSelector=function(e,o){return new t(e,o.start,o.end)},t.prototype.toSelector=function(){return{type:"TextPositionSelector",start:this.start,end:this.end}},t.prototype.toRange=function(){return domAnchorTextPosition.toRange(this.root,{start:this.start,end:this.end})},t}(),TextQuoteAnchor=function(){function t(t,e,o){null==o&&(o={}),this.root=t,this.exact=e,this.context=o}return t.fromRange=function(e,o,n){var r;return r=domAnchorTextQuote.fromRange(e,o,n),t.fromSelector(e,r)},t.fromSelector=function(e,o){var n,r;return n=o.prefix,r=o.suffix,new t(e,o.exact,{prefix:n,suffix:r})},t.prototype.toSelector=function(){return{type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}},t.prototype.toRange=function(t){var e;if(null==t&&(t={}),null===(e=domAnchorTextQuote.toRange(this.root,this.toSelector(),t)))throw new Error("Quote not found");return e},t.prototype.toPositionAnchor=function(t){var e;if(null==t&&(t={}),null===(e=domAnchorTextQuote.toTextPosition(this.root,this.toSelector(),t)))throw new Error("Quote not found");return new TextPositionAnchor(this.root,e.start,e.end)},t}(),exports.RangeAnchor=RangeAnchor,exports.FragmentAnchor=require("dom-anchor-fragment"),exports.TextPositionAnchor=TextPositionAnchor,exports.TextQuoteAnchor=TextQuoteAnchor;

},{"./range":38,"dom-anchor-fragment":6,"dom-anchor-text-position":7,"dom-anchor-text-quote":10}],40:[function(require,module,exports){
var $,Util,ref,simpleXPathJQuery,simpleXPathPure;$=require("jquery"),ref=require("./xpath"),simpleXPathJQuery=ref.simpleXPathJQuery,simpleXPathPure=ref.simpleXPathPure,(Util={}).flatten=function(e){var t;return(t=function(e){var r,o,l,i;for(o=[],l=0,i=e.length;l<i;l++)r=e[l],o=o.concat(r&&$.isArray(r)?t(r):r);return o})(e)},Util.getTextNodes=function(e){var t;return t=function(e){var r;if(e&&e.nodeType!==Node.TEXT_NODE){if(r=[],e.nodeType!==Node.COMMENT_NODE)for(e=e.lastChild;e;)r.push(t(e)),e=e.previousSibling;return r.reverse()}return e},e.map(function(){return Util.flatten(t(this))})},Util.getLastTextNodeUpTo=function(e){var t;switch(e.nodeType){case Node.TEXT_NODE:return e;case Node.ELEMENT_NODE:if(null!=e.lastChild&&null!=(t=Util.getLastTextNodeUpTo(e.lastChild)))return t}return null!=(e=e.previousSibling)?Util.getLastTextNodeUpTo(e):null},Util.getFirstTextNodeNotBefore=function(e){var t;switch(e.nodeType){case Node.TEXT_NODE:return e;case Node.ELEMENT_NODE:if(null!=e.firstChild&&null!=(t=Util.getFirstTextNodeNotBefore(e.firstChild)))return t}return null!=(e=e.nextSibling)?Util.getFirstTextNodeNotBefore(e):null},Util.xpathFromNode=function(e,t){var r;try{r=simpleXPathJQuery.call(e,t)}catch(o){o,console.log("jQuery-based XPath construction failed! Falling back to manual."),r=simpleXPathPure.call(e,t)}return r},Util.nodeFromXPath=function(e,t){var r,o,l,i,n,a,u;for(n=t,r=0,l=(u=e.substring(1).split("/")).length;r<l;r++)i=(a=u[r].split("["))[0],o=null!=(o=a[1])?parseInt((null!=o?o.split("]"):void 0)[0]):1,n=findChild(n,i.toLowerCase(),o);return n},module.exports={nodeFromXPath:Util.nodeFromXPath,xpathFromNode:Util.xpathFromNode,getTextNodes:Util.getTextNodes,getFirstTextNodeNotBefore:Util.getFirstTextNodeNotBefore,getLastTextNodeUpTo:Util.getLastTextNodeUpTo};

},{"./xpath":41,"jquery":"jquery"}],41:[function(require,module,exports){
var $,findChild,getNodeName,getNodePosition,simpleXPathJQuery,simpleXPathPure;$=require("jquery"),simpleXPathJQuery=function(e){return this.map(function(){var t,r,o,n;for(o="",t=this;(null!=t?t.nodeType:void 0)===Node.ELEMENT_NODE&&t!==e;)n=t.tagName.replace(":","\\:"),r="["+(r=$(t.parentNode).children(n).index(t)+1)+"]",o="/"+t.tagName.toLowerCase()+r+o,t=t.parentNode;return o}).get()},simpleXPathPure=function(e){var t,r,o;return t=function(e){return getNodeName(e)+"["+getNodePosition(e)+"]"},o=e,r=function(e){var r;for(r="";e!==o;){if(null==e)throw new Error("Called getPathTo on a node which was not a descendant of @rootNode. "+o);r=t(e)+"/"+r,e=e.parentNode}return r=(r="/"+r).replace(/\/$/,"")},this.map(function(){return r(this)}).get()},findChild=function(e,t,r){var o,n,a,i,d;if(!e.hasChildNodes())throw new Error("XPath error: node has no children!");for(a=0,i=0,d=(n=e.childNodes).length;i<d;i++)if(o=n[i],getNodeName(o)===t&&(a+=1)===r)return o;throw new Error("XPath error: wanted child not found.")},getNodeName=function(e){var t;switch(t=e.nodeName.toLowerCase()){case"#text":return"text()";case"#comment":return"comment()";case"#cdata-section":return"cdata-section()";default:return t}},getNodePosition=function(e){var t,r;for(t=0,r=e;r;)r.nodeName===e.nodeName&&t++,r=r.previousSibling;return t},module.exports={simpleXPathJQuery:simpleXPathJQuery,simpleXPathPure:simpleXPathPure};

},{"jquery":"jquery"}],42:[function(require,module,exports){
"use strict";var events=require("../shared/bridge-events"),ANNOTATION_COUNT_ATTR="data-hypothesis-annotation-count";function annotationCounts(t,n){n.on(events.PUBLIC_ANNOTATION_COUNT_CHANGED,function(n){var o=t.querySelectorAll("["+ANNOTATION_COUNT_ATTR+"]");Array.from(o).forEach(function(t){t.textContent=n})})}module.exports=annotationCounts;

},{"../shared/bridge-events":73}],43:[function(require,module,exports){
"use strict";function AnnotationSync(t,n){var o=this;if(this.bridge=t,!n.on)throw new Error("options.on unspecified for AnnotationSync.");if(!n.emit)throw new Error("options.emit unspecified for AnnotationSync.");this.cache={},this._on=n.on,this._emit=n.emit,Object.keys(this._eventListeners).forEach(function(t){var n=o._eventListeners[t];o._on(t,function(t){n.apply(o,[t])})}),Object.keys(this._channelListeners).forEach(function(t){o.bridge.on(t,function(n,e){o._channelListeners[t].apply(o,[n,e])})})}AnnotationSync.prototype.cache=null,AnnotationSync.prototype.sync=function(t){var n;return t=function(){var n,o=[];for(n=0;n<t.length;n++)o.push(this._format(t[n]));return o}.call(this),this.bridge.call("sync",t,(n=this,function(t,o){var e,i=[];for(o=o||[],e=0;e<o.length;e++)i.push(n._parse(o[e]));return i})),this},AnnotationSync.prototype._channelListeners={deleteAnnotation:function(t,n){var o=this._parse(t);delete this.cache[o.$tag],this._emit("annotationDeleted",o),n(null,this._format(o))},loadAnnotations:function(t,n){var o=function(){var n,o=[];for(n=0;n<t.length;n++)o.push(this._parse(t[n]));return o}.call(this);return this._emit("annotationsLoaded",o),n(null,o)}},AnnotationSync.prototype._eventListeners={beforeAnnotationCreated:function(t){if(!t.$tag)return this._mkCallRemotelyAndParseResults("beforeCreateAnnotation")(t)}},AnnotationSync.prototype._mkCallRemotelyAndParseResults=function(t,n){return o=this,function(e){o.bridge.call(t,o._format(e),function(t,e){null===t&&o._parseResults(e),"function"==typeof n&&n(t,e)})};var o},AnnotationSync.prototype._parseResults=function(t){var n,o,e,i;for(e=0;e<t.length;e++)for(n=t[e],n=[].concat(n),i=0;i<n.length;i++)null!==(o=n[i])&&this._parse(o)},AnnotationSync.prototype._tag=function(t,n){return t.$tag?t:(n=n||window.btoa(Math.random()),Object.defineProperty(t,"$tag",{value:n}),this.cache[n]=t,t)},AnnotationSync.prototype._parse=function(t){var n=Object.assign(this.cache[t.tag]||{},t.msg);return this._tag(n,t.tag)},AnnotationSync.prototype._format=function(t){return this._tag(t),{tag:t.$tag,msg:t}},module.exports=AnnotationSync;

},{}],44:[function(require,module,exports){
"use strict";function configFuncSettingsFrom(o){if(!o.hasOwnProperty("hypothesisConfig"))return{};if("function"!=typeof o.hypothesisConfig){return console.warn("hypothesisConfig must be a function, see: https://h.readthedocs.io/projects/client/en/latest/publishers/config/#window.hypothesisConfig"),{}}return o.hypothesisConfig()}module.exports=configFuncSettingsFrom;

},{}],45:[function(require,module,exports){
"use strict";var settingsFrom=require("./settings");function configFrom(e){var t=settingsFrom(e);return{annotations:t.annotations,assetRoot:t.hostPageSetting("assetRoot",{allowInBrowserExt:!0}),branding:t.hostPageSetting("branding"),clientUrl:t.clientUrl,enableExperimentalNewNoteButton:t.hostPageSetting("enableExperimentalNewNoteButton"),theme:t.hostPageSetting("theme"),usernameUrl:t.hostPageSetting("usernameUrl"),onLayoutChange:t.hostPageSetting("onLayoutChange"),openSidebar:t.hostPageSetting("openSidebar",{allowInBrowserExt:!0}),query:t.query,requestConfigFromFrame:t.hostPageSetting("requestConfigFromFrame"),services:t.hostPageSetting("services"),showHighlights:t.showHighlights,sidebarAppUrl:t.sidebarAppUrl,subFrameIdentifier:t.hostPageSetting("subFrameIdentifier",{allowInBrowserExt:!0}),externalContainerSelector:t.hostPageSetting("externalContainerSelector")}}module.exports=configFrom;

},{"./settings":47}],46:[function(require,module,exports){
"use strict";function isBrowserExtension(t){return!(t.startsWith("http://")||t.startsWith("https://"))}module.exports=isBrowserExtension;

},{}],47:[function(require,module,exports){
"use strict";var configFuncSettingsFrom=require("./config-func-settings-from"),isBrowserExtension=require("./is-browser-extension"),sharedSettings=require("../../shared/settings");function settingsFrom(t){var r=sharedSettings.jsonConfigsFrom(t.document),n=configFuncSettingsFrom(t);function e(){var r=t.document.querySelector('link[type="application/annotator+html"][rel="sidebar"]');if(!r)throw new Error('No application/annotator+html (rel="sidebar") link in the document');if(!r.href)throw new Error('application/annotator+html (rel="sidebar") link has no href');return r.href}function o(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.allowInBrowserExt||!1,a=void 0!==o.defaultValue;return!i&&isBrowserExtension(e())?a?o.defaultValue:null:n.hasOwnProperty(t)?n[t]:r.hasOwnProperty(t)?r[t]:a?o.defaultValue:null}return{get annotations(){return r.annotations||((n=t.location.href.match(/#annotations:([A-Za-z0-9_-]+)$/))?n[1]:null);var n},get clientUrl(){return function(){var r=t.document.querySelector('link[type="application/annotator+javascript"][rel="hypothesis-client"]');if(!r)throw new Error('No application/annotator+javascript (rel="hypothesis-client") link in the document');if(!r.href)throw new Error('application/annotator+javascript (rel="hypothesis-client") link has no href');return r.href}()},get showHighlights(){return null===(t=o("showHighlights"))&&(t="always"),"boolean"==typeof t?t?"always":"never":t;var t},get sidebarAppUrl(){return e()},get query(){return r.query||function(){var r=t.location.href.match(/#annotations:(query|q):(.+)$/i);if(r)try{return decodeURIComponent(r[2])}catch(t){}return null}()},hostPageSetting:o}}module.exports=settingsFrom;

},{"../../shared/settings":77,"./config-func-settings-from":44,"./is-browser-extension":46}],48:[function(require,module,exports){
var $,Delegator,slice=[].slice,hasProp={}.hasOwnProperty;$=require("jquery"),module.exports=Delegator=function(){function e(e,t){this.options=$.extend(!0,{},this.options,t),this.element=$(e),this._closures={},this.on=this.subscribe,this.addEvents()}return e.prototype.events={},e.prototype.options={},e.prototype.element=null,e.prototype.destroy=function(){return this.removeEvents()},e.prototype.addEvents=function(){var t,n,s,r,o;for(o=[],n=0,s=(r=e._parseEvents(this.events)).length;n<s;n++)t=r[n],o.push(this._addEvent(t.selector,t.event,t.functionName));return o},e.prototype.removeEvents=function(){var t,n,s,r,o;for(o=[],n=0,s=(r=e._parseEvents(this.events)).length;n<s;n++)t=r[n],o.push(this._removeEvent(t.selector,t.event,t.functionName));return o},e.prototype._addEvent=function(t,n,s){var r,o;return o=this,r=function(){return o[s].apply(o,arguments)},""===t&&e._isCustomEvent(n)?this.subscribe(n,r):this.element.delegate(t,n,r),this._closures[t+"/"+n+"/"+s]=r,this},e.prototype._removeEvent=function(t,n,s){var r;return r=this._closures[t+"/"+n+"/"+s],""===t&&e._isCustomEvent(n)?this.unsubscribe(n,r):this.element.undelegate(t,n,r),delete this._closures[t+"/"+n+"/"+s],this},e.prototype.publish=function(){return this.element.triggerHandler.apply(this.element,arguments),this},e.prototype.subscribe=function(e,t){var n;return(n=function(){return t.apply(this,[].slice.call(arguments,1))}).guid=t.guid=$.guid+=1,this.element.bind(e,n),this},e.prototype.unsubscribe=function(){return this.element.unbind.apply(this.element,arguments),this},e}(),Delegator._parseEvents=function(e){var t,n,s,r,o,i,u;for(i in n=[],e)s=e[i],u=2<=(o=i.split(" ")).length?slice.call(o,0,r=o.length-1):(r=0,[]),t=o[r++],n.push({selector:u.join(" "),event:t,functionName:s});return n},Delegator.natives=function(){var e,t;return t=function(){var t,n;for(e in n=[],t=$.event.special)hasProp.call(t,e)&&(t[e],n.push(e));return n}(),"blur focus focusin focusout load resize scroll unload click dblclick\nmousedown mouseup mousemove mouseover mouseout mouseenter mouseleave\nchange select submit keydown keypress keyup error".split(/[^a-z]+/).concat(t)}(),Delegator._isCustomEvent=function(e){return e=e.split(".")[0],-1===$.inArray(e,Delegator.natives)};

},{"jquery":"jquery"}],49:[function(require,module,exports){
"use strict";var events=require("../shared/bridge-events"),_features={},_set=function(e){_features=e||{}};module.exports={init:function(e){e.on(events.FEATURE_FLAGS_UPDATED,_set)},reset:function(){_set({})},flagEnabled:function(e){return e in _features?_features[e]:(console.warn("looked up unknown feature",e),!1)}};

},{"../shared/bridge-events":73}],50:[function(require,module,exports){
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var FrameUtil=require("./util/frame-util"),debounce=require("lodash.debounce"),difference=function(e,r){return e.filter(function(e){return!r.includes(e)})},DEBOUNCE_WAIT=40,FrameObserver=function(){function e(r){var t=this;_classCallCheck(this,e),this._target=r,this._handledFrames=[],this._mutationObserver=new MutationObserver(debounce(function(){t._discoverFrames()},DEBOUNCE_WAIT))}return _createClass(e,[{key:"observe",value:function(e,r){this._onFrameAdded=e,this._onFrameRemoved=r,this._discoverFrames(),this._mutationObserver.observe(this._target,{childList:!0,subtree:!0})}},{key:"disconnect",value:function(){this._mutationObserver.disconnect()}},{key:"_addFrame",value:function(e){var r=this;FrameUtil.isAccessible(e)&&FrameUtil.isDocumentReady(e,function(){e.contentWindow.addEventListener("unload",function(){r._removeFrame(e)}),r._handledFrames.push(e),r._onFrameAdded(e)})}},{key:"_removeFrame",value:function(e){this._onFrameRemoved(e),this._handledFrames=this._handledFrames.filter(function(r){return r!==e})}},{key:"_discoverFrames",value:function(){var e=FrameUtil.findFrames(this._target),r=!0,t=!1,n=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;this._handledFrames.includes(s)||this._addFrame(s)}}catch(e){t=!0,n=e}finally{try{r||null==i.return||i.return()}finally{if(t)throw n}}var o=!0,l=!1,u=void 0;try{for(var d,c=difference(this._handledFrames,e)[Symbol.iterator]();!(o=(d=c.next()).done);o=!0){var f=d.value;this._removeFrame(f)}}catch(e){l=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(l)throw u}}}}]),e}();FrameObserver.DEBOUNCE_WAIT=DEBOUNCE_WAIT,module.exports=FrameObserver;

},{"./util/frame-util":70,"lodash.debounce":27}],51:[function(require,module,exports){
var $,CustomEvent,Delegator,Guest,adder,animationPromise,extend,highlighter,normalizeURI,raf,rangeUtil,scrollIntoView,selections,xpathRange,extend1=function(t,n){for(var e in n)hasProp.call(n,e)&&(t[e]=n[e]);function o(){this.constructor=t}return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},hasProp={}.hasOwnProperty,slice=[].slice,indexOf=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1};extend=require("extend"),raf=require("raf"),scrollIntoView=require("scroll-into-view"),CustomEvent=require("custom-event"),Delegator=require("./delegator"),$=require("jquery"),adder=require("./adder"),highlighter=require("./highlighter"),rangeUtil=require("./range-util"),selections=require("./selections"),xpathRange=require("./anchoring/range"),normalizeURI=require("./util/url").normalizeURI,animationPromise=function(t){return new Promise(function(n,e){return raf(function(){try{return n(t())}catch(t){return e(t)}})})},module.exports=Guest=function(t){function n(t,e){var o,i,r,a,s,l;for(i in n.__super__.constructor.apply(this,arguments),this.adder=$(this.html.adder).appendTo(this.element).hide(),s=this,this.adderCtrl=new adder.Adder(this.adder[0],{onAnnotate:function(){return s.createAnnotation(),document.getSelection().removeAllRanges()},onHighlight:function(){return s.setVisibleHighlights(!0),s.createHighlight(),document.getSelection().removeAllRanges()}}),this.selections=selections(document).subscribe({next:function(t){return t?s._onSelection(t):s._onClearSelection()}}),this.plugins={},this.anchors=[],this.frameIdentifier=e.subFrameIdentifier||null,o={config:e,on:(l=this,function(t,n){return l.subscribe(t,n)}),emit:function(t){return function(){var n,e;return e=arguments[0],n=2<=arguments.length?slice.call(arguments,1):[],t.publish(e,n)}}(this)},this.addPlugin("CrossFrame",o),this.crossframe=this.plugins.CrossFrame,this.crossframe.onConnect(function(t){return function(){return t._setupInitialState(e)}}(this)),this._connectAnnotationSync(this.crossframe),this._connectAnnotationUISync(this.crossframe),a=this.options)hasProp.call(a,i)&&(r=a[i],!this.plugins[i]&&this.options.pluginClasses[i]&&this.addPlugin(i,r))}return extend1(n,Delegator),"annotator-highlights-always-on",n.prototype.events={".annotator-hl click":"onHighlightClick",".annotator-hl mouseover":"onHighlightMouseover",".annotator-hl mouseout":"onHighlightMouseout",click:"onElementClick",touchstart:"onElementTouchStart"},n.prototype.options={Document:{},TextSelection:{}},n.prototype.anchoring=require("./anchoring/html"),n.prototype.plugins=null,n.prototype.anchors=null,n.prototype.visibleHighlights=!1,n.prototype.frameIdentifier=null,n.prototype.html={adder:"<hypothesis-adder></hypothesis-adder>"},n.prototype.addPlugin=function(t,n){var e,o;return this.plugins[t]?console.error("You cannot have more than one instance of any plugin."):"function"==typeof(o=this.options.pluginClasses[t])?(this.plugins[t]=new o(this.element[0],n),this.plugins[t].annotator=this,"function"==typeof(e=this.plugins[t]).pluginInit&&e.pluginInit()):console.error("Could not load "+t+" plugin. Have you included the appropriate <script> tag?"),this},n.prototype.getDocumentInfo=function(){var t,n,e;return null!=this.plugins.PDF?(t=Promise.resolve(this.plugins.PDF.getMetadata()),n=Promise.resolve(this.plugins.PDF.uri())):null!=this.plugins.Document?(n=Promise.resolve(this.plugins.Document.uri()),t=Promise.resolve(this.plugins.Document.metadata)):(n=Promise.reject(),t=Promise.reject()),n=n.catch(function(){return decodeURIComponent(window.location.href)}),t=t.catch(function(){return{title:document.title,link:[{href:decodeURIComponent(window.location.href)}]}}),Promise.all([t,n]).then((e=this,function(t){var n,o;return o=t[0],n=t[1],{uri:normalizeURI(n),metadata:o,frameIdentifier:e.frameIdentifier}}))},n.prototype._setupInitialState=function(t){return this.publish("panelReady"),this.setVisibleHighlights("always"===t.showHighlights)},n.prototype._connectAnnotationSync=function(t){var n;return this.subscribe("annotationDeleted",(n=this,function(t){return n.detach(t)})),this.subscribe("annotationsLoaded",function(t){return function(n){var e,o,i,r;for(r=[],o=0,i=n.length;o<i;o++)e=n[o],r.push(t.anchor(e));return r}}(this))},n.prototype._connectAnnotationUISync=function(t){var n;return t.on("focusAnnotations",(n=this,function(t){var e,o,i,r,a,s,l;for(null==t&&(t=[]),s=[],o=0,i=(r=n.anchors).length;o<i;o++)null!=(e=r[o]).highlights&&(a=e.annotation.$tag,l=indexOf.call(t,a)>=0,s.push($(e.highlights).toggleClass("annotator-hl-focused",l)));return s})),t.on("scrollToAnnotation",function(t){return function(n){var e,o,i,r,a,s;for(s=[],i=0,r=(a=t.anchors).length;i<r;i++)null!=(e=a[i]).highlights&&(e.annotation.$tag===n?(o=new CustomEvent("scrolltorange",{bubbles:!0,cancelable:!0,detail:e.range}),t.element[0].dispatchEvent(o)?s.push(scrollIntoView(e.highlights[0])):s.push(void 0)):s.push(void 0));return s}}(this)),t.on("getDocumentInfo",function(t){return function(n){return t.getDocumentInfo().then(function(t){return n(null,t)}).catch(function(t){return n(t)})}}(this)),t.on("setVisibleHighlights",function(t){return function(n){return t.setVisibleHighlights(n)}}(this))},n.prototype.destroy=function(){var t,e;for(t in $("#annotator-dynamic-style").remove(),this.selections.unsubscribe(),this.adder.remove(),this.element.find(".annotator-hl").each(function(){return $(this).contents().insertBefore(this),$(this).remove()}),this.element.data("annotator",null),e=this.plugins)e[t],this.plugins[t].destroy();return n.__super__.destroy.apply(this,arguments)},n.prototype.anchor=function(t){var n,e,o,i,r,a,s,l,h,u,c,g,p,f,d,m,v;for(d=this,f=this.element[0],o=[],e=[],i=[],null==t.target&&(t.target=[]),u=function(n){var e,o;return(null!=(o=n.selector)?o:[]).some(function(t){return"TextQuoteSelector"===t.type})?(e={cache:d.anchoringCache,ignoreSelector:'[class^="annotator-"]'},d.anchoring.anchor(f,n.selector,e).then(function(e){return{annotation:t,target:n,range:e}}).catch(function(){return{annotation:t,target:n}})):Promise.resolve({annotation:t,target:n})},r=function(t){return null==t.range?t:animationPromise(function(){var n,e;return e=xpathRange.sniff(t.range).normalize(f),n=highlighter.highlightRange(e),$(n).data("annotation",t.annotation),t.highlights=n,t})},m=function(n){var e,o,i,r,a,s,l;for(o=!1,i=!1,r=0,a=n.length;r<a;r++)if(null!=(e=n[r]).target.selector&&(o=!0,null!=e.range)){i=!0;break}return t.$orphan=o&&!i,d.anchors=d.anchors.concat(n),null!=(s=d.plugins.BucketBar)&&s.update(),null!=(l=d.plugins.CrossFrame)&&l.sync([t]),n},a=0,l=(c=d.anchors.splice(0,d.anchors.length)).length;a<l;a++)(n=c[a]).annotation===t?null!=n.range&&(g=n.target,indexOf.call(t.target,g)>=0)?(o.push(n),e.push(n.target)):null!=n.highlights&&(i=i.concat(n.highlights),delete n.highlights,delete n.range):d.anchors.push(n);for(raf(function(){return highlighter.removeHighlights(i)}),s=0,h=(p=t.target).length;s<h;s++)v=p[s],indexOf.call(e,v)<0&&(n=u(v).then(r),o.push(n));return Promise.all(o).then(m)},n.prototype.detach=function(t){var n,e,o,i,r,a,s,l,h;for(e=[],[],l=[],o=0,i=(r=this.anchors).length;o<i;o++)(n=r[o]).annotation===t?l.push(null!=(a=n.highlights)?a:[]):e.push(n);return this.anchors=e,l=(s=Array.prototype).concat.apply(s,l),raf((h=this,function(){var t;return highlighter.removeHighlights(l),null!=(t=h.plugins.BucketBar)?t.update():void 0}))},n.prototype.createAnnotation=function(t){var n,e,o,i,r,a,s,l,h,u,c;return null==t&&(t={}),l=this,a=this.element[0],o=null!=(i=this.selectedRanges)?i:[],this.selectedRanges=null,n=function(t){var n;return n={cache:l.anchoringCache,ignoreSelector:'[class^="annotator-"]'},l.anchoring.describe(a,t,n)},h=function(n){return t.document=n.metadata,t.uri=n.uri},u=function(n){var e,o,i,r;return e=n[0],i=n[1],r=e.uri,t.target=function(){var t,n,e;for(e=[],t=0,n=i.length;t<n;t++)o=i[t],e.push({source:r,selector:o});return e}()},e=this.getDocumentInfo(),s=Promise.all(o.map(n)),e.then(h),(c=Promise.all([e,s]).then(u)).then(function(){return l.publish("beforeAnnotationCreated",[t])}),c.then(function(){return l.anchor(t)}),t.$highlight||null!=(r=this.crossframe)&&r.call("showSidebar"),t},n.prototype.createHighlight=function(){return this.createAnnotation({$highlight:!0})},n.prototype.createComment=function(){var t,n,e;return t={},e=this,n=function(n){return t.document=n.metadata,t.uri=n.uri,t.target=[{source:n.uri}]},this.getDocumentInfo().then(n).then(function(){return e.publish("beforeAnnotationCreated",[t])}),t},n.prototype.deleteAnnotation=function(t){var n,e,o,i;if(null!=t.highlights)for(e=0,o=(i=t.highlights).length;e<o;e++)null!=(n=i[e]).parentNode&&$(n).replaceWith(n.childNodes);return this.publish("annotationDeleted",[t]),t},n.prototype.showAnnotations=function(t){var n,e,o,i;return i=function(){var e,o,i;for(i=[],e=0,o=t.length;e<o;e++)n=t[e],i.push(n.$tag);return i}(),null!=(e=this.crossframe)&&e.call("showAnnotations",i),null!=(o=this.crossframe)?o.call("showSidebar"):void 0},n.prototype.toggleAnnotationSelection=function(t){var n,e,o;return o=function(){var e,o,i;for(i=[],e=0,o=t.length;e<o;e++)n=t[e],i.push(n.$tag);return i}(),null!=(e=this.crossframe)?e.call("toggleAnnotationSelection",o):void 0},n.prototype.updateAnnotations=function(t){var n,e,o;return o=function(){var e,o,i;for(i=[],e=0,o=t.length;e<o;e++)n=t[e],i.push(n.$tag);return i}(),null!=(e=this.crossframe)?e.call("updateAnnotations",o):void 0},n.prototype.focusAnnotations=function(t){var n,e,o;return o=function(){var e,o,i;for(i=[],e=0,o=t.length;e<o;e++)n=t[e],i.push(n.$tag);return i}(),null!=(e=this.crossframe)?e.call("focusAnnotations",o):void 0},n.prototype._onSelection=function(t){var n,e,o,i,r,a,s;if(a=document.getSelection(),o=rangeUtil.isSelectionBackwards(a),e=rangeUtil.selectionFocusRect(a))return this.selectedRanges=[t],$(".annotator-toolbar .h-icon-note").attr("title","New Annotation").removeClass("h-icon-note").addClass("h-icon-annotate"),i=(r=this.adderCtrl.target(e,o)).left,s=r.top,n=r.arrowDirection,this.adderCtrl.showAt(i,s,n);this._onClearSelection()},n.prototype._onClearSelection=function(){return this.adderCtrl.hide(),this.selectedRanges=[],$(".annotator-toolbar .h-icon-annotate").attr("title","New Page Note").removeClass("h-icon-annotate").addClass("h-icon-note")},n.prototype.selectAnnotations=function(t,n){return n?this.toggleAnnotationSelection(t):this.showAnnotations(t)},n.prototype.onElementClick=function(t){var n,e;if(!(null!=(n=this.selectedTargets)?n.length:void 0))return null!=(e=this.crossframe)?e.call("hideSidebar"):void 0},n.prototype.onElementTouchStart=function(t){var n,e;if(!(null!=(n=this.selectedTargets)?n.length:void 0))return null!=(e=this.crossframe)?e.call("hideSidebar"):void 0},n.prototype.onHighlightMouseover=function(t){var n,e,o;if(this.visibleHighlights)return n=$(t.currentTarget).data("annotation"),(e=null!=t.annotations?t.annotations:t.annotations=[]).push(n),t.target===t.currentTarget?setTimeout((o=this,function(){return o.focusAnnotations(e)})):void 0},n.prototype.onHighlightMouseout=function(t){if(this.visibleHighlights)return this.focusAnnotations([])},n.prototype.onHighlightClick=function(t){var n,e,o,i;if(this.visibleHighlights)return n=$(t.currentTarget).data("annotation"),(e=null!=t.annotations?t.annotations:t.annotations=[]).push(n),t.target===t.currentTarget?(o=t.metaKey||t.ctrlKey,setTimeout((i=this,function(){return i.selectAnnotations(e,o)}))):void 0},n.prototype.setVisibleHighlights=function(t){return this.toggleHighlightClass(t)},n.prototype.toggleHighlightClass=function(t){return t?this.element.addClass("annotator-highlights-always-on"):this.element.removeClass("annotator-highlights-always-on"),this.visibleHighlights=t},n}();

},{"./adder":35,"./anchoring/html":36,"./anchoring/range":38,"./delegator":48,"./highlighter":53,"./range-util":66,"./selections":67,"./util/url":72,"custom-event":3,"extend":24,"jquery":"jquery","raf":30,"scroll-into-view":31}],52:[function(require,module,exports){
var $;$=require("jquery"),exports.highlightRange=function(t,e){var n,r;return null==e&&(e="annotator-hl"),r=/^\s*$/,n=$("<hypothesis-highlight class='"+e+"'></hypothesis-highlight>"),$(t.textNodes()).filter(function(t){return!r.test(this.nodeValue)}).wrap(n).parent().toArray()},exports.removeHighlights=function(t){var e,n,r,o;for(o=[],n=0,r=t.length;n<r;n++)null!=(e=t[n]).parentNode&&o.push($(e).replaceWith(e.childNodes));return o},exports.getBoundingClientRect=function(t){return t.map(function(t){return t.getBoundingClientRect()}).reduce(function(t,e){return{top:Math.min(t.top,e.top),left:Math.min(t.left,e.left),bottom:Math.max(t.bottom,e.bottom),right:Math.max(t.right,e.right)}})};

},{"jquery":"jquery"}],53:[function(require,module,exports){
"use strict";var overlayFlagEnabled,domWrapHighlighter=require("./dom-wrap-highlighter"),overlayHighlighter=require("./overlay-highlighter"),features=require("../features"),highlighterFacade={};Object.keys(domWrapHighlighter).forEach(function(e){highlighterFacade[e]=function(){void 0===overlayFlagEnabled&&(overlayFlagEnabled=features.flagEnabled("overlay_highlighter"));for(var r=overlayFlagEnabled?overlayHighlighter[e]:domWrapHighlighter[e],a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return r.apply(null,l)}}),module.exports=highlighterFacade;

},{"../features":49,"./dom-wrap-highlighter":52,"./overlay-highlighter":54}],54:[function(require,module,exports){
"use strict";module.exports={highlightRange:function(){console.log("highlightRange not implemented")},removeHighlights:function(){console.log("removeHighlights not implemented")},getBoundingClientRect:function(){console.log("getBoundingClientRect not implemented")}};

},{}],55:[function(require,module,exports){
var $,Guest,Host,extend=function(e,t){for(var r in t)hasProp.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};$=require("jquery"),Guest=require("./guest"),module.exports=Host=function(e){function t(e,r){var n,o,s,i,a,u,d;(null!=(i=r.services)?i[0]:void 0)&&((a=r.services[0]).onLoginRequest&&(a.onLoginRequestProvided=!0),a.onLogoutRequest&&(a.onLogoutRequestProvided=!0),a.onSignupRequest&&(a.onSignupRequestProvided=!0),a.onProfileRequest&&(a.onProfileRequestProvided=!0),a.onHelpRequest&&(a.onHelpRequestProvided=!0)),o="config="+encodeURIComponent(JSON.stringify(Object.assign({},r,{sidebarAppUrl:void 0,pluginClasses:void 0}))),u=r.sidebarAppUrl&&indexOf.call(r.sidebarAppUrl,"?")>=0?r.sidebarAppUrl+"&"+o:r.sidebarAppUrl+"?"+o,n=$("<iframe></iframe>").attr("name","hyp_sidebar_frame").attr("allowfullscreen","").attr("seamless","").attr("src",u).attr("title","Hypothesis annotation viewer").addClass("h-sidebar-iframe"),s=null,r.externalContainerSelector&&(s=document.querySelector(r.externalContainerSelector)),s?this.externalFrame=$(s):(this.frame=$("<div></div>").css("display","none").addClass("annotator-frame annotator-outer"),"clean"===r.theme&&this.frame.addClass("annotator-frame--drop-shadow-enabled"),this.frame.appendTo(e)),t.__super__.constructor.apply(this,arguments),n.appendTo(this.frame||this.externalFrame),this.on("panelReady",(d=this,function(){var e;return null!=(e=d.frame)?e.css("display",""):void 0})),this.on("beforeAnnotationCreated",function(e){if(!e.$highlight)return n[0].contentWindow.focus()})}return extend(t,Guest),t.prototype.destroy=function(){var e;return null!=(e=this.frame)&&e.remove(),t.__super__.destroy.apply(this,arguments)},t}();

},{"./guest":51,"jquery":"jquery"}],56:[function(require,module,exports){
"use strict";var configFrom=require("./config/index"),$=require("jquery"),Guest=require("./guest"),Sidebar=require("./sidebar"),PdfSidebar=require("./pdf-sidebar"),pluginClasses={BucketBar:require("./plugin/bucket-bar"),Toolbar:require("./plugin/toolbar"),PDF:require("./plugin/pdf"),Document:require("./plugin/document"),CrossFrame:require("./plugin/cross-frame")},appLinkEl=document.querySelector('link[type="application/annotator+html"][rel="sidebar"]'),config=configFrom(window);$.noConflict(!0)(function(){var e=window.PDFViewerApplication?PdfSidebar:Sidebar;config.hasOwnProperty("constructor")&&(e=config.constructor,delete config.constructor),config.subFrameIdentifier&&(void 0!==window.PDFViewerApplication&&(config.PDF={}),e=Guest,window.__hypothesis_frame=!0),config.pluginClasses=pluginClasses;var i=new e(document.body,config);appLinkEl.addEventListener("destroy",function(){appLinkEl.parentElement.removeChild(appLinkEl),i.destroy()})});

},{"./config/index":45,"./guest":51,"./pdf-sidebar":57,"./plugin/bucket-bar":60,"./plugin/cross-frame":61,"./plugin/document":62,"./plugin/pdf":64,"./plugin/toolbar":65,"./sidebar":69,"jquery":"jquery"}],57:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Sidebar=require("./sidebar"),DEFAULT_CONFIG={TextSelection:{},PDF:{},BucketBar:{container:".annotator-frame",scrollables:["#viewerContainer"]},Toolbar:{container:".annotator-frame"}},PdfSidebar=function(t){function e(t,o){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,Object.assign({},DEFAULT_CONFIG,o)))}return _inherits(e,Sidebar),e}();module.exports=PdfSidebar;

},{"./sidebar":69}],58:[function(require,module,exports){
"use strict";var RenderingStates={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3};module.exports=RenderingStates;

},{}],59:[function(require,module,exports){
var Delegator,Plugin,extend=function(t,o){for(var r in o)hasProp.call(o,r)&&(t[r]=o[r]);function e(){this.constructor=t}return e.prototype=o.prototype,t.prototype=new e,t.__super__=o.prototype,t},hasProp={}.hasOwnProperty;Delegator=require("./delegator"),module.exports=Plugin=function(t){function o(t,r){o.__super__.constructor.apply(this,arguments)}return extend(o,Delegator),o.prototype.pluginInit=function(){},o}();

},{"./delegator":48}],60:[function(require,module,exports){
var $,BUCKET_NAV_SIZE,BUCKET_SIZE,BUCKET_TOP_THRESHOLD,BucketBar,Plugin,highlighter,raf,scrollIntoView,scrollToClosest,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};raf=require("raf"),$=require("jquery"),Plugin=require("../plugin"),scrollIntoView=require("scroll-into-view"),highlighter=require("../highlighter"),BUCKET_TOP_THRESHOLD=115+(BUCKET_NAV_SIZE=(BUCKET_SIZE=16)+6),scrollToClosest=function(t,e){var n,i;return n="up"===e?1:-1,i=t.reduce(function(t,e){var r,o,s;return(null!=(o=e.highlights)?o.length:void 0)?(s=t.start,i=t.next,r=highlighter.getBoundingClientRect(e.highlights),1===n&&r.top>=BUCKET_TOP_THRESHOLD?t:-1===n&&r.top<=window.innerHeight-BUCKET_NAV_SIZE?t:null==i?{start:r.top,next:e}:s*n<r.top*n?{start:r.top,next:e}:t):t},{}).next,scrollIntoView(i.highlights[0])},module.exports=BucketBar=function(t){function e(t,n){var i;this.update=bind(this.update,this),e.__super__.constructor.call(this,$(this.html),n),null!=this.options.container?$(this.options.container).append(this.element):$(t).append(this.element),this.highlighter=null!=(i=n.highlighter)?i:highlighter}return extend(e,Plugin),e.prototype.html='<div class="annotator-bucket-bar">\n</div>',e.prototype.options={gapSize:60,scrollables:["body"]},e.prototype.buckets=[],e.prototype.index=[],e.prototype.tabs=null,e.prototype.pluginInit=function(){var t,e,n,i,r,o;for($(window).on("resize scroll",this.update),r=[],t=0,e=(i=null!=(n=this.options.scrollables)?n:[]).length;t<e;t++)o=i[t],r.push($(o).on("resize scroll",this.update));return r},e.prototype.destroy=function(){var t,e,n,i,r,o;for($(window).off("resize scroll",this.update),r=[],t=0,e=(i=null!=(n=this.options.scrollables)?n:[]).length;t<e;t++)o=i[t],r.push($(o).off("resize scroll",this.update));return r},e.prototype._collate=function(t,e){var n,i,r;for(n=i=0,r=t.length-1;0<=r?i<=r:i>=r;n=0<=r?++i:--i){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return 0},e.prototype.update=function(){var t;if(null==this._updatePending)return this._updatePending=raf((t=this,function(){return delete t._updatePending,t._update()}))},e.prototype._update=function(){var t,e,n,i,r,o,s,h,l,u,a;for(t=[],n=[],h=this.annotator.anchors.reduce((a=this,function(e,i,r){var o,s,h,l;return(null!=(h=i.highlights)?h.length:void 0)?(l=(s=a.highlighter.getBoundingClientRect(i.highlights)).top,o=s.bottom-s.top,l<BUCKET_TOP_THRESHOLD?indexOf.call(t,i)<0&&t.push(i):l>window.innerHeight-BUCKET_NAV_SIZE?indexOf.call(n,i)<0&&n.push(i):(e.push([l,1,i]),e.push([l+o,-1,i])),e):e}),[]),l=h.sort(this._collate).reduce(function(t){return function(e,n,i,r){var o,s,h,l,u,a,c,p,g,d,f,_,T,b,E,v;if(h=e.buckets,a=e.index,l=e.carry,v=n[0],u=n[1],o=n[2],u>0?(c=l.anchors.indexOf(o))<0?(l.anchors.unshift(o),l.counts.unshift(1)):l.counts[c]++:(c=l.anchors.indexOf(o),0==--l.counts[c]&&(l.anchors.splice(c,1),l.counts.splice(c,1))),0===a.length||i===r.length-1||0===l.anchors.length||v-a[a.length-1]>t.options.gapSize)h.push(l.anchors.slice()),a.push(v);else{for((null!=(T=h[h.length-2])?T.length:void 0)?(d=h[h.length-2],E=h.pop(),a.pop()):(d=h[h.length-1],E=[]),p=0,f=(b=l.anchors).length;p<f;p++)s=b[p],indexOf.call(d,s)<0&&d.push(s);for(g=0,_=E.length;g<_;g++)s=E[g],indexOf.call(d,s)<0&&d.push(s)}return{buckets:h,index:a,carry:l}}}(this),{buckets:[],index:[],carry:{anchors:[],counts:[],latest:0}}),this.buckets=l.buckets,this.index=l.index,this.buckets.unshift([],t,[]),this.index.unshift(0,BUCKET_TOP_THRESHOLD-1,BUCKET_TOP_THRESHOLD),this.buckets.push([],n,[]),this.index.push(window.innerHeight-BUCKET_NAV_SIZE,window.innerHeight-BUCKET_NAV_SIZE+1,window.innerHeight),s=0,r=0,o=(u=this.buckets).length;r<o;r++)e=u[r],s=Math.max(s,e.length);return i=this.element,this.tabs||(this.tabs=$([])),this.tabs.slice(this.buckets.length).remove(),this.tabs=this.tabs.slice(0,this.buckets.length),$.each(this.buckets.slice(this.tabs.length),function(t){return function(){var e;return e=$("<div/>").appendTo(i),t.tabs.push(e[0]),e.addClass("annotator-bucket-indicator").on("mousemove",function(e){var n,i,r,o,s,h,l;for(i=t.tabs.index(e.currentTarget),h=[],r=0,o=(s=t.annotator.anchors).length;r<o;r++)n=s[r],l=indexOf.call(t.buckets[i],n)>=0,h.push($(n.highlights).toggleClass("annotator-hl-focused",l));return h}).on("mouseout",function(e){var n,i,r,o,s,h;for(i=t.tabs.index(e.currentTarget),h=[],r=0,o=(s=t.buckets[i]).length;r<o;r++)n=s[r],h.push($(n.highlights).removeClass("annotator-hl-focused"));return h}).on("click",function(e){var n,i,r;return r=t.tabs.index(e.currentTarget),e.stopPropagation(),t.isUpper(r)?scrollToClosest(t.buckets[r],"up"):t.isLower(r)?scrollToClosest(t.buckets[r],"down"):(i=function(){var t,e,i,o;for(o=[],t=0,e=(i=this.buckets[r]).length;t<e;t++)n=i[t],o.push(n.annotation);return o}.call(t),t.annotator.selectAnnotations(i,e.ctrlKey||e.metaKey))})}}(this)),this._buildTabs(this.tabs,this.buckets)},e.prototype._buildTabs=function(){return this.tabs.each((t=this,function(e,n){var i,r,o,s;if(n=$(n),s=1!==(r=null!=(i=t.buckets[e])?i.length:void 0)?"Show "+r+" annotations":r>0?"Show one annotation":void 0,n.attr("title",s),n.toggleClass("upper",t.isUpper(e)),n.toggleClass("lower",t.isLower(e)),o=t.isUpper(e)||t.isLower(e)?BUCKET_NAV_SIZE:BUCKET_SIZE,n.css({top:(t.index[e]+t.index[e+1])/2,marginTop:-o/2,display:r?"":"none"}),i)return n.html("<div class='label'>"+r+"</div>")}));var t},e.prototype.isUpper=function(t){return 1===t},e.prototype.isLower=function(t){return t===this.index.length-2},e}(),BucketBar.BUCKET_SIZE=BUCKET_SIZE,BucketBar.BUCKET_NAV_SIZE=BUCKET_NAV_SIZE,BucketBar.BUCKET_TOP_THRESHOLD=BUCKET_TOP_THRESHOLD;

},{"../highlighter":53,"../plugin":59,"jquery":"jquery","raf":30,"scroll-into-view":31}],61:[function(require,module,exports){
var AnnotationSync,Bridge,CrossFrame,Discovery,FrameObserver,FrameUtil,Plugin,extract,slice=[].slice,extend=function(e,r){for(var t in r)hasProp.call(r,t)&&(e[t]=r[t]);function n(){this.constructor=e}return n.prototype=r.prototype,e.prototype=new n,e.__super__=r.prototype,e},hasProp={}.hasOwnProperty;Plugin=require("../plugin"),AnnotationSync=require("../annotation-sync"),Bridge=require("../../shared/bridge"),Discovery=require("../../shared/discovery"),FrameUtil=require("../util/frame-util"),FrameObserver=require("../frame-observer"),extract=extract=function(){var e,r,t,n,i,o;for(i=arguments[0],o={},e=0,n=(t=2<=arguments.length?slice.call(arguments,1):[]).length;e<n;e++)r=t[e],i.hasOwnProperty(r)&&(o[r]=i[r]);return o},module.exports=CrossFrame=function(e){function r(e,t){var n,i,o,s,c,a,u,l,p;r.__super__.constructor.apply(this,arguments),c=t.config,p=extract(t,"server"),a=new Discovery(window,p),s=new Bridge,p=extract(t,"on","emit"),o=new AnnotationSync(s,p),l=new FrameObserver(e),u=new Map,this.pluginInit=function(){var e;return e=function(e,r,t){return s.createChannel(e,r,t)},a.startDiscovery(e),l.observe(i,n)},this.destroy=function(){return Plugin.prototype.destroy.apply(this,arguments),s.destroy(),a.stopDiscovery(),l.disconnect()},this.sync=function(e,r){return o.sync(e,r)},this.on=function(e,r){return s.on(e,r)},this.call=function(){var e,r;return r=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],s.call.apply(s,[r].concat(slice.call(e)))},this.onConnect=function(e){return s.onConnect(e)},i=function(e){var r;if(!FrameUtil.hasHypothesis(e))return r=c.clientUrl,FrameUtil.isLoaded(e,function(){var t,n;return n=a.generateToken(),u.set(e,n),t=Object.assign({},c,{subFrameIdentifier:n}),FrameUtil.injectHypothesis(e,r,t)})},n=function(e){return s.call("destroyFrame",u.get(e)),u.delete(e)}}return extend(r,Plugin),r}();

},{"../../shared/bridge":74,"../../shared/discovery":75,"../annotation-sync":43,"../frame-observer":50,"../plugin":59,"../util/frame-util":70}],62:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var baseURI=require("document-base-uri"),Plugin=require("../plugin"),_require=require("../util/url"),normalizeURI=_require.normalizeURI,DocumentMeta=function(t){function e(t,a){var i;return _classCallCheck(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,a))).events={beforeAnnotationCreated:"beforeAnnotationCreated"},i}return _inherits(e,Plugin),_createClass(e,[{key:"pluginInit",value:function(){this.baseURI=this.options.baseURI||baseURI,this.document=this.options.document||document,this.normalizeURI=this.options.normalizeURI||normalizeURI,this.getDocumentMetadata()}},{key:"uri",value:function(){var t=decodeURIComponent(this._getDocumentHref()),e=!0,a=!1,i=void 0;try{for(var r,n=this.metadata.link[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value;"canonical"===o.rel&&(t=o.href)}}catch(t){a=!0,i=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw i}}return t}},{key:"uris",value:function(){var t={},e=!0,a=!1,i=void 0;try{for(var r,n=this.metadata.link[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value;o.href&&(t[o.href]=!0)}}catch(t){a=!0,i=t}finally{try{e||null==n.return||n.return()}finally{if(a)throw i}}return Object.keys(t)}},{key:"beforeAnnotationCreated",value:function(t){t.document=this.metadata}},{key:"getDocumentMetadata",value:function(){return this.metadata={},this._getHighwire(),this._getDublinCore(),this._getFacebook(),this._getEprints(),this._getPrism(),this._getTwitter(),this._getFavicon(),this._getTitle(),this._getLinks(),this.metadata}},{key:"_getHighwire",value:function(){this.metadata.highwire=this._getMetaTags("citation","name","_")}},{key:"_getFacebook",value:function(){this.metadata.facebook=this._getMetaTags("og","property",":")}},{key:"_getTwitter",value:function(){this.metadata.twitter=this._getMetaTags("twitter","name",":")}},{key:"_getDublinCore",value:function(){this.metadata.dc=this._getMetaTags("dc","name",".")}},{key:"_getPrism",value:function(){this.metadata.prism=this._getMetaTags("prism","name",".")}},{key:"_getEprints",value:function(){this.metadata.eprints=this._getMetaTags("eprints","name",".")}},{key:"_getMetaTags",value:function(t,e,a){for(var i={},r=Array.from(this.document.querySelectorAll("meta")),n=0;n<r.length;n++){var o=r[n],l=o.getAttribute(e),s=o.content;if(l){var u=l.match(RegExp("^".concat(t).concat(a,"(.+)$"),"i"));if(u){var c=u[1];i[c]?i[c].push(s):i[c]=[s]}}}return i}},{key:"_getTitle",value:function(){this.metadata.highwire.title?this.metadata.title=this.metadata.highwire.title[0]:this.metadata.eprints.title?this.metadata.title=this.metadata.eprints.title[0]:this.metadata.prism.title?this.metadata.title=this.metadata.prism.title[0]:this.metadata.facebook.title?this.metadata.title=this.metadata.facebook.title[0]:this.metadata.twitter.title?this.metadata.title=this.metadata.twitter.title[0]:this.metadata.dc.title?this.metadata.title=this.metadata.dc.title[0]:this.metadata.title=this.document.title}},{key:"_getLinks",value:function(){this.metadata.link=[{href:this._getDocumentHref()}];for(var t=Array.from(this.document.querySelectorAll("link")),e=0;e<t.length;e++){var a=t[e];if(["alternate","canonical","bookmark","shortlink"].includes(a.rel)){if("alternate"===a.rel){if(a.type&&a.type.match(/^application\/(rss|atom)\+xml/))continue;if(a.hreflang)continue}try{var i=this._absoluteUrl(a.href);this.metadata.link.push({href:i,rel:a.rel,type:a.type})}catch(t){}}}for(var r=Object.keys(this.metadata.highwire),n=0;n<r.length;n++){var o=r[n],l=this.metadata.highwire[o];if("pdf_url"===o){var s=!0,u=!1,c=void 0;try{for(var h,f=l[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var m=h.value;try{this.metadata.link.push({href:this._absoluteUrl(m),type:"application/pdf"})}catch(t){}}}catch(t){u=!0,c=t}finally{try{s||null==f.return||f.return()}finally{if(u)throw c}}}if("doi"===o){var d=!0,y=!1,p=void 0;try{for(var v,g=l[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var _=v.value;"doi:"!==_.slice(0,4)&&(_="doi:".concat(_)),this.metadata.link.push({href:_})}}catch(t){y=!0,p=t}finally{try{d||null==g.return||g.return()}finally{if(y)throw p}}}}for(var b=Object.keys(this.metadata.dc),k=0;k<b.length;k++){var w=b[k],R=this.metadata.dc[w];if("identifier"===w){var U=!0,I=!1,O=void 0;try{for(var P,C=R[Symbol.iterator]();!(U=(P=C.next()).done);U=!0){var T=P.value;"doi:"===T.slice(0,4)&&this.metadata.link.push({href:T})}}catch(t){I=!0,O=t}finally{try{U||null==C.return||C.return()}finally{if(I)throw O}}}}var S=this.metadata.dc["relation.ispartof"],M=this.metadata.dc.identifier;if(S&&M){var j=S[S.length-1],x=M[M.length-1],A="urn:x-dc:"+encodeURIComponent(j)+"/"+encodeURIComponent(x);this.metadata.link.push({href:A}),this.metadata.documentFingerprint=A}}},{key:"_getFavicon",value:function(){for(var t=Array.from(this.document.querySelectorAll("link")),e=0;e<t.length;e++){var a=t[e];if(["shortcut icon","icon"].includes(a.rel))try{this.metadata.favicon=this._absoluteUrl(a.href)}catch(t){}}}},{key:"_absoluteUrl",value:function(t){return this.normalizeURI(t,this.baseURI)}},{key:"_getDocumentHref",value:function(){var t=this.document.location.href,e=["http:","https:","file:"],a=new URL(t).protocol;return e.includes(a)?t:this.baseURI&&e.includes(new URL(this.baseURI).protocol)?this.baseURI:t}}]),e}();module.exports=DocumentMeta;

},{"../plugin":59,"../util/url":72,"document-base-uri":5}],63:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var _require=require("../util/url"),normalizeURI=_require.normalizeURI,PDFMetadata=function(){function e(t){_classCallCheck(this,e),this._loaded=new Promise(function(e){var n=function n(){window.removeEventListener("documentload",n),window.removeEventListener("documentloaded",n),e(t)};t.downloadComplete?e(t):(window.addEventListener("documentload",n),window.addEventListener("documentloaded",n))})}return _createClass(e,[{key:"getUri",value:function(){return this._loaded.then(function(e){var t=getPDFURL(e);return t||(t=fingerprintToURN(e.pdfDocument.fingerprint)),t})}},{key:"getMetadata",value:function(){return this._loaded.then(function(e){var t=document.title;e.metadata&&e.metadata.has("dc:title")&&"Untitled"!==e.metadata.get("dc:title")?t=e.metadata.get("dc:title"):e.documentInfo&&e.documentInfo.Title&&(t=e.documentInfo.Title);var n=[{href:fingerprintToURN(e.pdfDocument.fingerprint)}],r=getPDFURL(e);return r&&n.push({href:r}),{title:t,link:n,documentFingerprint:e.pdfDocument.fingerprint}})}}]),e}();function fingerprintToURN(e){return"urn:x-pdf:"+String(e)}function getPDFURL(e){var t=normalizeURI(e.url);return 0!==t.indexOf("file://")?t:null}module.exports=PDFMetadata;

},{"../util/url":72}],64:[function(require,module,exports){
var PDF,Plugin,RenderingStates,extend=function(e,t){for(var r in t)hasProp.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};Plugin=require("../plugin"),RenderingStates=require("../pdfjs-rendering-states"),module.exports=PDF=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,Plugin),t.prototype.documentLoaded=null,t.prototype.observer=null,t.prototype.pdfViewer=null,t.prototype.pluginInit=function(){var e,t;return this.annotator.anchoring=require("../anchoring/pdf"),e=require("./pdf-metadata"),this.pdfViewer=PDFViewerApplication.pdfViewer,this.pdfViewer.viewer.classList.add("has-transparent-text-layer"),this.pdfMetadata=new e(PDFViewerApplication),this.observer=new MutationObserver((t=this,function(e){return t._update()})),this.observer.observe(this.pdfViewer.viewer,{attributes:!0,attributeFilter:["data-loaded"],childList:!0,subtree:!0})},t.prototype.destroy=function(){return this.pdfViewer.viewer.classList.remove("has-transparent-text-layer"),this.observer.disconnect()},t.prototype.uri=function(){return this.pdfMetadata.getUri()},t.prototype.getMetadata=function(){return this.pdfMetadata.getMetadata()},t.prototype._update=function(){var e,t,r,n,i,o,a,s,p,u,d,l,h,f,c,g,y,v,w,b,P,x,V,_;for(this,r=this.annotator,V=[],f=i=0,y=(c=this.pdfViewer).pagesCount;0<=y?i<y:i>y;f=0<=y?++i:--i)if(null!=(v=(h=c.getPageView(f)).textLayer)?v.renderingDone:void 0)switch(g=(null!=(w=h.div)?w:h.el).getElementsByClassName("annotator-placeholder")[0],h.renderingState){case RenderingStates.INITIAL:h.textLayer=null;break;case RenderingStates.FINISHED:null!=g&&g.parentNode.removeChild(g)}for(a=0,u=(b=r.anchors).length;a<u;a++)if(null!=(e=b[a]).highlights&&(P=e.annotation,!(indexOf.call(V,P)>=0)))for(o=s=0,d=(x=e.highlights).length;s<d;o=++s)if(n=x[o],!document.body.contains(n)){e.highlights.splice(o,1),delete e.range,V.push(e.annotation);break}for(_=[],p=0,l=V.length;p<l;p++)t=V[p],_.push(r.anchor(t));return _},t}();

},{"../anchoring/pdf":37,"../pdfjs-rendering-states":58,"../plugin":59,"./pdf-metadata":63}],65:[function(require,module,exports){
var $,Plugin,Toolbar,makeButton,extend=function(t,o){for(var e in o)hasProp.call(o,e)&&(t[e]=o[e]);function n(){this.constructor=t}return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t},hasProp={}.hasOwnProperty;Plugin=require("../plugin"),$=require("jquery"),makeButton=function(t){var o;return o=$("<button></button>").attr("href","").attr("title",t.title).attr("name",t.name).on(t.on).addClass("annotator-frame-button").addClass(t.class),$("<li></li>").append(o)[0]},module.exports=Toolbar=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return extend(o,Plugin),"annotator-hide",o.prototype.events={setVisibleHighlights:"onSetVisibleHighlights"},o.prototype.html='<div class="annotator-toolbar"></div>',o.prototype.pluginInit=function(){var t,o,e,n;return this.annotator.toolbar=this.toolbar=$(this.html),null!=this.options.container?$(this.options.container).append(this.toolbar):$(this.element).append(this.toolbar),o=[{title:"Close Sidebar",class:"annotator-frame-button--sidebar_close h-icon-close",name:"sidebar-close",on:{click:(n=this,function(t){return t.preventDefault(),t.stopPropagation(),n.annotator.hide(),n.toolbar.find("[name=sidebar-close]").hide()})}},{title:"Toggle or Resize Sidebar",class:"annotator-frame-button--sidebar_toggle h-icon-chevron-left",name:"sidebar-toggle",on:{click:function(t){return function(o){return o.preventDefault(),o.stopPropagation(),t.annotator.frame.hasClass("annotator-collapsed")?t.annotator.show():t.annotator.hide()}}(this)}},{title:"Hide Highlights",class:"h-icon-visibility",name:"highlight-visibility",on:{click:function(t){return function(o){var e;return o.preventDefault(),o.stopPropagation(),e=!t.annotator.visibleHighlights,t.annotator.setAllVisibleHighlights(e)}}(this)}},{title:"New Page Note",class:"h-icon-note",name:"insert-comment",on:{click:function(t){return function(o){return o.preventDefault(),o.stopPropagation(),t.annotator.createAnnotation(),t.annotator.show()}}(this)}}],this.buttons=$(function(){var e,n,i;for(i=[],e=0,n=o.length;e<n;e++)t=o[e],i.push(makeButton(t));return i}()),e=$("<ul></ul>"),this.buttons.appendTo(e),this.toolbar.append(e),this.toolbar.on("mouseup","a",function(t){return $(t.target).blur()})},o.prototype.onSetVisibleHighlights=function(t){return t?$("[name=highlight-visibility]").removeClass("h-icon-visibility-off").addClass("h-icon-visibility").prop("title","Hide Highlights"):$("[name=highlight-visibility]").removeClass("h-icon-visibility").addClass("h-icon-visibility-off").prop("title","Show Highlights")},o.prototype.disableMinimizeBtn=function(){return $("[name=sidebar-toggle]").remove()},o.prototype.disableHighlightsBtn=function(){return $("[name=highlight-visibility]").remove()},o.prototype.disableNewNoteBtn=function(){return $("[name=insert-comment]").remove()},o.prototype.disableCloseBtn=function(){return $("[name=sidebar-close]").remove()},o.prototype.getWidth=function(){return parseInt(window.getComputedStyle(this.toolbar[0]).width)},o.prototype.hideCloseBtn=function(){return $("[name=sidebar-close]").hide()},o.prototype.showCloseBtn=function(){return $("[name=sidebar-close]").show()},o.prototype.showCollapseSidebarBtn=function(){return $("[name=sidebar-toggle]").removeClass("h-icon-chevron-left").addClass("h-icon-chevron-right")},o.prototype.showExpandSidebarBtn=function(){return $("[name=sidebar-toggle]").removeClass("h-icon-chevron-right").addClass("h-icon-chevron-left")},o}();

},{"../plugin":59,"jquery":"jquery"}],66:[function(require,module,exports){
"use strict";function isSelectionBackwards(e){return e.focusNode===e.anchorNode?e.focusOffset<e.anchorOffset:e.getRangeAt(0).startContainer===e.focusNode}function isNodeInRange(e,n){if(n===e.startContainer||n===e.endContainer)return!0;var t=n.ownerDocument.createRange();t.selectNode(n);var o=e.compareBoundaryPoints(Range.START_TO_START,t)<=0,r=e.compareBoundaryPoints(Range.END_TO_END,t)>=0;return t.detach(),o&&r}function forEachNodeInRange(e,n){for(var t,o=e.commonAncestorContainer,r=o.ownerDocument.createNodeIterator(o,NodeFilter.SHOW_ALL,null,!1);t=r.nextNode();)isNodeInRange(e,t)&&n(t)}function getTextBoundingBoxes(e){var n=/^\s*$/,t=[];forEachNodeInRange(e,function(e){e.nodeType!==Node.TEXT_NODE||e.textContent.match(n)||t.push(e)});var o=[];return t.forEach(function(n){var t=n.ownerDocument.createRange();if(t.selectNodeContents(n),n===e.startContainer&&t.setStart(n,e.startOffset),n===e.endContainer&&t.setEnd(n,e.endOffset),!t.collapsed){var r=Array.from(t.getClientRects());t.detach(),o=o.concat(r)}}),o}function selectionFocusRect(e){if(e.isCollapsed)return null;var n=getTextBoundingBoxes(e.getRangeAt(0));return 0===n.length?null:isSelectionBackwards(e)?n[0]:n[n.length-1]}module.exports={getTextBoundingBoxes:getTextBoundingBoxes,isNodeInRange:isNodeInRange,isSelectionBackwards:isSelectionBackwards,selectionFocusRect:selectionFocusRect};

},{}],67:[function(require,module,exports){
"use strict";var observable=require("./util/observable");function selectedRange(e){var o=e.getSelection();return!o.rangeCount||o.getRangeAt(0).collapsed?null:o.getRangeAt(0)}function selections(e){var o,r=observable.listen(e,["mousedown","mouseup","selectionchange"]).filter(function(e){return"mousedown"===e.type||"mouseup"===e.type?(o="mousedown"===e.type,!1):!o});return observable.merge([observable.buffer(10,observable.listen(e,["mouseup"])),observable.buffer(100,r),observable.delay(0,observable.Observable.of({}))]).map(function(){return selectedRange(e)})}module.exports=selections;

},{"./util/observable":71}],68:[function(require,module,exports){
"use strict";var SIDEBAR_TRIGGER_BTN_ATTR="data-hypothesis-trigger";function trigger(r,t){var e=r.querySelectorAll("["+SIDEBAR_TRIGGER_BTN_ATTR+"]");function o(r){t(),r.stopPropagation()}Array.from(e).forEach(function(r){r.addEventListener("click",o)})}module.exports=trigger;

},{}],69:[function(require,module,exports){
var Hammer,Host,MIN_RESIZE,Sidebar,annotationCounts,events,extend,features,raf,sidebarTrigger,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend1=function(t,e){for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;extend=require("extend"),raf=require("raf"),Hammer=require("hammerjs"),Host=require("./host"),annotationCounts=require("./annotation-counts"),sidebarTrigger=require("./sidebar-trigger"),events=require("../shared/bridge-events"),features=require("./features"),MIN_RESIZE=280,module.exports=Sidebar=function(t){function e(t,n){var i,s,r;this.onSwipe=bind(this.onSwipe,this),this.onPan=bind(this.onPan,this),this._notifyOfLayoutChange=bind(this._notifyOfLayoutChange,this),("clean"===n.theme||n.externalContainerSelector)&&delete n.pluginClasses.BucketBar,n.externalContainerSelector&&delete n.pluginClasses.Toolbar,e.__super__.constructor.apply(this,arguments),this.hide(),(n.openSidebar||n.annotations||n.query)&&this.on("panelReady",(r=this,function(){return r.show()})),null!=this.plugins.BucketBar&&this.plugins.BucketBar.element.on("click",function(t){return function(e){return t.show()}}(this)),null!=this.plugins.Toolbar&&(this.toolbarWidth=this.plugins.Toolbar.getWidth(),"clean"===n.theme?(this.plugins.Toolbar.disableMinimizeBtn(),this.plugins.Toolbar.disableHighlightsBtn(),this.plugins.Toolbar.disableNewNoteBtn()):this.plugins.Toolbar.disableCloseBtn(),this._setupGestures()),(s=null!=(i=n.services)?i[0]:void 0)&&(this.onLoginRequest=s.onLoginRequest,this.onLogoutRequest=s.onLogoutRequest,this.onSignupRequest=s.onSignupRequest,this.onProfileRequest=s.onProfileRequest,this.onHelpRequest=s.onHelpRequest),this.onLayoutChange=n.onLayoutChange,this._notifyOfLayoutChange(!1),this._setupSidebarEvents()}return extend1(e,Host),e.prototype.options={Document:{},TextSelection:{},BucketBar:{container:".annotator-frame"},Toolbar:{container:".annotator-frame"}},e.prototype.renderFrame=null,e.prototype.gestureState=null,e.prototype._setupSidebarEvents=function(){var t;return annotationCounts(document.body,this.crossframe),sidebarTrigger(document.body,(t=this,function(){return t.show()})),features.init(this.crossframe),this.crossframe.on("showSidebar",function(t){return function(){return t.show()}}(this)),this.crossframe.on("hideSidebar",function(t){return function(){return t.hide()}}(this)),this.crossframe.on(events.LOGIN_REQUESTED,function(t){return function(){if(t.onLoginRequest)return t.onLoginRequest()}}(this)),this.crossframe.on(events.LOGOUT_REQUESTED,function(t){return function(){if(t.onLogoutRequest)return t.onLogoutRequest()}}(this)),this.crossframe.on(events.SIGNUP_REQUESTED,function(t){return function(){if(t.onSignupRequest)return t.onSignupRequest()}}(this)),this.crossframe.on(events.PROFILE_REQUESTED,function(t){return function(){if(t.onProfileRequest)return t.onProfileRequest()}}(this)),this.crossframe.on(events.HELP_REQUESTED,function(t){return function(){if(t.onHelpRequest)return t.onHelpRequest()}}(this)),this},e.prototype._setupGestures=function(){var t,e,n;if((t=this.toolbar.find("[name=sidebar-toggle]"))[0])return t.on("touchmove",function(t){return t.preventDefault()}),n=(e=new Hammer.Manager(t[0]).on("panstart panend panleft panright",this.onPan).on("swipeleft swiperight",this.onSwipe)).add(new Hammer.Pan({direction:Hammer.DIRECTION_HORIZONTAL})),e.add(new Hammer.Swipe({direction:Hammer.DIRECTION_HORIZONTAL})).recognizeWith(n),this._initializeGestureState(),this},e.prototype._initializeGestureState=function(){return this.gestureState={initial:null,final:null}},e.prototype._updateLayout=function(){var t;if(!this.renderFrame)return this.renderFrame=raf((t=this,function(){var e,n;if(t.renderFrame=null,t.gestureState.final!==t.gestureState.initial)return n=-(e=t.gestureState.final),t.frame.css("margin-left",e+"px"),n>=MIN_RESIZE&&t.frame.css("width",n+"px"),t._notifyOfLayoutChange()}))},e.prototype._notifyOfLayoutChange=function(t){var e,n,i,s,r,o,a,u;if(a=this.toolbarWidth||0,this.onLayoutChange)return o=(i=this.frame||this.externalFrame)[0].getBoundingClientRect(),e=window.getComputedStyle(i[0]),u=parseInt(e.width),r=parseInt(e.marginLeft),s=a,null!=t?t&&(s+=u):s+=r<MIN_RESIZE?-r:u,n=s>a,this.onLayoutChange({expanded:n,width:n?s:a,height:o.height})},e.prototype.onPan=function(t){var e,n;if(this.frame)switch(t.type){case"panstart":return this._initializeGestureState(),this.frame.addClass("annotator-no-transition"),this.frame.css("pointer-events","none"),this.gestureState.initial=parseInt(getComputedStyle(this.frame[0]).marginLeft);case"panend":return this.frame.removeClass("annotator-no-transition"),this.frame.css("pointer-events",""),this.gestureState.final<=-MIN_RESIZE?this.show():this.hide(),this._initializeGestureState();case"panleft":case"panright":if(null==this.gestureState.initial)return;return n=this.gestureState.initial,e=t.deltaX,this.gestureState.final=Math.min(Math.round(n+e),0),this._updateLayout()}},e.prototype.onSwipe=function(t){switch(t.type){case"swipeleft":return this.show();case"swiperight":return this.hide()}},e.prototype.show=function(){return this.crossframe.call("sidebarOpened"),this.frame&&(this.frame.css({"margin-left":-1*this.frame.width()+"px"}),this.frame.removeClass("annotator-collapsed")),null!=this.plugins.Toolbar&&(this.plugins.Toolbar.showCollapseSidebarBtn(),this.plugins.Toolbar.showCloseBtn()),"whenSidebarOpen"===this.options.showHighlights&&this.setVisibleHighlights(!0),this._notifyOfLayoutChange(!0)},e.prototype.hide=function(){return this.frame&&(this.frame.css({"margin-left":""}),this.frame.addClass("annotator-collapsed")),null!=this.plugins.Toolbar&&(this.plugins.Toolbar.hideCloseBtn(),this.plugins.Toolbar.showExpandSidebarBtn()),"whenSidebarOpen"===this.options.showHighlights&&this.setVisibleHighlights(!1),this._notifyOfLayoutChange(!1)},e.prototype.isOpen=function(){return!this.frame||!this.frame.hasClass("annotator-collapsed")},e.prototype.setAllVisibleHighlights=function(t){return this.crossframe.call("setVisibleHighlights",t),this.publish("setVisibleHighlights",t)},e}();

},{"../shared/bridge-events":73,"./annotation-counts":42,"./features":49,"./host":55,"./sidebar-trigger":68,"extend":24,"hammerjs":25,"raf":30}],70:[function(require,module,exports){
"use strict";function findFrames(e){return Array.from(e.getElementsByTagName("iframe")).filter(shouldEnableAnnotation)}function hasHypothesis(e){return!0===e.contentWindow.__hypothesis_frame}function injectHypothesis(e,t,n){var s=document.createElement("script");s.className="js-hypothesis-config",s.type="application/json",s.innerText=JSON.stringify(n);var o=t,i=document.createElement("script");i.className="js-hypothesis-embed",i.async=!0,i.src=o,e.contentDocument.body.appendChild(s),e.contentDocument.body.appendChild(i)}function isAccessible(e){try{return!!e.contentDocument}catch(e){return!1}}function shouldEnableAnnotation(e){var t=!e.classList.contains("h-sidebar-iframe"),n=e.hasAttribute("enable-annotation");return t&&n}function isDocumentReady(e,t){"loading"===e.contentDocument.readyState?e.contentDocument.addEventListener("DOMContentLoaded",function(){t()}):t()}function isLoaded(e,t){"complete"!==e.contentDocument.readyState?e.addEventListener("load",function(){t()}):t()}module.exports={findFrames:findFrames,hasHypothesis:hasHypothesis,injectHypothesis:injectHypothesis,isAccessible:isAccessible,isLoaded:isLoaded,isDocumentReady:isDocumentReady};

},{}],71:[function(require,module,exports){
"use strict";var Observable=require("zen-observable");function listen(e,n){return new Observable(function(r){var t=function(e){r.next(e)};return n.forEach(function(n){e.addEventListener(n,t)}),function(){n.forEach(function(n){e.removeEventListener(n,t)})}})}function delay(e,n){return new Observable(function(r){var t=[],u=n.subscribe({next:function(n){var u=setTimeout(function(){t=t.filter(function(e){return e!==u}),r.next(n)},e);t.push(u)}});return function(){t.forEach(clearTimeout),u.unsubscribe()}})}function buffer(e,n){return new Observable(function(r){var t,u;function i(){r.next(t)}var o=n.subscribe({next:function(n){t=n,clearTimeout(u),u=setTimeout(i,e)}});return function(){o.unsubscribe(),clearTimeout(u)}})}function merge(e){return new Observable(function(n){var r=e.map(function(e){return e.subscribe({next:function(e){n.next(e)}})});return function(){r.forEach(function(e){e.unsubscribe()})}})}function drop(e,n){var r=0;return e.filter(function(){return++r>n})}module.exports={buffer:buffer,delay:delay,drop:drop,listen:listen,merge:merge,Observable:Observable};

},{"zen-observable":32}],72:[function(require,module,exports){
"use strict";var baseURI=require("document-base-uri");function normalizeURI(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:baseURI;return new URL(e,r).href.toString().replace(/#.*/,"")}module.exports={normalizeURI:normalizeURI};

},{"document-base-uri":5}],73:[function(require,module,exports){
"use strict";module.exports={FEATURE_FLAGS_UPDATED:"featureFlagsUpdated",HELP_REQUESTED:"helpRequested",LOGIN_REQUESTED:"loginRequested",LOGOUT_REQUESTED:"logoutRequested",PROFILE_REQUESTED:"profileRequested",PUBLIC_ANNOTATION_COUNT_CHANGED:"publicAnnotationCountChanged",SIGNUP_REQUESTED:"signupRequested"};

},{}],74:[function(require,module,exports){
"use strict";function _toConsumableArray(n){return _arrayWithoutHoles(n)||_iterableToArray(n)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}function _arrayWithoutHoles(n){if(Array.isArray(n)){for(var e=0,r=new Array(n.length);e<n.length;e++)r[e]=n[e];return r}}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function _createClass(n,e,r){return e&&_defineProperties(n.prototype,e),r&&_defineProperties(n,r),n}var extend=require("extend"),RPC=require("./frame-rpc"),Bridge=function(){function n(){_classCallCheck(this,n),this.links=[],this.channelListeners={},this.onConnectListeners=[]}return _createClass(n,[{key:"destroy",value:function(){Array.from(this.links).map(function(n){return n.channel.destroy()})}},{key:"createChannel",value:function(n,e,r){var t=this,i=null,o=!1,a=function(){o||(o=!0,Array.from(t.onConnectListeners).forEach(function(e){return e.call(null,i,n)}))},c=extend({connect:function(n,e){n===r&&(e(),a())}},this.channelListeners);return(i=new RPC(window,n,e,c)).call("connect",r,a),this.links.push({channel:i,window:n}),i}},{key:"call",value:function(n){for(var e,r=this,t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];"function"==typeof i[i.length-1]&&(e=i[i.length-1],i=i.slice(0,-1));var a=this.links.map(function(e){var t;return new Promise(function(r,t){var o=setTimeout(function(){return r(null)},1e3);try{var a;return(a=e.channel).call.apply(a,[n].concat(_toConsumableArray(Array.from(i)),[function(n,e){return clearTimeout(o),n?t(n):r(e)}]))}catch(n){return t(n)}}).catch((t=e.channel,function(n){throw t.destroy(),r.links=Array.from(r.links).filter(function(n){return n.channel!==t}).map(function(n){return n}),n}))}),c=Promise.all(a);return e&&(c=c.then(function(n){return e(null,n)}).catch(function(n){return e(n)})),c}},{key:"on",value:function(n,e){if(this.channelListeners[n])throw new Error("Listener '".concat(n,"' already bound in Bridge"));return this.channelListeners[n]=e,this}},{key:"off",value:function(n){return delete this.channelListeners[n],this}},{key:"onConnect",value:function(n){return this.onConnectListeners.push(n),this}}]),n}();module.exports=Bridge;

},{"./frame-rpc":76,"extend":24}],75:[function(require,module,exports){
"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){var s=[],t=!0,o=!1,i=void 0;try{for(var n,a=e[Symbol.iterator]();!(t=(n=a.next()).done)&&(s.push(n.value),!r||s.length!==r);t=!0);}catch(e){o=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(o)throw i}}return s}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var s=0;s<r.length;s++){var t=r[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,s){return r&&_defineProperties(e.prototype,r),s&&_defineProperties(e,s),e}var Discovery=function(){function e(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.target=r,this.server=!1,this.origin="*",this.requestInProgress=!1,this.onDiscovery=null,void 0!==s.server&&(this.server=s.server),void 0!==s.origin&&(this.origin=s.origin),this._onMessage=this._onMessage.bind(this)}return _createClass(e,[{key:"startDiscovery",value:function(e){if(this.onDiscovery)throw new Error("Discovery is already in progress. Call stopDiscovery() first");this.onDiscovery=e,this.target.addEventListener("message",this._onMessage,!1),this._beacon()}},{key:"stopDiscovery",value:function(){this.onDiscovery=null,this.target.removeEventListener("message",this._onMessage)}},{key:"_beacon",value:function(){var e;e=this.server?"__cross_frame_dhcp_offer":"__cross_frame_dhcp_discovery";for(var r=[this.target.top];r.length>0;){var s=r.shift();s!==this.target&&s.postMessage(e,this.origin);for(var t=0;t<s.frames.length;t++)r.push(s.frames[t])}}},{key:"_onMessage",value:function(e){var r=e.source,s=e.data,t=e.origin;("null"===t||t.match("moz-extension:")||"moz-extension:"===window.location.protocol)&&(t="*");var o="string"==typeof s&&s.match(/^__cross_frame_dhcp_(discovery|offer|request|ack)(?::(\d+))?$/);if(o){var i=_slicedToArray(o,3),n=i[1],a=i[2],c=this._processMessage(n,a,t),l=c.reply,u=c.discovered,h=c.token;l&&r.postMessage("__cross_frame_dhcp_"+l,t),u&&this.onDiscovery.call(null,r,t,h)}}},{key:"_processMessage",value:function(e,r,s){var t=null,o=!1;if(this.server){if("discovery"===e)t="offer";else if("request"===e)r=this.generateToken(),t="ack:".concat(r),o=!0;else if("offer"===e||"ack"===e)throw new Error("A second Discovery server has been detected at ".concat(s,".\n This is unsupported and will cause unexpected behaviour."))}else"offer"===e?this.requestInProgress||(this.requestInProgress=!0,t="request"):"ack"===e&&(this.requestInProgress=!1,o=!0);return{reply:t,discovered:o,token:r}}},{key:"generateToken",value:function(){return Math.random().toString().replace(/\D/g,"")}}]),e}();module.exports=Discovery;

},{}],76:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var VERSION="1.0.0";function RPC(t,e,s,o){if(!(this instanceof RPC))return new RPC(t,e,s,o);var r=this;if(this.src=t,this.dst=e,"*"===s)this.origin="*";else{var n=new URL(s);this.origin=n.protocol+"//"+n.host}this._sequence=0,this._callbacks={},this._onmessage=function(t){r._destroyed||r.dst===t.source&&("*"!==r.origin&&t.origin!==r.origin||t.data&&"object"===_typeof(t.data)&&"frame-rpc"===t.data.protocol&&Array.isArray(t.data.arguments)&&r._handle(t.data))},this.src.addEventListener("message",this._onmessage),this._methods=("function"==typeof o?o(this):o)||{}}module.exports=RPC,RPC.prototype.destroy=function(){this._destroyed=!0,this.src.removeEventListener("message",this._onmessage)},RPC.prototype.call=function(t){var e=[].slice.call(arguments,1);return this.apply(t,e)},RPC.prototype.apply=function(t,e){if(!this._destroyed){var s=this._sequence++;"function"==typeof e[e.length-1]&&(this._callbacks[s]=e[e.length-1],e=e.slice(0,-1)),this.dst.postMessage({protocol:"frame-rpc",version:VERSION,sequence:s,method:t,arguments:e},this.origin)}},RPC.prototype._handle=function(t){var e=this;if(!e._destroyed)if(t.hasOwnProperty("method")){if(!this._methods.hasOwnProperty(t.method))return;var s=t.arguments.concat(function(){e.dst.postMessage({protocol:"frame-rpc",version:VERSION,response:t.sequence,arguments:[].slice.call(arguments)},e.origin)});this._methods[t.method].apply(this._methods,s)}else if(t.hasOwnProperty("response")){var o=this._callbacks[t.response];delete this._callbacks[t.response],o&&o.apply(null,t.arguments)}};

},{}],77:[function(require,module,exports){
"use strict";function assign(o,s){for(var n in s)s.hasOwnProperty(n)&&(o[n]=s[n]);return o}function jsonConfigsFrom(o){for(var s={},n=o.querySelectorAll("script.js-hypothesis-config"),r=0;r<n.length;r++){var t=void 0;try{t=JSON.parse(n[r].textContent)}catch(o){console.warn("Could not parse settings from js-hypothesis-config tags",o),t={}}assign(s,t)}return s}module.exports={jsonConfigsFrom:jsonConfigsFrom};

},{}]},{},[56])
//# sourceMappingURL=annotator.bundle.js.map
;})()