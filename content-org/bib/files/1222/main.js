var SurveyInvitation=function(h,f,m){var g={dom_ready:function(a){/in/.test(f.readyState)?setTimeout(function(){SurveyInvitation.dom_ready(a)},9):a()},set_element_text:function(a,c){for(var b=f.getElementById(a);null!==b.firstChild;)b.removeChild(b.firstChild);b.appendChild(f.createTextNode(c))},add_class:function(a,c){var b=a;"string"===typeof a&&(b=document.getElementById(a));b&&(b.className=b.className+" "+c)},add_event_listener:function(a,c,d){a.attachEvent?a.attachEvent("on"+c,d):a.addEventListener(c,
d,!1)},element_has_attribute:function(a,c){return a.hasAttribute?a.hasAttribute(c):!!a.getAttribute(c)},window_in_iframe:function(){try{return h.self!==h.top}catch(b){return!0}},get_browser_dimensions:function(){return{width:isNaN(h.innerWidth)?h.clientWidth:h.innerWidth,height:isNaN(h.innerHeight)?h.clientHeight:h.innerHeight}},get_element_outer_height:function(a){var b=a.currentStyle||h.getComputedStyle(a,null);a=a.offsetHeight;a+=parseInt(b.marginTop);return a+=parseInt(b.marginBottom)},get_document_height:function(){var a=
document.body,c=document.documentElement;return Math.max(a.scrollHeight,a.offsetHeight,c.clientHeight,c.scrollHeight,c.offsetHeight)},is_descendant:function(a,c){if(a&&c){if(a.contains)return a.contains(c);for(var b=c.parentNode;null!==b;){if(b===a)return!0;b=b.parentNode}}return!1},set_element_style:function(a,c){a.style.setAttribute?a.style.setAttribute("cssText",c):a.setAttribute("style",c)},set_cookie:function(a,c,d){if(d){var b=new Date;b.setTime(b.getTime()+864E5*d);d="; expires="+b.toGMTString()}else d=
"";f.cookie=encodeURIComponent(a)+"="+encodeURIComponent(c)+d+"; path=/"},get_cookie:function(a){a=encodeURIComponent(a)+"=";var b=f.cookie.split(";"),d,e;for(d=0;d<b.length;d+=1){for(e=b[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(a))return decodeURIComponent(e.substring(a.length,e.length))}return null},delete_cookie:function(a){g.set_cookie(a,"",-1)},cookies_enabled:function(){var a=!!navigator.cookieEnabled;navigator.cookieEnabled!==m||a||(document.cookie="testcookie",a=-1!==
document.cookie.indexOf("testcookie"));return a},json_enabled:function(){return JSON&&"function"===typeof JSON.parse?!0:!1},init_ie8_support:function(){window.hasOwnProperty=window.hasOwnProperty||Object.prototype.hasOwnProperty;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),d=b.length>>>0;if(0===d)return-1;var e=0;1<arguments.length&&(e=Number(arguments[1]),e!==e?e=0:0!==e&&Infinity!==e&&-Infinity!==e&&(e=(0<e||-1)*Math.floor(Math.abs(e))));
if(e>=d)return-1;for(e=0<=e?e:Math.max(d-Math.abs(e),0);e<d;){if(b.k!==m&&b[e]===a)return e;e+=1}return-1})},load_javascript_file:function(a,c){var b=document.getElementsByTagName("head")[0],e=document.createElement("script");e.type="text/javascript";e.src=a;c||(c=function(){});e.addEventListener?e.addEventListener("load",c,!1):e.readyState&&(e.onreadystatechange=c);b.appendChild(e)},parse_date:function(b){var c=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d+))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(b),
d=0,e=[1,4,5,6,7,10,11];if(c){for(b=0;b<e.length;b+=1){var f=e[b];c[f]=+c[f]||0}c[2]=(+c[2]||1)-1;c[3]=+c[3]||1;"Z"!==c[8]&&c[9]!==m&&(d=60*c[10]+c[11],"+"===c[9]&&(d=0-d));f=Date.UTC(c[1],c[2],c[3],c[4],c[5]+d,c[6],c[7])}else a.error_log(b+": Wrong date format. Should be ISO 8601. Read more at: https://en.wikipedia.org/wiki/ISO_8601. Please, include UTC offsets, such as in 2013-08-18T06:36:40+00:00");return f},get_current_date:Date.now||function(){return+new Date},load_style_sheet:function(b,c){var d=
b+"?"+a.clear_cache_string();var e=f.createElement("link");e.type="text/css";e.rel="stylesheet";e.href=d;f.getElementsByTagName("head")[0].appendChild(e);e=document.createElement("img");e.onerror=function(){c()};e.src=d},is_empty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}};var a={current_version:"v0.5",settings:{supported_languages:"en|fr|de|es|hr|nl|it|ca|cs|da|et|el|lv|lt|hu|bg|mt|pl|pt|ro|sk|sl|fi|sv|ga",settings_url:"https://ec.europa.eu/wel/surveys/wr_survey03/data/survey_url_rules.js",
cookie_name:"ecsi"},cache:{disabled_surveys:[],survey_rules:{}},locators:{pop_up_wrapper_element_id:"ec-survey-pop-up-container-wrapper",pop_up_element_id:"ec-survey-pop-up",pop_up_wrapper_element_class:"ecsi-container-wrapper",background_overlay_element_id:"ec-survey-pop-up-overlay",background_overlay_element_class:"ecsi-overlay",body_button_do_not_participate:"ec-survey-pop-up-body-button-do-not-participate",body_button_escape_invitation_after:"ec-survey-pop-up-body-button-escape-invitation-after",
body_button_participate_after_visit:"ec-survey-pop-up-body-button-participate-after-visit",body_button_participate_now:"ec-survey-pop-up-body-button-participate-now",button_close:"ec-survey-pop-up-button-close",checkbox_do_not_show_again:"ec-survey-pop-up-checkbox-do-not-show-again"},init:function(b){g.init_ie8_support();a.settings.configuration_overrides=b;g.dom_ready(a.query_surveys,b)},query_surveys:function(){try{if(!g.json_enabled())return a.error_log("Browser doesn't support JSON."),!1;if(g.window_in_iframe())return a.error_log("Page loaded inside iframe will not display the survey pop-up."),
!1;if(!a.url_in_production())return a.error_log("Page loaded on non-production url will not display the survey pop-up."),!1;if(a.pop_up_already_created())return a.error_log("Pop-up element was already present on page."),!1;if(!g.cookies_enabled())return a.error_log("Cookies are disabled."),!1;g.load_javascript_file(a.settings.settings_url+"?"+a.clear_cache_string())}catch(b){return a.message_log("Error on init(). "+b.message),!1}},load_survey_url_rules_callback:function(b){try{g.is_empty(a.cache.survey_rules)&&
(a.cache.survey_rules=b);var c=a.initialize_settings(b);c===m||!c||g.is_empty(c)?a.error_log("No survey invitation rule match the current URL."):g.load_javascript_file(a.settings.invitation_settings_file+"?"+a.clear_cache_string())}catch(d){a.message_log("Error on load_survey_url_rules_callback(). "+d.message)}},read_overrides:function(b){for(var c in a.settings.configuration_overrides)a.settings.configuration_overrides.hasOwnProperty(c)&&(b.invitation_settings_file=c,a.settings.configuration_overrides[c].hasOwnProperty("white_list")&&
(b.white_list=a.settings.configuration_overrides[c].white_list),a.settings.configuration_overrides[c].hasOwnProperty("black_list")&&(b.black_list=a.settings.configuration_overrides[c].black_list));return b},load_invitation_settings_file_callback:function(b){try{var c=a.settings,d=c;b.hasOwnProperty("defaults")&&a.in_time_span(b.defaults)&&(d=a.update_settings(c,b.defaults));if(b.hasOwnProperty(a.get_page_language())){var e=b[a.get_page_language()];a.in_time_span(e)&&(d=a.update_settings(d,e))}if(!(d.hasOwnProperty("trigger_mode")&&
d.hasOwnProperty("welcome")&&d.welcome.hasOwnProperty("markup")&&("trigger_mode_2"!==d.trigger_mode||d.hasOwnProperty("reminder")&&d.reminder.hasOwnProperty("markup"))))return a.cache.disabled_surveys.push(c.invitation_settings_file),a.load_survey_url_rules_callback(a.cache.survey_rules),!1;d.hasOwnProperty("start_date")&&g.parse_date(d.start_date)&&(d.start_date=g.parse_date(d.start_date));d.hasOwnProperty("end_date")&&g.parse_date(d.end_date)&&(d.end_date=g.parse_date(d.end_date));a.settings=d;
a.settings.hasOwnProperty("trigger_mode")&&("trigger_mode_1"===a.settings.trigger_mode&&a.check_cookie("show_welcome_pop_up")&&a.initialize_pop_up_markup(a.settings.welcome,"trigger_mode_1","welcome"),"trigger_mode_2"===a.settings.trigger_mode&&(a.check_cookie("show_welcome_pop_up")?a.initialize_pop_up_markup(a.settings.welcome,"trigger_mode_2","welcome"):a.check_cookie("show_reminder_pop_up")&&a.set_listener_for_when_visitor_leaves_website()))}catch(k){a.message_log("Failed when trying to initialize the invitation pop-up: "+
k)}},initialize_pop_up_markup:function(b,c,d){var e;var k=f.createElement("div");k.id=a.locators.background_overlay_element_id;g.add_class(k,a.locators.background_overlay_element_class);f.getElementsByTagName("body")[0].appendChild(k);g.set_element_style(k,"display:none");var l=f.createElement("div");l.id=a.locators.pop_up_wrapper_element_id;g.add_class(l,a.locators.pop_up_wrapper_element_class);f.getElementsByTagName("body")[0].appendChild(l);g.set_element_style(l,"display:none");l.innerHTML=b.markup;
for(e in b.translatable_texts)f.getElementById(e)&&b.translatable_texts.hasOwnProperty(e)&&g.set_element_text(e,b.translatable_texts[e]);for(e in b.translatable_hrefs)f.getElementById(e)&&b.translatable_texts.hasOwnProperty(e)&&(l=f.getElementById(e),l.href=b.translatable_hrefs[e].replace("[ua_value]",encodeURIComponent(navigator.userAgent)).replace("[p_value]",encodeURIComponent(h.location.href.toString())));switch(c+"_"+d){case "trigger_mode_1_welcome":g.add_event_listener(k,"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,
!1,!1);a.close_invitation()});f.getElementById(a.locators.button_close)&&g.add_event_listener(f.getElementById(a.locators.button_close),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()});document.onkeydown=function(b){b=b||window.event;27===b.keyCode&&(a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1),a.close_invitation())};f.getElementById(a.locators.body_button_do_not_participate)&&
g.add_event_listener(f.getElementById(a.locators.body_button_do_not_participate),"click",function(){a.set_invitation_cookies(!0,!1,!1);a.close_invitation()});f.getElementById(a.locators.body_button_participate_now)&&g.add_event_listener(f.getElementById(a.locators.body_button_participate_now),"click",function(){a.set_invitation_cookies(!0,!1,!1)});break;case "trigger_mode_2_welcome":g.add_event_listener(k,"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,
!1,!1);a.close_invitation()});f.getElementById(a.locators.button_close)&&g.add_event_listener(f.getElementById(a.locators.button_close),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()});document.onkeydown=function(b){b=b||window.event;27===b.keyCode&&(a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1),a.close_invitation())};f.getElementById(a.locators.body_button_do_not_participate)&&
g.add_event_listener(f.getElementById(a.locators.body_button_do_not_participate),"click",function(){a.set_invitation_cookies(!0,!1,!1);a.close_invitation()});f.getElementById(a.locators.body_button_participate_after_visit)&&g.add_event_listener(f.getElementById(a.locators.body_button_participate_after_visit),"click",function(){a.set_invitation_cookies(!0,!1,!0);a.close_invitation();a.set_listener_for_when_visitor_leaves_website();return!1});break;case "trigger_mode_2_reminder":g.add_event_listener(k,
"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()}),f.getElementById(a.locators.button_close)&&g.add_event_listener(f.getElementById(a.locators.button_close),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()}),document.onkeydown=function(b){b=b||window.event;27===b.keyCode&&(a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,
!1,!1),a.close_invitation())},f.getElementById(a.locators.body_button_escape_invitation_after)&&g.add_event_listener(f.getElementById(a.locators.body_button_escape_invitation_after),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);window.location.href=a.destination}),f.getElementById(a.locators.body_button_participate_now)&&g.add_event_listener(f.getElementById(a.locators.body_button_participate_now),"click",function(){a.set_invitation_cookies(!0,
!1,!1)})}g.load_style_sheet(b.css_file,a.show_popup)},show_popup:function(){setTimeout(function(){var b=window.pageYOffset||document.documentElement.scrollTop,c=g.get_browser_dimensions().height;var d=document.getElementById(a.locators.pop_up_element_id);var e=document.getElementById(a.locators.pop_up_wrapper_element_id),f=document.getElementById(a.locators.background_overlay_element_id);g.set_element_style(e,"display:block");g.set_element_style(f,"display:block");g.add_class(e,"ecsi_visible");a.settings.hasOwnProperty("welcome")&&
a.settings.welcome.hasOwnProperty("save_stats")&&a.settings.welcome.save_stats();a.settings.hasOwnProperty("welcome")&&a.settings.welcome.hasOwnProperty("show_once")&&1===a.settings.welcome.show_once&&a.set_invitation_cookies(!0,!1,!1);d&&e&&(d=g.get_element_outer_height(d),e.style.height=d+"px",c>d?b=b+c/2-d/2:b+d>g.get_document_height()&&(b=g.get_document_height()-d-30),e.style.top=b+"px")},200)},set_listener_for_when_visitor_leaves_website:function(){var b,c=a.settings;f.onclick=function(d){d=
d||h.event;d=d.target||d.srcElement;if("a"===d.tagName.toLowerCase()&&g.element_has_attribute(d,"href")&&(!f.getElementById(a.locators.pop_up_wrapper_element_id)||f.getElementById(a.locators.pop_up_wrapper_element_id)&&!f.getElementById(a.locators.pop_up_wrapper_element_id).contains(d))&&(b=a.rules_match_url(c,d.href.toString()),!b))return a.destination=d.href,a.initialize_pop_up_markup(a.settings.reminder,"trigger_mode_2","reminder"),!1}},initialize_settings:function(b){for(var c=0,d,e,f;c<b.surveys.length&&
!d;){for(e in b.surveys[c])-1===a.cache.disabled_surveys.indexOf(e)&&b.surveys[c].hasOwnProperty(e)&&(f=b.surveys[c][e],(f=a.rules_match_url(f,h.location.toString()))?d=f:a.cache.disabled_surveys.push(e));c+=1}d?d.invitation_settings_file=e:d={};b=a.read_overrides(d);a.settings=a.update_settings(a.settings,b);return b},check_cookie:function(b){var c=a.settings,d=g.get_cookie(a.settings.cookie_name);return(d=JSON.parse(d))&&d.hasOwnProperty(c.invitation_settings_file)&&(d[c.invitation_settings_file].hasOwnProperty(a.get_page_language())&&
d[c.invitation_settings_file][a.get_page_language()].hasOwnProperty(b)&&!1===d[c.invitation_settings_file][a.get_page_language()][b]||d[c.invitation_settings_file].hasOwnProperty("checkbox_do_not_show_again")&&d[c.invitation_settings_file].checkbox_do_not_show_again.hasOwnProperty(b)&&!1===d[c.invitation_settings_file].checkbox_do_not_show_again[b])?!1:!0},in_time_span:function(a){var b=g.get_current_date();return a.hasOwnProperty("start_date")&&g.parse_date(a.start_date)>b||a.hasOwnProperty("end_date")&&
g.parse_date(a.end_date)<b?!1:!0},update_settings:function(b,c){for(var d in c)try{b[d]=c[d].constructor===Object?a.update_settings(b[d],c[d]):c[d]}catch(e){b[d]=c[d]}return b},rules_match_url:function(b,c){var d=a.any_survey_settings_rule_matches(b,"white_list",c),e=a.any_survey_settings_rule_matches(b,"black_list",c);return d.found&&!e.found?b:!1},any_survey_settings_rule_matches:function(a,c,d){var b;if(a.hasOwnProperty(c))for(b=0;b<a[c].length;b+=1){var f=a[c][b];if(f=(new RegExp(f)).test(d))return{found:!0,
white_list:a.white_list,black_list:a.black_list,writable:!0}}return{found:!1}},set_invitation_cookies:function(b,c,d){var e=a.settings,f=g.get_cookie(a.settings.cookie_name);f=JSON.parse(f)||{};f.hasOwnProperty(e.invitation_settings_file)||(f[e.invitation_settings_file]={});f[e.invitation_settings_file][a.get_page_language()]={};f[e.invitation_settings_file][a.get_page_language()].show_welcome_pop_up=c;f[e.invitation_settings_file][a.get_page_language()].show_reminder_pop_up=d;b?(f[e.invitation_settings_file].checkbox_do_not_show_again=
{},f[e.invitation_settings_file].checkbox_do_not_show_again.show_welcome_pop_up=c,f[e.invitation_settings_file].checkbox_do_not_show_again.show_reminder_pop_up=d,g.set_cookie(a.settings.cookie_name,JSON.stringify(f),30)):g.set_cookie(a.settings.cookie_name,JSON.stringify(f))},close_invitation:function(){a.hasOwnProperty("destination")&&(h.location=a.destination);var b=f.getElementById(a.locators.pop_up_wrapper_element_id);b.parentNode.removeChild(b);b=f.getElementById(a.locators.background_overlay_element_id);
b.parentNode.removeChild(b)},pop_up_already_created:function(){var b=f.getElementById(a.locators.pop_up_wrapper_element_id);return g.is_descendant(f.getElementsByTagName("body")[0],b)?!0:!1},message_log:function(a){if("object"===typeof console)return!1},error_log:function(a){throw Error("Europa Survey Pop-up error: "+a);},get_page_language:function(){if(a.settings.hasOwnProperty("get_page_language"))return a.settings.get_page_language;var b=a.get_lang_autodetect();return a.settings.get_page_language=
b},get_lang_autodetect:function(){var b=new RegExp("("+a.settings.supported_languages+")"),c=a.get_lang_from_url;2!==String(c).length&&(c=a.get_lang_from_html());2!==String(c).length&&(c=a.get_lang_from_meta("http-equiv"));2!==String(c).length&&(c=a.get_lang_from_meta("meta-language"));2===String(c).length&&c.match(b)||(c="defaults");return c||!1},get_lang_from_html:function(){var a=f.documentElement.getAttribute("lang")||!1;a&&(a=a.substring(0,2));return a},get_lang_from_url:function(){var b=String(h.location).toLowerCase().match("_("+
a.supported_languages+").");return b&&b[1]!==m?String(b[1]):!1},get_lang_from_meta:function(a){var b=f.getElementsByTagName("meta"),d;for(d=0;d<b.length;d+=1)if("http-equiv"===a){if("content-language"===b[d].httpEquiv.toLowerCase()&&b[d].content)return b[d].content.substring(0,2).toLowerCase()}else if("language"===b[d].name.toLowerCase()&&b[d].content)return b[d].content.substring(0,2).toLowerCase();return!1},url_in_production:function(){return(new RegExp("wcmcom-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.europa.eu|wcmcom-ec-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.ec.europa.eu|wcmcom-www-cc-cec-wip.wcm3vue.cec.eu.int:8080|www.acceptance.cc.cec|wcmcom-eeas-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.eeas.europa.eu|wcmcom-publications-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.publications.europa.eu".replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$]/g,
"\\$&"))).test(h.location.toString())?!1:!0},clear_cache_string:function(){return Math.floor(g.get_current_date()/18E5).toString()+a.current_version}};try{return a.public_methods={init:a.init,load_survey_url_rules_callback:a.load_survey_url_rules_callback,load_invitation_settings_file_callback:a.load_invitation_settings_file_callback,dom_ready:g.dom_ready,update_settings:a.update_settings,message_log:a.message_log},a.public_methods}catch(b){a.message_log("Survey Invitation: Failed to initialize."+
b.message)}}(window,document);SurveyInvitation.init(window.survey_invitation_overrides||{});