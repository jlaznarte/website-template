'use strict';var TRACKER_HOST="app2.akanoo.com",CDN_HOST="cdn.akanoo.com";var clientId="",shopKey,ClientNotRegisteredError=function(){return function(){}}();
function sendRequest(d,g,h,n,f){void 0===h&&(h=function(){});void 0===n&&(n=function(){});void 0===f&&(f="post");f={body:JSON.stringify(d),credentials:"include",headers:{"Content-Type":"application/json"},method:f,mode:"cors"};fetch("https://"+TRACKER_HOST+"/w/"+g,f).then(resolveResponse).then(resolveJson).then(function(d){isClientResponse(d)?h(d):n(d)}).catch(function(f){f instanceof ClientNotRegisteredError?sendClientRequest(function(f){h(f);d.clientId=f.clientId;sendRequest(d,g,h,n)},clientId):
f.length&&"must be valid UUID"===f[0].message&&sendClientRequest(function(f){h(f);d.clientId=f.clientId;sendRequest(d,g,h,n)},clientId)})}function isClientResponse(d){return void 0!==d.clientId}function resolveJson(d){return d.json()}function resolveResponse(d){return new Promise(function(g,h){return 200<=d.status&&300>d.status?g(d):403===d.status?h(new ClientNotRegisteredError):d.json().then(function(d){return h(d)})})}
function sendClientRequest(d,g,h,n){var f={deviceHeight:screen?screen.height:0,deviceWidth:screen?screen.width:0,shopKey,supportsPush:"serviceWorker"in navigator&&"PushManager"in window},m="post";h?(f.offSiteTriggerToken=h,f.destinationKey=n,m="put"):f.clientId=g?g:"";g=localStorage.getItem("akanoo-request");h=new Date;h=h.setHours(h.getHours()-1);if(!g||h>parseInt(g,10))localStorage.setItem("akanoo-request",Date.now().toString()),sendRequest(f,"client",d,void 0,m)};var shopInstance={campaignParam:"utm_campaign",cookieDomain:"springer.com",cookieName:"__aae",key:"cf467223-d3c5-448b-89ec-1e685e64d694",mediumParam:"utm_medium",productTitleDOMNode:null,sourceParam:"utm_source"},ADDITIONAL_CONTENT_KEY_QUERY_PARAM="acmsc",CART_UPDATE_TYPE_ADD="add",CART_UPDATE_TYPE_FULL="full",CART_UPDATE_TYPE_REMOVE="remove",CART_UPDATE_TYPE_UPDATE="update",BIND_EXIT_INTENT_TIMEOUT=5E3,CAMPAIGN_RESULT_CONFIRM_VALUE="confirm",CAMPAIGN_RESULT_ABORT_VALUE="abort",CLIENT_ID_COOKIE_LIFETIME=
34E9,CONFIRM_ID_QUERY_PARAM="acmid",EVENT_TYPE_SELECTION="SELECTION",EVENT_TYPE_EXIT_INTENT="EXIT_INTENT",EVENT_TYPE_SCROLL_DOWN="SCROLL_DOWN",EXPAND_COLLAPSE_KEY="aat-cps",FORM_VALIDATION_FAILURE_NODE_SELECTOR="#aat-m-f",OBJECT_USER_MAP_PARAM="user",OBJECT_PRODUCT_MAP_PARAM="product",OVERLAY_MAP="aat_om",OFF_SITE_TRIGGER_TOKEN_QUERY_PARAM="aostt",TRACK_EXIT_INTENT_TIMEOUT=500,SCROLL_CLASS="aat-scroll",doc=document,loc=location;
(function(d,g){function h(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];c=[OBJECT_USER_MAP_PARAM,OBJECT_PRODUCT_MAP_PARAM];var k=["category","shop"];H[a]?H[a].apply(window,b):"overlay"===a?(window[OVERLAY_MAP]||(window[OVERLAY_MAP]={}),window[OVERLAY_MAP][b[0]]=b[1]):"incentive"===a&&"0"!==b[0]?q.push({entity:OBJECT_USER_MAP_PARAM,property:"skip-campaign",value:"1"}):"flag"===a&&b[0]?q.push({entity:"session",property:"flag",value:b[0]}):-1<c.indexOf(a)&&b[0]&&b[1]?q.push({entity:a,
property:b[0],value:b[1]}):"type"===a&&b[0]?(y=!0,z=b[0]):-1<k.indexOf(a)&&b?A=b:"transaction"===a&&b&&(c=b[0],k=b[1],b={cartItems:u,clientId,discountTotal:v(b[2]),goalId:"checkout",metaData:q,shopKey:shopInstance.key,total:v(k),transactionId:c},sendRequest(b,"goal",l))}function n(a){a=d.cookie.split(new RegExp("(^|;)\\s*"+a+"="));return 2<=a.length?decodeURIComponent(a.pop().split(";").shift()):""}function f(a){return(a=g.href.match(new RegExp(a+"=([^&;#]*)")))?a[1]:""}function m(a,b,c){void 0===
c&&(c="");if(t[a]){var k={campaign:b.campaignLabel,clientId,content:b.content,form:X(),group:b.controlGroup?"1":"0",measure:b.campaignId,selection:c,type:a};t[a].forEach(function(a){return a(k)})}}function X(){var a={},b=d.querySelectorAll(".aat-pop input,.aat-pop textarea"),c=0;for(b=Array.from(b);c<b.length;c++){var k=b[c],e=k.getAttribute("name");e&&("radio"!==k.getAttribute("type")||k.checked)&&(a[e]=k.value)}return a}function v(a){return"string"===typeof a?(a=100*parseFloat(a),Math.round(a)):
a}function Y(){d.addEventListener("click",Z);d.addEventListener("visibilitychange",aa);d.addEventListener("scroll",ba);setTimeout(ca,BIND_EXIT_INTENT_TIMEOUT);shopInstance.productTitleDOMNode&&d.querySelectorAll(shopInstance.productTitleDOMNode).forEach(function(a){a.addEventListener("mouseup",I);a.addEventListener("touchend",I)})}function ca(){d.addEventListener("mouseout",da);d.addEventListener("focusout",function(a){a.relatedTarget||B||J()})}function da(a){var b=window.scrollY>a.pageY;a.relatedTarget||
!b||B||(setTimeout(J,TRACK_EXIT_INTENT_TIMEOUT),d.addEventListener("mouseenter",ea))}function Z(a){sendRequest({clientId,positionX:Math.round(a.clientX-d.body.scrollWidth/2+window.pageXOffset),positionY:Math.round(a.clientY+window.pageYOffset),shopKey:shopInstance.key},"click",l)}function C(a){a={categories:A,clientId,domain:g.host,eventType:a,metaData:q,path:g.pathname,query:g.search,screenType:z,shopKey:shopInstance.key};e?sendRequest(a,"on_screen_event",l):sendRequest(a,"on_screen_event",l,D)}
function J(){K||(C(EVENT_TYPE_EXIT_INTENT),B=!0)}function I(){window.getSelection()&&!L&&(C(EVENT_TYPE_SELECTION),L=!0)}function ba(){window.scrollY+window.innerHeight!==d.documentElement.scrollHeight||M||(C(EVENT_TYPE_SCROLL_DOWN),M=!0)}function aa(){"hidden"!==d.visibilityState&&"visible"!==d.visibilityState||sendRequest({clientId,shopKey:shopInstance.key,visible:!d.hidden},"tab_switch",l)}function r(a,b,c){void 0===b&&(b=CAMPAIGN_RESULT_ABORT_VALUE);void 0===c&&(c="");sendRequest({campaignId:a,
clientId,destinationKey:c,responseType:b,shopKey:shopInstance.key},"campaign_interaction",l,D)}function w(a,b){sendRequest({cartItems:a,clientId,shopKey:shopInstance.key,type:b},"cart_update")}function D(a){m("view",a);E();a.campaignId&&(m("target",a),!a.controlGroup&&a.content&&fa(a))}function l(a){var b=shopInstance.cookieName,c=a.clientId,k=CLIENT_ID_COOKIE_LIFETIME;void 0===k&&(k=0);var e="";0!==k&&(e="expires="+(new Date(Date.now()+k)).toUTCString()+";");k="";shopInstance.cookieDomain&&(k="domain="+
shopInstance.cookieDomain+";");d.cookie=b+"="+encodeURIComponent(c)+";"+e+"path=/;"+k;clientId=a.clientId;N()}function ea(){K=!0}function ha(){e&&(e.classList.add(SCROLL_CLASS),window.clearTimeout(O),O=setTimeout(ia,66))}function ia(){e&&e.classList.remove(SCROLL_CLASS)}function fa(a){m("display",a);e=d.createElement("div");e.innerHTML=a.content;localStorage.getItem(EXPAND_COLLAPSE_KEY)?e.classList.add("aat-pop",EXPAND_COLLAPSE_KEY):e.classList.add("aat-pop","aat-ani");d.body.insertBefore(e,d.body.firstChild);
window[OVERLAY_MAP]&&Object.keys(window[OVERLAY_MAP]).forEach(function(b){return d.querySelectorAll('.aat-pop [data-om-key="'+b+'"]').forEach(function(c){var d=window[OVERLAY_MAP][b],k=c.dataset.omAttr;"A"===c.tagName?P(a.campaignId,c,d):k?c.setAttribute(k,d):c.textContent=d})});var b=e.querySelector("canvas#scratch-canvas");b&&ja(b);d.addEventListener("scroll",ha);e.addEventListener("keydown",function(b){if("Esc"===b.key||"Escape"===b.key)E(),r(a.campaignId),m(CAMPAIGN_RESULT_ABORT_VALUE,a)});e.querySelectorAll(".aat-b-x").forEach(function(b){return ka(a,
b)});e.querySelectorAll(".aat-b-e").forEach(la);e.querySelectorAll(".aat-b-c").forEach(function(b){ma(a,b);b.focus()});e.querySelectorAll(".aat-b-l").forEach(function(b){P(a.campaignId,b);b.focus()});na()}function na(){if(e){var a=e.querySelectorAll("a[href], button, textarea, input, select"),b=a[0],c=a[a.length-1];e.addEventListener("keydown",function(a){"Tab"===a.key&&(a.shiftKey?document.activeElement===b&&(c.focus(),a.preventDefault()):document.activeElement===c&&(b.focus(),a.preventDefault()))})}}
function E(){e&&(e.parentNode.removeChild(e),e=null,d.body.focus())}function ka(a,b){b.addEventListener("click",function(){E();r(a.campaignId);m(CAMPAIGN_RESULT_ABORT_VALUE,a)})}function ma(a,b){var c=b.dataset.sci;if(a.applicationServerKey&&"push-registration"===a.campaignLabel){var d={applicationServerKey:oa(a.applicationServerKey),userVisibleOnly:!0};b.addEventListener("click",function(){return navigator.serviceWorker.register(location.origin+"/akanoo-service-loader.js").then(pa).then(function(a){return a.pushManager.subscribe(d)}).then(qa).then(function(){return Q(a,
c)}).catch(ra)})}"false"!==b.dataset.autoConfirm?b.addEventListener("click",function(){return Q(a,c)}):b.addEventListener("click",function(){return m(CAMPAIGN_RESULT_CONFIRM_VALUE,a,c)})}function Q(a,b){void 0===b&&(b="");m(CAMPAIGN_RESULT_CONFIRM_VALUE,a,b);r(a.campaignId,CAMPAIGN_RESULT_CONFIRM_VALUE,b)}function oa(a){var b="=".repeat((4-a.length%4)%4);a=(a+b).replace(/-/g,"+").replace(/_/g,"/");a=window.atob(a);return Uint8Array.from(Array.from(a).map(function(a){return a.charCodeAt(0)}))}function qa(a){a=
a.toJSON();sendRequest({clientId,endpoint:a.endpoint,keys:a.keys,shopKey:shopInstance.key},"register/push",l)}function ra(a){sendRequest({clientId,message:"Unable registering the ServiceWorker and getting PushSubscription: "+a,shopKey:shopInstance.key},"error",l)}function pa(a){return new Promise(function(b,c){var d=a.installing||a.waiting||a.active;d?"activated"===d.state?b(a):d.addEventListener("statechange",function(c){"activated"===c.target.state&&b(a)}):c()})}function la(a){a.addEventListener("click",
sa)}function sa(){e&&(e.classList.toggle(EXPAND_COLLAPSE_KEY)?localStorage.setItem(EXPAND_COLLAPSE_KEY,"1"):localStorage.removeItem(EXPAND_COLLAPSE_KEY))}function P(a,b,c){void 0===c&&(c="");c=c||b.getAttribute("xlink:href")||b.getAttribute("href")||b.getAttribute("action")||g.href;var d=b.dataset.sci;void 0===d&&(d="");a=CONFIRM_ID_QUERY_PARAM+"="+a;d&&(a+="&"+ADDITIONAL_CONTENT_KEY_QUERY_PARAM+"="+d);d=b.dataset.param;void 0===d&&(d="");c=R(c,d?d+("&"+a):a);a=R(g.href,a);c=c.replace("$CUE$",encodeURIComponent(a));
b.setAttribute("xlink:href",c);b.setAttribute("href",c);b.setAttribute("action",c)}function R(a,b){var c=d.createElement("A");c.href=a;c.search&&(c.search+="&");c.search+=b.replace(/;/g,"&");return c.href}function N(){var a=f(CONFIRM_ID_QUERY_PARAM);if(a){var b=f(ADDITIONAL_CONTENT_KEY_QUERY_PARAM);r(a,CAMPAIGN_RESULT_CONFIRM_VALUE,b)}(window[S].c||[]).forEach(function(a){return h.apply(window,a)});window[S]=h;Y()}function ja(a){var b=a.getContext("2d"),c=new Image,d=a.dataset.img;d&&b&&(c.src=d,
c.crossOrigin="Anonymous",c.onload=function(){return b.drawImage(c,0,0)},F.crossOrigin="Anonymous",F.src="https://s3.eu-central-1.amazonaws.com/akanoo-img/scratch-brush.png",a.addEventListener("mousedown",T,!1),a.addEventListener("touchstart",T,!1),a.addEventListener("mousemove",ta,!1),a.addEventListener("touchmove",ua,!1),a.addEventListener("mouseup",U,!1),a.addEventListener("touchend",U,!1))}function G(a){return{x:a.pageX,y:a.pageY}}function T(a){x=!0;p=G(a)}function ta(a){x&&(a.preventDefault(),
a=G(a),V(a,this))}function ua(a){x&&(a.preventDefault(),a=G(a.touches[0]),V(a,this))}function V(a,b){var c=b.getContext("2d");if(c){for(var d=Math.sqrt(Math.pow(a.x-p.x,2)+Math.pow(a.y-p.y,2)),f=Math.atan2(a.x-p.x,a.y-p.y),g=b.getBoundingClientRect().left,h=b.getBoundingClientRect().top,l=0;l<d;l++){var m=p.x-g+Math.sin(f)*l-25,n=p.y-h+Math.cos(f)*l;c.globalCompositeOperation="destination-out";c.drawImage(F,m,n)}p=a;if(a=e){c=c.getImageData(0,0,c.canvas.width,c.canvas.height);c=Array.from(c.data);
a=0;for(d=c.length;d--;)0===c[d]&&a++;a=.7<a/c.length}a&&b.remove()}}function U(){x=!1}var S=window.Akanoo,u=[],t={},F=new Image,A=[],e=null,B=!1,L=!1,q=[{entity:"user",property:"supportsCanvas",value:d.createElement("canvas").getContext?"1":"0"}],K=!1,z="",M=!1,y=!1,x=!1,p,O;shopKey=shopInstance.key;var H={addItem:function(a,b,c){a&&c&&(a={price:v(b),productId:a,quantity:parseInt(c.toString(),10)},w([a],CART_UPDATE_TYPE_ADD))},addToBasket:function(a,b,c){a&&c&&(a={price:v(b),productId:a,quantity:parseInt(c.toString(),
10)},u.push(a))},bind:function(a,b){t[a]?t[a].push(b):t[a]=[b]},claim:function(a,b){r(a,CAMPAIGN_RESULT_CONFIRM_VALUE,b)},claimError:function(){if(e){var a=e.querySelector(FORM_VALIDATION_FAILURE_NODE_SELECTOR);a&&(a.dataset.invalid="true")}},dismiss:function(a){r(a)},removeItem:function(a,b){a&&(a={price:0,productId:a,quantity:parseInt(b.toString(),10)},w([a],CART_UPDATE_TYPE_REMOVE))},send:function(){if(y){var a={categories:A,clientId,domain:g.host,metaData:q,path:g.pathname,query:g.search,referer:d.referrer,
screenType:z,shopKey:shopInstance.key,utmCampaign:f(shopInstance.campaignParam),utmMedium:f(shopInstance.mediumParam),utmSource:f(shopInstance.sourceParam)};sendRequest(a,"screen",l,D);u.length&&w(u,CART_UPDATE_TYPE_FULL);y=!1}},updateItem:function(a,b){a&&(a={price:0,productId:a,quantity:parseInt(b.toString(),10)},w([a],CART_UPDATE_TYPE_UPDATE))}};try{clientId=n(shopInstance.cookieName);var W=f(OFF_SITE_TRIGGER_TOKEN_QUERY_PARAM);W?sendClientRequest(l,clientId,W,"default"):clientId?N():sendClientRequest(l)}catch(a){}})(document,
location);
