var SurveyInvitation=function(h,f,m){var a,g;g={dom_ready:function(a){/in/.test(f.readyState)?setTimeout(function(){SurveyInvitation.dom_ready(a)},9):a()},set_element_text:function(a,c){for(var b=f.getElementById(a);null!==b.firstChild;)b.removeChild(b.firstChild);b.appendChild(f.createTextNode(c))},add_class:function(a,c){var b=a;"string"===typeof a&&(b=document.getElementById(a));b&&(b.className=b.className+" "+c)},add_event_listener:function(a,c,b){a.attachEvent?a.attachEvent("on"+c,b):a.addEventListener(c,
b,!1)},element_has_attribute:function(a,c){return a.hasAttribute?a.hasAttribute(c):!!a.getAttribute(c)},window_in_iframe:function(){try{return h.self!==h.top}catch(a){return!0}},get_browser_dimensions:function(){return{width:isNaN(h.innerWidth)?h.clientWidth:h.innerWidth,height:isNaN(h.innerHeight)?h.clientHeight:h.innerHeight}},get_element_outer_height:function(a){var c=a.currentStyle||h.getComputedStyle(a,null);a=a.offsetHeight;a+=parseInt(c.marginTop);return a+=parseInt(c.marginBottom)},get_document_height:function(){var a=
document.body,c=document.documentElement;return Math.max(a.scrollHeight,a.offsetHeight,c.clientHeight,c.scrollHeight,c.offsetHeight)},is_descendant:function(a,c){if(a&&c){if(a.contains)return a.contains(c);for(var b=c.parentNode;null!==b;){if(b===a)return!0;b=b.parentNode}}return!1},set_element_style:function(a,c){a.style.setAttribute?a.style.setAttribute("cssText",c):a.setAttribute("style",c)},set_cookie:function(a,c,b){if(b){var d=new Date;d.setTime(d.getTime()+864E5*b);b="; expires="+d.toGMTString()}else b=
"";f.cookie=encodeURIComponent(a)+"="+encodeURIComponent(c)+b+"; path=/"},get_cookie:function(a){a=encodeURIComponent(a)+"=";var c=f.cookie.split(";"),b,d;for(b=0;b<c.length;b+=1){for(d=c[b];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return decodeURIComponent(d.substring(a.length,d.length))}return null},delete_cookie:function(a){g.set_cookie(a,"",-1)},cookies_enabled:function(){var a=!!navigator.cookieEnabled;navigator.cookieEnabled!==m||a||(document.cookie="testcookie",a=-1!==
document.cookie.indexOf("testcookie"));return a},json_enabled:function(){return JSON&&"function"===typeof JSON.parse?!0:!1},init_ie8_support:function(){window.hasOwnProperty=window.hasOwnProperty||Object.prototype.hasOwnProperty;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var c=Object(this),b=c.length>>>0;if(0===b)return-1;var d=0;1<arguments.length&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&Infinity!==d&&-Infinity!==d&&(d=(0<d||-1)*Math.floor(Math.abs(d))));
if(d>=b)return-1;for(d=0<=d?d:Math.max(b-Math.abs(d),0);d<b;){if(c.k!==m&&c[d]===a)return d;d+=1}return-1})},load_javascript_file:function(a,c){var b=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript";d.src=a;c||(c=function(){});d.addEventListener?d.addEventListener("load",c,!1):d.readyState&&(d.onreadystatechange=c);b.appendChild(d)},parse_date:function(e){var c,b=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d+))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(e),
d=0,f=[1,4,5,6,7,10,11];if(b){for(e=0;e<f.length;e+=1)c=f[e],b[c]=+b[c]||0;b[2]=(+b[2]||1)-1;b[3]=+b[3]||1;"Z"!==b[8]&&b[9]!==m&&(d=60*b[10]+b[11],"+"===b[9]&&(d=0-d));c=Date.UTC(b[1],b[2],b[3],b[4],b[5]+d,b[6],b[7])}else a.error_log(e+": Wrong date format. Should be ISO 8601. Read more at: https://en.wikipedia.org/wiki/ISO_8601. Please, include UTC offsets, such as in 2013-08-18T06:36:40+00:00");return c},get_current_date:Date.now||function(){return+new Date},load_style_sheet:function(e,c){var b,
d=e+"?"+a.clear_cache_string();b=f.createElement("link");b.type="text/css";b.rel="stylesheet";b.href=d;f.getElementsByTagName("head")[0].appendChild(b);b=document.createElement("img");b.onerror=function(){c()};b.src=d},is_empty:function(a){for(var c in a)if(a.hasOwnProperty(c))return!1;return!0}};a={current_version:"v0.2",settings:{supported_languages:"en|fr|de|es|hr|nl|it|ca|cs|da|et|el|lv|lt|hu|bg|mt|pl|pt|ro|sk|sl|fi|sv|ga",settings_url:"https://ec.europa.eu/wel/surveys/wr_survey03/data/survey_url_rules.js",
cookie_name:"ecsi"},cache:{disabled_surveys:[],survey_rules:{}},locators:{pop_up_wrapper_element_id:"ec-survey-pop-up-container-wrapper",pop_up_element_id:"ec-survey-pop-up",pop_up_wrapper_element_class:"ecsi-container-wrapper",background_overlay_element_id:"ec-survey-pop-up-overlay",background_overlay_element_class:"ecsi-overlay",body_button_do_not_participate:"ec-survey-pop-up-body-button-do-not-participate",body_button_escape_invitation_after:"ec-survey-pop-up-body-button-escape-invitation-after",
body_button_participate_after_visit:"ec-survey-pop-up-body-button-participate-after-visit",body_button_participate_now:"ec-survey-pop-up-body-button-participate-now",button_close:"ec-survey-pop-up-button-close",checkbox_do_not_show_again:"ec-survey-pop-up-checkbox-do-not-show-again"},init:function(e){g.init_ie8_support();a.settings.configuration_overrides=e;g.dom_ready(a.query_surveys,e)},query_surveys:function(){try{if(!g.json_enabled())return a.error_log("Browser doesn't support JSON."),!1;if(g.window_in_iframe())return a.error_log("Page loaded inside iframe will not display the survey pop-up."),
!1;if(!a.url_in_production())return a.error_log("Page loaded on non-production url will not display the survey pop-up."),!1;if(a.pop_up_already_created())return a.error_log("Pop-up element was already present on page."),!1;if(!g.cookies_enabled())return a.error_log("Cookies are disabled."),!1;g.load_javascript_file(a.settings.settings_url+"?"+a.clear_cache_string())}catch(e){return a.message_log("Error on init(). "+e.message),!1}},load_survey_url_rules_callback:function(e){var c;try{g.is_empty(a.cache.survey_rules)&&
(a.cache.survey_rules=e),c=a.initialize_settings(e),c!==m&&c||a.error_log("No survey invitation rule match the current URL."),g.load_javascript_file(a.settings.invitation_settings_file+"?"+a.clear_cache_string())}catch(b){a.message_log("Error on load_survey_url_rules_callback(). "+b.message)}},read_overrides:function(e){for(var c in a.settings.configuration_overrides)a.settings.configuration_overrides.hasOwnProperty(c)&&(e.invitation_settings_file=c,a.settings.configuration_overrides[c].hasOwnProperty("white_list")&&
(e.white_list=a.settings.configuration_overrides[c].white_list),a.settings.configuration_overrides[c].hasOwnProperty("black_list")&&(e.black_list=a.settings.configuration_overrides[c].black_list));return e},load_invitation_settings_file_callback:function(e){try{var c=a.settings,b,d=c;e.hasOwnProperty("defaults")&&a.in_time_span(e.defaults)&&(d=a.update_settings(c,e.defaults));e.hasOwnProperty(a.get_page_language())&&(b=e[a.get_page_language()],a.in_time_span(b)&&(d=a.update_settings(d,b)));if(!(d.hasOwnProperty("trigger_mode")&&
d.hasOwnProperty("welcome")&&d.welcome.hasOwnProperty("markup")&&("trigger_mode_2"!==d.trigger_mode||d.hasOwnProperty("reminder")&&d.reminder.hasOwnProperty("markup"))))return a.cache.disabled_surveys.push(c.invitation_settings_file),a.load_survey_url_rules_callback(a.cache.survey_rules),!1;d.hasOwnProperty("start_date")&&g.parse_date(d.start_date)&&(d.start_date=g.parse_date(d.start_date));d.hasOwnProperty("end_date")&&g.parse_date(d.end_date)&&(d.end_date=g.parse_date(d.end_date));a.settings=d;
a.settings.hasOwnProperty("trigger_mode")&&("trigger_mode_1"===a.settings.trigger_mode&&a.check_cookie("show_welcome_pop_up")&&a.initialize_pop_up_markup(a.settings.welcome,"trigger_mode_1","welcome"),"trigger_mode_2"===a.settings.trigger_mode&&(a.check_cookie("show_welcome_pop_up")?a.initialize_pop_up_markup(a.settings.welcome,"trigger_mode_2","welcome"):a.check_cookie("show_reminder_pop_up")&&a.set_listener_for_when_visitor_leaves_website()))}catch(f){a.message_log("Failed when trying to initialize the invitation pop-up: "+
f)}},initialize_pop_up_markup:function(e,c,b){var d,k,l;l=f.createElement("div");l.id=a.locators.background_overlay_element_id;g.add_class(l,a.locators.background_overlay_element_class);f.getElementsByTagName("body")[0].appendChild(l);g.set_element_style(l,"display:none");d=f.createElement("div");d.id=a.locators.pop_up_wrapper_element_id;g.add_class(d,a.locators.pop_up_wrapper_element_class);f.getElementsByTagName("body")[0].appendChild(d);g.set_element_style(d,"display:none");d.innerHTML=e.markup;
for(k in e.translatable_texts)e.translatable_texts.hasOwnProperty(k)&&g.set_element_text(k,e.translatable_texts[k]);for(k in e.translatable_hrefs)e.translatable_texts.hasOwnProperty(k)&&(d=f.getElementById(k),d.href=e.translatable_hrefs[k].replace("[ua_value]",encodeURIComponent(navigator.userAgent)).replace("[p_value]",encodeURIComponent(h.location.href.toString())));switch(c+"_"+b){case "trigger_mode_1_welcome":g.add_event_listener(l,"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,
!1,!1);a.close_invitation()});f.getElementById(a.locators.button_close)&&g.add_event_listener(f.getElementById(a.locators.button_close),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()});document.onkeydown=function(b){b=b||window.event;27===b.keyCode&&(a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1),a.close_invitation())};f.getElementById(a.locators.body_button_do_not_participate)&&
g.add_event_listener(f.getElementById(a.locators.body_button_do_not_participate),"click",function(){a.set_invitation_cookies(!0,!1,!1);a.close_invitation()});f.getElementById(a.locators.body_button_participate_now)&&g.add_event_listener(f.getElementById(a.locators.body_button_participate_now),"click",function(){a.set_invitation_cookies(!0,!1,!1)});break;case "trigger_mode_2_welcome":g.add_event_listener(l,"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,
!1,!1);a.close_invitation()});f.getElementById(a.locators.button_close)&&g.add_event_listener(f.getElementById(a.locators.button_close),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()});document.onkeydown=function(b){b=b||window.event;27===b.keyCode&&(a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1),a.close_invitation())};f.getElementById(a.locators.body_button_do_not_participate)&&
g.add_event_listener(f.getElementById(a.locators.body_button_do_not_participate),"click",function(){a.set_invitation_cookies(!0,!1,!1);a.close_invitation()});f.getElementById(a.locators.body_button_participate_after_visit)&&g.add_event_listener(f.getElementById(a.locators.body_button_participate_after_visit),"click",function(){a.set_invitation_cookies(!0,!1,!0);a.close_invitation();a.set_listener_for_when_visitor_leaves_website();return!1});break;case "trigger_mode_2_reminder":g.add_event_listener(l,
"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()}),f.getElementById(a.locators.button_close)&&g.add_event_listener(f.getElementById(a.locators.button_close),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);a.close_invitation()}),document.onkeydown=function(b){b=b||window.event;27===b.keyCode&&(a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,
!1,!1),a.close_invitation())},f.getElementById(a.locators.body_button_escape_invitation_after)&&g.add_event_listener(f.getElementById(a.locators.body_button_escape_invitation_after),"click",function(){a.set_invitation_cookies(f.getElementById(a.locators.checkbox_do_not_show_again).checked,!1,!1);window.location.href=a.destination}),f.getElementById(a.locators.body_button_participate_now)&&g.add_event_listener(f.getElementById(a.locators.body_button_participate_now),"click",function(){a.set_invitation_cookies(!0,
!1,!1)})}g.load_style_sheet(e.css_file,a.show_popup)},show_popup:function(){setTimeout(function(){var e,c=window.pageYOffset||document.documentElement.scrollTop,b=g.get_browser_dimensions().height;e=document.getElementById(a.locators.pop_up_element_id);var d=document.getElementById(a.locators.pop_up_wrapper_element_id),f=document.getElementById(a.locators.background_overlay_element_id);g.set_element_style(d,"display:block");g.set_element_style(f,"display:block");g.add_class(d,"ecsi_visible");e=g.get_element_outer_height(e);
d.style.height=e+"px";b>e?c=c+b/2-e/2:c+e>g.get_document_height()&&(c=g.get_document_height()-e-30);d.style.top=c+"px"},200)},set_listener_for_when_visitor_leaves_website:function(){var e,c=a.settings;f.onclick=function(b){b=b||h.event;b=b.target||b.srcElement;if("a"===b.tagName.toLowerCase()&&g.element_has_attribute(b,"href")&&(!f.getElementById(a.locators.pop_up_wrapper_element_id)||f.getElementById(a.locators.pop_up_wrapper_element_id)&&!f.getElementById(a.locators.pop_up_wrapper_element_id).contains(b))&&
(e=a.rules_match_url(c,b.href.toString()),!e))return a.destination=b.href,a.initialize_pop_up_markup(a.settings.reminder,"trigger_mode_2","reminder"),!1}},initialize_settings:function(e){for(var c=0,b,d,f;c<e.surveys.length&&!b;){for(d in e.surveys[c])-1===a.cache.disabled_surveys.indexOf(d)&&e.surveys[c].hasOwnProperty(d)&&(f=e.surveys[c][d],(f=a.rules_match_url(f,h.location.toString()))?b=f:a.cache.disabled_surveys.push(d));c+=1}b&&(b.invitation_settings_file=d);e=a.read_overrides(b);a.settings=
a.update_settings(a.settings,e);return e},check_cookie:function(e){var c=a.settings,b=g.get_cookie(a.settings.cookie_name);return(b=JSON.parse(b))&&b.hasOwnProperty(c.invitation_settings_file)&&(b[c.invitation_settings_file].hasOwnProperty(a.get_page_language())&&b[c.invitation_settings_file][a.get_page_language()].hasOwnProperty(e)&&!1===b[c.invitation_settings_file][a.get_page_language()][e]||b[c.invitation_settings_file].hasOwnProperty("checkbox_do_not_show_again")&&b[c.invitation_settings_file].checkbox_do_not_show_again.hasOwnProperty(e)&&
!1===b[c.invitation_settings_file].checkbox_do_not_show_again[e])?!1:!0},in_time_span:function(a){var c=g.get_current_date();return a.hasOwnProperty("start_date")&&g.parse_date(a.start_date)>c||a.hasOwnProperty("end_date")&&g.parse_date(a.end_date)<c?!1:!0},update_settings:function(e,c){for(var b in c)try{e[b]=c[b].constructor===Object?a.update_settings(e[b],c[b]):c[b]}catch(d){e[b]=c[b]}return e},rules_match_url:function(e,c){var b=a.any_survey_settings_rule_matches(e,"white_list",c),d=a.any_survey_settings_rule_matches(e,
"black_list",c);return b.found&&!d.found?e:!1},any_survey_settings_rule_matches:function(a,c,b){var d,f;if(a.hasOwnProperty(c))for(f=0;f<a[c].length;f+=1)if(d=a[c][f],d=(new RegExp(d)).test(b))return{found:!0,white_list:a.white_list,black_list:a.black_list,writable:!0};return{found:!1}},set_invitation_cookies:function(e,c,b){var d=a.settings,f=g.get_cookie(a.settings.cookie_name),f=JSON.parse(f)||{};f.hasOwnProperty(d.invitation_settings_file)||(f[d.invitation_settings_file]={});f[d.invitation_settings_file][a.get_page_language()]=
{};f[d.invitation_settings_file][a.get_page_language()].show_welcome_pop_up=c;f[d.invitation_settings_file][a.get_page_language()].show_reminder_pop_up=b;e?(f[d.invitation_settings_file].checkbox_do_not_show_again={},f[d.invitation_settings_file].checkbox_do_not_show_again.show_welcome_pop_up=c,f[d.invitation_settings_file].checkbox_do_not_show_again.show_reminder_pop_up=b,g.set_cookie(a.settings.cookie_name,JSON.stringify(f),30)):g.set_cookie(a.settings.cookie_name,JSON.stringify(f))},close_invitation:function(){var e;
a.hasOwnProperty("destination")&&(h.location=a.destination);e=f.getElementById(a.locators.pop_up_wrapper_element_id);e.parentNode.removeChild(e);e=f.getElementById(a.locators.background_overlay_element_id);e.parentNode.removeChild(e)},pop_up_already_created:function(){var e=f.getElementById(a.locators.pop_up_wrapper_element_id);return g.is_descendant(f.getElementsByTagName("body")[0],e)?!0:!1},message_log:function(a){if("object"===typeof console)return!1},error_log:function(a){throw Error("Europa Survey Pop-up error: "+
a);},get_page_language:function(){var e="";if(a.settings.hasOwnProperty("get_page_language"))return a.settings.get_page_language;e=a.get_lang_autodetect();return a.settings.get_page_language=e},get_lang_autodetect:function(){var e=new RegExp("("+a.settings.supported_languages+")"),c=a.get_lang_from_url;2!==String(c).length&&(c=a.get_lang_from_html());2!==String(c).length&&(c=a.get_lang_from_meta("http-equiv"));2!==String(c).length&&(c=a.get_lang_from_meta("meta-language"));2===String(c).length&&c.match(e)||
(c="defaults");return c||!1},get_lang_from_html:function(){return f.documentElement.getAttribute("lang")||!1},get_lang_from_url:function(){var e=String(h.location).toLowerCase().match("_("+a.supported_languages+").");return e&&e[1]!==m?String(e[1]):!1},get_lang_from_meta:function(a){var c=f.getElementsByTagName("meta"),b;for(b=0;b<c.length;b+=1)if("http-equiv"===a){if("content-language"===c[b].httpEquiv.toLowerCase()&&c[b].content)return c[b].content.substring(0,2).toLowerCase()}else if("language"===
c[b].name.toLowerCase()&&c[b].content)return c[b].content.substring(0,2).toLowerCase();return!1},url_in_production:function(){return(new RegExp("wcmcom-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.europa.eu|wcmcom-ec-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.ec.europa.eu|wcmcom-www-cc-cec-wip.wcm3vue.cec.eu.int:8080|www.acceptance.cc.cec|wcmcom-eeas-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.eeas.europa.eu|wcmcom-publications-europa-eu-wip.wcm3vue.cec.eu.int:8080|www.acceptance.publications.europa.eu".replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$]/g,
"\\$&"))).test(h.location.toString())?!1:!0},clear_cache_string:function(){return Math.floor(g.get_current_date()/18E5).toString()+a.current_version}};try{return a.public_methods={init:a.init,load_survey_url_rules_callback:a.load_survey_url_rules_callback,load_invitation_settings_file_callback:a.load_invitation_settings_file_callback,dom_ready:g.dom_ready,update_settings:a.update_settings,message_log:a.message_log},a.public_methods}catch(e){a.message_log("Survey Invitation: Failed to initialize."+
e.message)}}(window,document);SurveyInvitation.init(window.survey_invitation_overrides||{});