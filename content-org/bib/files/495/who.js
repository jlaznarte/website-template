/**
* WHO JavaScript stuff.
* @author NOSE
* V1.03 GA media tracking update

*/

function fixMenu() {
// place holder for fixMenu function
};

var WHO = {
	
	/**
	* Initialize.
	*/
	initOnReady: function() {
		
		// develop tools
		//jQuery(document).devTools();
					
		// context
		var ctxPage = jQuery("#page");
		var ctxHeader = jQuery("#header");
		var ctxMain = jQuery("#main");
		var ctxSidebar = jQuery("#sidebar");
		var ctxContent = jQuery("#content");
		
		// init all
		WHO.prepareFlags();
		WHO.initPanel(ctxPage);
		//WHO.initSearch(ctxHeader);
		WHO.initToggler(ctxMain);
		WHO.initModal(ctxMain);
		WHO.initScroller(ctxMain);
		WHO.initHoverable(ctxMain);
		WHO.initDropdowns(ctxMain);
		WHO.initFacets(ctxSidebar);
		WHO.initIndexes(ctxContent);
		WHO.initTabs(ctxContent);
		WHO.initStories(ctxContent);
		WHO.initPrintLinks(ctxPage);

	},
	
	/**
	* Prepares the flags.
	*/
	browserIE:false,
	browserIE6:false,
	prepareFlags: function() {
		// browser flags
		if (jQuery.browser.msie) {
			WHO.browserIE = true;
		}
		if (jQuery.browser.msie && jQuery.browser.version.substr(0,1)<7) {
			WHO.browserIE6 = true;
		}
	},
	
	
	
	/**
	* Initialize the panel.
	*/
	initPanel: function(ctx) {	
		
		// ticker
		jQuery("#ticker").panel();
	},
	
	
	/**
	* Initialize the togglers.
	*/
	initToggler: function(ctx) {	
		
		// togglers
		jQuery(".toggler",ctx).each(function(ind,el) {
			// vars
			var id = jQuery(el).attr("id");
			var msgExpanded = null;
			var msgCollapsed = null;
			var expanded = false;
			var title = jQuery(this).attr("title");
			if (jQuery(el).hasClass("expanded")) {
				expanded = true;	
			}
			if (title.indexOf("$") >= 0) {
				var msgs = title.split("$");
				msgCollapsed = msgs[0];
				msgExpanded = msgs[1];
			}
			
			// toggle
			jQuery(el).toggler("."+id,{expanded:expanded,msgCollapsed:msgCollapsed,msgExpanded:msgExpanded,animate:false});
											 
		});
	},
	
	/**
	 * Initialize the modal.
	 */
	initModal: function(ctx){
		jQuery(".modal",ctx).nyroModal({
			bgColor:'#F5F5F5',
			minHeight:'100',
			hideContent:function hideModal(elts, settings, callback) {
			  elts.wrapper.hide().animate({opacity: 0}, {complete: callback, duration: 80}); 
			},
			showBackground:function showBackground(elts, settings, callback) {
				elts.bg.css({opacity:0}).fadeTo(300, 0.75, callback);
			}
		});
	},
	
	/**
	* Initialize tabs.
	*/
	initTabs: function(ctx) {
		// tabs
		jQuery("#tabs",ctx).tabs({fx:{opacity:'toggle'}});
	},
	
	
	/**
	* Initialize search.
	*/
	initSearch: function(ctx) {
		// field enhancer
		jQuery("#search_input input",ctx).fieldEnhancer("search_form","#search_form",{"fieldValue":"Search WHO.int"});
	},
	
	/**
	* Initialize stories.
	*/
	initStories: function(ctx) {
		// story
		jQuery(".stories",ctx).each(function(ind,el) {
			jQuery(el).story();
		});
	},
	
	/**
	 * Initialize the scroller.
	 */
	initScroller: function(ctx) {
		jQuery(".scroller",ctx).scroller();
		jQuery("sup a",ctx).scroller({"anchor":true});
	},
		
	/**
	* Initialize the hoverables.
	*/
	initHoverable: function(ctx) {	
		
		// hoverables
		jQuery(".hoverable, a.image, a.link_image, a.modal, ul.feature li, ul.index li, ul.events li, ul.listing > li:not(.listing_dropdown)",ctx).each(function(i,els){
			
			// events
			jQuery(els).bind("mouseenter",function(){
				jQuery(this).addClass("hover");
				jQuery("img",this).animate({opacity: 0.9}, 180);
			});
			jQuery(els).bind("mouseleave",function(){
				jQuery(this).removeClass("hover");
				jQuery("img",this).animate({opacity: 1.0}, 300);
			});
			jQuery(els).bind("click",function(){
				// modal
				if (jQuery(this).hasClass("modal")) {
					return true;
				}
				
				// follow link
				var h = jQuery("a",this).attr("href");
				if (h == null) {
					h = jQuery(this).attr("href");
				};
				if (h != null) {
					window.location.href = h;
					return false;
				};
			});
		});
		

	},
	
	/**
	* Initializes the dropdowns.
	*/
	initDropdowns: function(ctx) {
		var z = 100;
		jQuery("div.dropdown").each(function(){
			jQuery(this).dropdown();
			jQuery(this).css("z-index",z);
			z--;
		});
		jQuery("li.listing_dropdown").each(function(){
			jQuery(this).css({"z-index":z,"height":45});
			z--;
		});
	},
	
	/**
	* Initializes the facets.
	*/
	initFacets: function(ctx) {
		// form
		var facetForm = jQuery("#facets form");
		if (facetForm != null) {
			// we have form
			var inputs = jQuery("input",facetForm);
			// a change resubmits the form
			jQuery(inputs).bind("change",function(){
				jQuery(facetForm).submit();
			});
		}
	},
	
	/**
	* Initializes the indexes.
	*/
	initIndexes: function(ctx) {
		// indexed
		if (! WHO.browserIE6) {
			jQuery(".indexes").each(function(){
				jQuery(this).indexer();
			});
		}
	},
	
	/**
	* Initialize the print links.
	*/
	initPrintLinks: function(ctx) {	
		jQuery("#pageaction_print, .print",ctx).bind("click",function(){
			window.print();
		});
	}
}
jQuery(document).ready(function(){
	WHO.initOnReady();
});

if (typeof jQuery != 'undefined') {
    jQuery(document).ready(function($) {
        var filetypes = /\.(zip|exe|pdf|jpg|jpeg|gif|png|doc*|xls*|ppt*|epub|mp3)$/i;
        var baseHref = '';
        if (jQuery('base').attr('href') != undefined)
            baseHref = jQuery('base').attr('href');
        jQuery('a').each(function() {
            var href = jQuery(this).attr('href');
            if (href && href.match(/^mailto\:/i)) {
                jQuery(this).click(function() {
                    var mailLink = href.replace(/^mailto\:/i, '');
                    _gaq.push(['_trackEvent', 'Email', 'Click', mailLink]);
                });
            }
            else if (href && href.match(filetypes)) {
                jQuery(this).click(function() {
                    var extension = (/[.]/.exec(href)) ? /[^.]+$/.exec(href) : undefined;
                    var filePath = href;
                    _gaq.push(['_trackEvent', 'Download', 'Click-' + extension, filePath]);
                    //if (jQuery(this).attr('target') != undefined && jQuery(this).attr('target').toLowerCase() != '_blank') {
                    //    setTimeout(function() { location.href = baseHref + href; }, 200);
                    //    return false;
                    // }
                });
            }
        });
    });
}

//Jquery autocomplete https://goodies.pixabay.com/jquery/auto-complete/demo.html
!function(e){e.fn.autoComplete=function(t){var o=e.extend({},e.fn.autoComplete.defaults,t);return"string"==typeof t?(this.each(function(){var o=e(this);"destroy"==t&&(e(window).off("resize.autocomplete",o.updateSC),o.off("blur.autocomplete focus.autocomplete keydown.autocomplete keyup.autocomplete"),o.data("autocomplete")?o.attr("autocomplete",o.data("autocomplete")):o.removeAttr("autocomplete"),e(o.data("sc")).remove(),o.removeData("sc").removeData("autocomplete"))}),this):this.each(function(){function t(e){var t=s.val();if(s.cache[t]=e,e.length&&t.length>=o.minChars){for(var a="",c=0;c<e.length;c++)a+=o.renderItem(e[c],t);s.sc.html(a),s.updateSC(0)}else s.sc.hide()}var s=e(this);s.sc=e('<div class="autocomplete-suggestions '+o.menuClass+'"></div>'),s.data("sc",s.sc).data("autocomplete",s.attr("autocomplete")),s.attr("autocomplete","off"),s.cache={},s.last_val="",s.updateSC=function(t,o){if(s.sc.css({top:s.offset().top+s.outerHeight(),left:s.offset().left,width:s.outerWidth()}),!t&&(s.sc.show(),s.sc.maxHeight||(s.sc.maxHeight=parseInt(s.sc.css("max-height"))),s.sc.suggestionHeight||(s.sc.suggestionHeight=e(".autocomplete-suggestion",s.sc).first().outerHeight()),s.sc.suggestionHeight))if(o){var a=s.sc.scrollTop(),c=o.offset().top-s.sc.offset().top;c+s.sc.suggestionHeight-s.sc.maxHeight>0?s.sc.scrollTop(c+s.sc.suggestionHeight+a-s.sc.maxHeight):0>c&&s.sc.scrollTop(c+a)}else s.sc.scrollTop(0)},e(window).on("resize.autocomplete",s.updateSC),s.sc.appendTo("body"),s.sc.on("mouseleave",".autocomplete-suggestion",function(){e(".autocomplete-suggestion.selected").removeClass("selected")}),s.sc.on("mouseenter",".autocomplete-suggestion",function(){e(".autocomplete-suggestion.selected").removeClass("selected"),e(this).addClass("selected")}),s.sc.on("mousedown",".autocomplete-suggestion",function(t){var a=e(this),c=a.data("val");return(c||a.hasClass("autocomplete-suggestion"))&&(s.val(c),o.onSelect(t,c,a),s.sc.hide()),!1}),s.on("blur.autocomplete",function(){try{over_sb=e(".autocomplete-suggestions:hover").length}catch(t){over_sb=0}over_sb?s.is(":focus")||setTimeout(function(){s.focus()},20):(s.last_val=s.val(),s.sc.hide(),setTimeout(function(){s.sc.hide()},350))}),o.minChars||s.on("focus.autocomplete",function(){s.last_val="\n",s.trigger("keyup.autocomplete")}),s.on("keydown.autocomplete",function(t){if((40==t.which||38==t.which)&&s.sc.html()){var a,c=e(".autocomplete-suggestion.selected",s.sc);return c.length?(a=40==t.which?c.next(".autocomplete-suggestion"):c.prev(".autocomplete-suggestion"),a.length?(c.removeClass("selected"),s.val(a.addClass("selected").data("val"))):(c.removeClass("selected"),s.val(s.last_val),a=0)):(a=40==t.which?e(".autocomplete-suggestion",s.sc).first():e(".autocomplete-suggestion",s.sc).last(),s.val(a.addClass("selected").data("val"))),s.updateSC(0,a),!1}if(27==t.which)s.val(s.last_val).sc.hide();else if(13==t.which||9==t.which){var c=e(".autocomplete-suggestion.selected",s.sc);c.length&&s.sc.is(":visible")&&(o.onSelect(t,c.data("val"),c),setTimeout(function(){s.sc.hide()},20))}}),s.on("keyup.autocomplete",function(a){if(!~e.inArray(a.which,[13,27,35,36,37,38,39,40])){var c=s.val();if(c.length>=o.minChars){if(c!=s.last_val){if(s.last_val=c,clearTimeout(s.timer),o.cache){if(c in s.cache)return void t(s.cache[c]);for(var l=1;l<c.length-o.minChars;l++){var i=c.slice(0,c.length-l);if(i in s.cache&&!s.cache[i].length)return void t([])}}s.timer=setTimeout(function(){o.source(c,t)},o.delay)}}else s.last_val=c,s.sc.hide()}})})},e.fn.autoComplete.defaults={source:0,minChars:3,delay:150,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var o=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(o,"<b>$1</b>")+"</div>"},onSelect:function(e,t,o){}}}(jQuery);
$( document ).ready(function() {
			$('input[name="q"]').autoComplete({
				source: function( term, suggest ) {
					term = term.toLowerCase();
					
					var getUrlParameter = function getUrlParameter(sParam) {
						var sPageURL = decodeURIComponent(window.location.search.substring(1)),
							sURLVariables = sPageURL.split('&'),
							sParameterName,
							i;

						for (i = 0; i < sURLVariables.length; i++) {
							sParameterName = sURLVariables[i].split('=');

							if (sParameterName[0] === sParam) {
								return sParameterName[1] === undefined ? true : sParameterName[1];
							}
						}
					};

					var uclient = getUrlParameter("client")
					if (uclient == null){
						//we are not in the search page but in the site, 
						//so there is not a "client" parameter
						var parts =  window.location.pathname.split("/");
						uclient = "_" + parts[parts.length-2] + "_r";
					}
					console.log("uclient is : " + uclient);
					$.ajax({
					  url: "http://search.who.int/suggest?q=" + term + "&max=7&site=default_collection&client=" + uclient + "&access=p&format=os",
					  dataType: "jsonp",
					  success: function( data ) {  
						//response(data);
						//var suggestions = [];
						//for (i=0;i<data[1].length;i++)
						//	suggestions.push(data[1][i]);
						suggest(data[1]);
					  }
					});
				},
			});
});

/* For licensing information see http://contextlysitescripts.contextly.com/kit/assets/3.6.1/licenses.txt */
!function(){function aa(a){return a.call.apply(a.bind,arguments)}function ba(a,b){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function n(){return n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba,n.apply(null,arguments)}function r(a,b){this.D=a,this.m=b||a,this.F=this.m.document}function s(a,b,c){a=a.F.getElementsByTagName(b)[0],a||(a=document.documentElement),a.insertBefore(c,a.lastChild)}function t(a,b,c){b=b||[],c=c||[];for(var d=a.className.split(/\s+/),f=0;f<b.length;f+=1){for(var e=!1,g=0;g<d.length;g+=1)if(b[f]===d[g]){e=!0;break}e||d.push(b[f])}for(b=[],f=0;f<d.length;f+=1){for(e=!1,g=0;g<c.length;g+=1)if(d[f]===c[g]){e=!0;break}e||b.push(d[f])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function u(a,b){for(var c=a.className.split(/\s+/),d=0,f=c.length;f>d;d++)if(c[d]==b)return!0;return!1}function v(a){if("string"==typeof a.da)return a.da;var b=a.m.location.protocol;return"about:"==b&&(b=a.D.location.protocol),"https:"==b?"https:":"http:"}function w(a,b){var c=a.createElement("link",{rel:"stylesheet",href:b,media:"all"}),d=!1;c.onload=function(){d||(d=!0)},c.onerror=function(){d||(d=!0)},s(a,"head",c)}function x(a,b,c,d){var f=a.F.getElementsByTagName("head")[0];if(f){var e=a.createElement("script",{src:b}),g=!1;return e.onload=e.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),e.onload=e.onreadystatechange=null,"HEAD"==e.parentNode.tagName&&f.removeChild(e))},f.appendChild(e),setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")))},d||5e3),e}return null}function y(a){this.ca=a||"-"}function A(a,b){this.V=a,this.N=4,this.H="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.H=c[1],this.N=parseInt(c[2],10))}function B(a){return a.H+a.N}function ca(a){var b=4,c="n",d=null;return a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10)))),c+b}function da(a,b){this.a=a,this.h=a.m.document.documentElement,this.J=b,this.f="wf",this.e=new y("-"),this.Z=!1!==b.events,this.u=!1!==b.classes}function ea(a){a.u&&t(a.h,[a.e.d(a.f,"loading")]),C(a,"loading")}function D(a){if(a.u){var b=u(a.h,a.e.d(a.f,"active")),c=[],d=[a.e.d(a.f,"loading")];b||c.push(a.e.d(a.f,"inactive")),t(a.h,c,d)}C(a,"inactive")}function C(a,b,c){a.Z&&a.J[b]&&(c?a.J[b](c.getName(),B(c)):a.J[b]())}function fa(){this.t={}}function ga(a,b,c){var f,d=[];for(f in b)if(b.hasOwnProperty(f)){var e=a.t[f];e&&d.push(e(b[f],c))}return d}function E(a,b){this.a=a,this.q=b,this.j=this.a.createElement("span",{"aria-hidden":"true"},this.q)}function G(a,b){var d,c=a.j;d=[];for(var f=b.V.split(/,\s*/),e=0;e<f.length;e++){var g=f[e].replace(/['"]/g,"");d.push(-1==g.indexOf(" ")?g:"'"+g+"'")}d=d.join(","),f="normal","o"===b.H?f="oblique":"i"===b.H&&(f="italic"),c.style.cssText="display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+d+";"+("font-style:"+f+";font-weight:"+(b.N+"00")+";")}function H(a){s(a.a,"body",a.j)}function I(a,b,c,d,f,e,g){this.O=a,this.ba=b,this.a=c,this.g=d,this.q=g||"BESbswy",this.s={},this.M=f||3e3,this.T=e||null,this.C=this.B=this.w=this.v=null,this.v=new E(this.a,this.q),this.w=new E(this.a,this.q),this.B=new E(this.a,this.q),this.C=new E(this.a,this.q),G(this.v,new A(this.g.getName()+",serif",B(this.g))),G(this.w,new A(this.g.getName()+",sans-serif",B(this.g))),G(this.B,new A("serif",B(this.g))),G(this.C,new A("sans-serif",B(this.g))),H(this.v),H(this.w),H(this.B),H(this.C)}function L(){if(null===K){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);K=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return K}function N(a,b,c){for(var d in J)if(J.hasOwnProperty(d)&&b===a.s[J[d]]&&c===a.s[J[d]])return!0;return!1}function M(a){var d,b=a.v.j.offsetWidth,c=a.w.j.offsetWidth;(d=b===a.s.serif&&c===a.s["sans-serif"])||(d=L()&&N(a,b,c)),d?p()-a.ea>=a.M?L()&&N(a,b,c)&&(null===a.T||a.T.hasOwnProperty(a.g.getName()))?O(a,a.O):O(a,a.ba):ha(a):O(a,a.O)}function ha(a){setTimeout(n(function(){M(this)},a),50)}function O(a,b){setTimeout(n(function(){this.v.remove(),this.w.remove(),this.B.remove(),this.C.remove(),b(this.g)},a),0)}function P(a,b,c){this.a=a,this.o=b,this.K=0,this.X=this.S=!1,this.M=c}function Q(a){0==--a.K&&a.S&&(a.X?(a=a.o,a.u&&t(a.h,[a.e.d(a.f,"active")],[a.e.d(a.f,"loading"),a.e.d(a.f,"inactive")]),C(a,"active")):D(a.o))}function R(a){this.D=a,this.p=new fa,this.U=0,this.P=this.Q=!0}function ja(a,b,c,d,f){var e=0==--a.U;(a.P||a.Q)&&setTimeout(function(){var a=f||null,l=d||null||{};if(0===c.length&&e)D(b.o);else{b.K+=c.length,e&&(b.S=e);var h,k=[];for(h=0;h<c.length;h++){var m=c[h],z=l[m.getName()],q=b.o,F=m;q.u&&t(q.h,[q.e.d(q.f,F.getName(),B(F).toString(),"loading")]),C(q,"fontloading",F),q=null,q=new I(n(b.$,b),n(b.aa,b),b.a,m,b.M,a,z),k.push(q)}for(h=0;h<k.length;h++)k[h].start()}},0)}function ia(a,b,c){var d=[],f=c.timeout;ea(b);var d=ga(a.p,c,a.a),e=new P(a.a,b,f);for(a.U=d.length,b=0,c=d.length;c>b;b++)d[b].load(function(b,c,d){ja(a,e,b,c,d)})}function S(a,b,c){this.I=a?a:b+ka,this.k=[],this.L=[],this.Y=c||""}function T(a){this.k=a,this.W=[],this.G={}}function V(a,b){this.a=a,this.c=b}function W(a,b){this.a=a,this.c=b,this.R=[]}function X(a,b){this.a=a,this.c=b}function Y(a,b){this.a=a,this.c=b}function pa(a,b){this.a=a,this.c=b}var p=Date.now||function(){return+new Date};r.prototype.createElement=function(a,b,c){if(a=this.F.createElement(a),b)for(var d in b)b.hasOwnProperty(d)&&("style"==d?a.style.cssText=b[d]:a.setAttribute(d,b[d]));return c&&a.appendChild(this.F.createTextNode(c)),a},y.prototype.d=function(){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.ca)},A.prototype.getName=function(){return this.V},E.prototype.remove=function(){var a=this.j;a.parentNode&&a.parentNode.removeChild(a)};var J={ga:"serif",fa:"sans-serif"},K=null;I.prototype.start=function(){this.s.serif=this.B.j.offsetWidth,this.s["sans-serif"]=this.C.j.offsetWidth,this.ea=p(),M(this)},P.prototype.$=function(a){var b=this.o;b.u&&t(b.h,[b.e.d(b.f,a.getName(),B(a).toString(),"active")],[b.e.d(b.f,a.getName(),B(a).toString(),"loading"),b.e.d(b.f,a.getName(),B(a).toString(),"inactive")]),C(b,"fontactive",a),this.X=!0,Q(this)},P.prototype.aa=function(a){var b=this.o;if(b.u){var c=u(b.h,b.e.d(b.f,a.getName(),B(a).toString(),"active")),d=[],f=[b.e.d(b.f,a.getName(),B(a).toString(),"loading")];c||d.push(b.e.d(b.f,a.getName(),B(a).toString(),"inactive")),t(b.h,d,f)}C(b,"fontinactive",a),Q(this)},R.prototype.load=function(a){this.a=new r(this.D,a.context||this.D),this.Q=!1!==a.events,this.P=!1!==a.classes,ia(this,new da(this.a,a),a)};var ka="//fonts.googleapis.com/css";S.prototype.d=function(){if(0==this.k.length)throw Error("No fonts to load!");if(-1!=this.I.indexOf("kit="))return this.I;for(var a=this.k.length,b=[],c=0;a>c;c++)b.push(this.k[c].replace(/ /g,"+"));return a=this.I+"?family="+b.join("%7C"),0<this.L.length&&(a+="&subset="+this.L.join(",")),0<this.Y.length&&(a+="&text="+encodeURIComponent(this.Y)),a};var U={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},la={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ma={i:"i",italic:"i",n:"n",normal:"n"},na=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;T.prototype.parse=function(){for(var a=this.k.length,b=0;a>b;b++){var c=this.k[b].split(":"),d=c[0].replace(/\+/g," "),f=["n4"];if(2<=c.length){var e,g=c[1];if(e=[],g)for(var g=g.split(","),l=g.length,h=0;l>h;h++){var k;if(k=g[h],k.match(/^[\w-]+$/))if(k=na.exec(k.toLowerCase()),null==k)k="";else{var m;if(m=k[1],null==m||""==m)m="4";else{var z=la[m];m=z?z:isNaN(m)?"4":m.substr(0,1)}k=k[2],k=[null==k||""==k?"n":ma[k],m].join("")}else k="";k&&e.push(k)}0<e.length&&(f=e),3==c.length&&(c=c[2],e=[],c=c?c.split(","):e,0<c.length&&(c=U[c[0]])&&(this.G[d]=c))}for(this.G[d]||(c=U[d])&&(this.G[d]=c),c=0;c<f.length;c+=1)this.W.push(new A(d,f[c]))}};var oa={Arimo:!0,Cousine:!0,Tinos:!0};V.prototype.load=function(a){for(var b=this.a,c=new S(this.c.api,v(b),this.c.text),d=this.c.families,f=d.length,e=0;f>e;e++){var g=d[e].split(":");3==g.length&&c.L.push(g.pop());var l="";2==g.length&&""!=g[1]&&(l=":"),c.k.push(g.join(l))}d=new T(d),d.parse(),w(b,c.d()),a(d.W,d.G,oa)},W.prototype.A=function(a){var b=this.a;return v(this.a)+(this.c.api||"//f.fontdeck.com/s/css/js/")+(b.m.location.hostname||b.D.location.hostname)+"/"+a+".js"},W.prototype.load=function(a){var b=this.c.id,c=this.a.m,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,l=c.fonts.length;l>g;++g){var h=c.fonts[g];d.R.push(new A(h.name,ca("font-weight:"+h.weight+";font-style:"+h.style)))}a(d.R)},x(this.a,this.A(b),function(b){b&&a([])})):a([])},X.prototype.A=function(a){return(this.c.api||"https://use.typekit.net")+"/"+a+".js"},X.prototype.load=function(a){var b=this.c.id,c=this.a.m;b?x(this.a,this.A(b),function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var f=[],e=0;e<b.length;e+=2)for(var g=b[e],l=b[e+1],h=0;h<l.length;h++)f.push(new A(g,l[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(k){}a(f)}},2e3):a([])},Y.prototype.A=function(a,b){var c=v(this.a),d=(this.c.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+d+"/"+a+".js"+(b?"?v="+b:"")},Y.prototype.load=function(a){var b=this.c.projectId,c=this.c.version;if(b){var d=this.a.m;x(this.a,this.A(b,c),function(c){if(c)a([]);else if(d["__mti_fntLst"+b]){c=d["__mti_fntLst"+b]();var e=[];if(c)for(var g=0;g<c.length;g++)e.push(new A(c[g].fontfamily));a(e)}else a([])}).id="__MonotypeAPIScript__"+b}else a([])},pa.prototype.load=function(a){var b,c,d=this.c.urls||[],f=this.c.families||[],e=this.c.testStrings||{};for(b=0,c=d.length;c>b;b++)w(this.a,d[b]);for(d=[],b=0,c=f.length;c>b;b++){var g=f[b].split(":");if(g[1])for(var l=g[1].split(","),h=0;h<l.length;h+=1)d.push(new A(g[0],l[h]));else d.push(new A(g[0]))}a(d,e)};var Z=new R(window);Z.p.t.custom=function(a,b){return new pa(b,a)},Z.p.t.fontdeck=function(a,b){return new W(b,a)},Z.p.t.monotype=function(a,b){return new Y(b,a)},Z.p.t.typekit=function(a,b){return new X(b,a)},Z.p.t.google=function(a,b){return new V(b,a)};var $={load:n(Z.load,Z)};window.WebFont=$,"function"==typeof define&&define.amd?define(function(){return $}):"undefined"!=typeof module&&module.exports?module.exports=$:window.WebFontConfig&&Z.load(window.WebFontConfig)}();
//# sourceMappingURL=libraries--webfontloader.map

/* For licensing information see http://contextlysitescripts.contextly.com/kit/assets/3.6.1/licenses.txt */
!function(window,document,location,setTimeout,decodeURIComponent,encodeURIComponent){function isHostMethod(object,property){var t=typeof object[property];return"function"==t||!("object"!=t||!object[property])||"unknown"==t}function isHostObject(object,property){return!("object"!=typeof object[property]||!object[property])}function isArray(o){return"[object Array]"===Object.prototype.toString.call(o)}function hasFlash(){var name="Shockwave Flash",mimeType="application/x-shockwave-flash";if(!undef(navigator.plugins)&&"object"==typeof navigator.plugins[name]){var description=navigator.plugins[name].description;description&&!undef(navigator.mimeTypes)&&navigator.mimeTypes[mimeType]&&navigator.mimeTypes[mimeType].enabledPlugin&&(flashVersion=description.match(/\d+/g))}if(!flashVersion){var flash;try{flash=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),flashVersion=Array.prototype.slice.call(flash.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),flash=null}catch(notSupportedException){}}if(!flashVersion)return!1;var major=parseInt(flashVersion[0],10),minor=parseInt(flashVersion[1],10);return HAS_FLASH_THROTTLED_BUG=major>9&&minor>0,!0}function dom_onReady(){if(!domIsReady){domIsReady=!0;for(var i=0;i<domReadyQueue.length;i++)domReadyQueue[i]();domReadyQueue.length=0}}function whenReady(fn,scope){return domIsReady?void fn.call(scope):void domReadyQueue.push(function(){fn.call(scope)})}function getParentObject(){var obj=parent;if(""!==namespace)for(var i=0,ii=namespace.split(".");i<ii.length;i++)obj=obj[ii[i]];return obj.easyXDM}function noConflict(ns){return window.easyXDM=_easyXDM,namespace=ns,namespace&&(IFRAME_PREFIX="easyXDM_"+namespace.replace(".","_")+"_"),easyXDM}function getDomainName(url){return url.match(reURI)[3]}function getPort(url){return url.match(reURI)[4]||""}function getLocation(url){var m=url.toLowerCase().match(reURI),proto=m[2],domain=m[3],port=m[4]||"";return("http:"==proto&&":80"==port||"https:"==proto&&":443"==port)&&(port=""),proto+"//"+domain+port}function resolveUrl(url){if(url=url.replace(reDoubleSlash,"$1/"),!url.match(/^(http||https):\/\//)){var path="/"===url.substring(0,1)?"":location.pathname;"/"!==path.substring(path.length-1)&&(path=path.substring(0,path.lastIndexOf("/")+1)),url=location.protocol+"//"+location.host+path+url}for(;reParent.test(url);)url=url.replace(reParent,"");return url}function appendQueryParameters(url,parameters){var hash="",indexOf=url.indexOf("#");-1!==indexOf&&(hash=url.substring(indexOf),url=url.substring(0,indexOf));var q=[];for(var key in parameters)parameters.hasOwnProperty(key)&&q.push(key+"="+encodeURIComponent(parameters[key]));return url+(useHash?"#":-1==url.indexOf("?")?"?":"&")+q.join("&")+hash}function undef(v){return"undefined"==typeof v}function apply(destination,source,noOverwrite){var member;for(var prop in source)source.hasOwnProperty(prop)&&(prop in destination?(member=source[prop],"object"==typeof member?apply(destination[prop],member,noOverwrite):noOverwrite||(destination[prop]=source[prop])):destination[prop]=source[prop]);return destination}function testForNamePropertyBug(){var form=document.body.appendChild(document.createElement("form")),input=form.appendChild(document.createElement("input"));input.name=IFRAME_PREFIX+"TEST"+channelId,HAS_NAME_PROPERTY_BUG=input!==form.elements[input.name],document.body.removeChild(form)}function createFrame(config){undef(HAS_NAME_PROPERTY_BUG)&&testForNamePropertyBug();var frame;HAS_NAME_PROPERTY_BUG?frame=document.createElement('<iframe name="'+config.props.name+'"/>'):(frame=document.createElement("IFRAME"),frame.name=config.props.name),frame.id=frame.name=config.props.name,delete config.props.name,"string"==typeof config.container&&(config.container=document.getElementById(config.container)),config.container||(apply(frame.style,{position:"absolute",top:"-2000px",left:"0px"}),config.container=document.body);var src=config.props.src;if(config.props.src="javascript:false",apply(frame,config.props),frame.border=frame.frameBorder=0,frame.allowTransparency=!0,config.container.appendChild(frame),config.onLoad&&on(frame,"load",config.onLoad),config.usePost){var input,form=config.container.appendChild(document.createElement("form"));if(form.target=frame.name,form.action=src,form.method="POST","object"==typeof config.usePost)for(var i in config.usePost)config.usePost.hasOwnProperty(i)&&(HAS_NAME_PROPERTY_BUG?input=document.createElement('<input name="'+i+'"/>'):(input=document.createElement("INPUT"),input.name=i),input.value=config.usePost[i],form.appendChild(input));form.submit(),form.parentNode.removeChild(form)}else frame.src=src;return config.props.src=src,frame}function checkAcl(acl,domain){"string"==typeof acl&&(acl=[acl]);for(var re,i=acl.length;i--;)if(re=acl[i],re=new RegExp("^"==re.substr(0,1)?re:"^"+re.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),re.test(domain))return!0;return!1}function prepareTransportStack(config){var stackEls,protocol=config.protocol;if(config.isHost=config.isHost||undef(query.xdm_p),useHash=config.hash||!1,config.props||(config.props={}),config.isHost)config.remote=resolveUrl(config.remote),config.channel=config.channel||"default"+channelId++,config.secret=Math.random().toString(16).substring(2),undef(protocol)&&(protocol=getLocation(location.href)==getLocation(config.remote)?"4":isHostMethod(window,"postMessage")||isHostMethod(document,"postMessage")?"1":config.swf&&isHostMethod(window,"ActiveXObject")&&hasFlash()?"6":"Gecko"===navigator.product&&"frameElement"in window&&-1==navigator.userAgent.indexOf("WebKit")?"5":config.remoteHelper?"2":"0");else if(config.channel=query.xdm_c.replace(/["'<>\\]/g,""),config.secret=query.xdm_s,config.remote=query.xdm_e.replace(/["'<>\\]/g,""),protocol=query.xdm_p,config.acl&&!checkAcl(config.acl,config.remote))throw new Error("Access denied for "+config.remote);switch(config.protocol=protocol,protocol){case"0":if(apply(config,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),config.isHost){if(!config.local){for(var image,domain=location.protocol+"//"+location.host,images=document.body.getElementsByTagName("img"),i=images.length;i--;)if(image=images[i],image.src.substring(0,domain.length)===domain){config.local=image.src;break}config.local||(config.local=window)}var parameters={xdm_c:config.channel,xdm_p:0};config.local===window?(config.usePolling=!0,config.useParent=!0,config.local=location.protocol+"//"+location.host+location.pathname+location.search,parameters.xdm_e=config.local,parameters.xdm_pa=1):parameters.xdm_e=resolveUrl(config.local),config.container&&(config.useResize=!1,parameters.xdm_po=1),config.remote=appendQueryParameters(config.remote,parameters)}else apply(config,{channel:query.xdm_c,remote:query.xdm_e,useParent:!undef(query.xdm_pa),usePolling:!undef(query.xdm_po),useResize:config.useParent?!1:config.useResize});stackEls=[new easyXDM.stack.HashTransport(config),new easyXDM.stack.ReliableBehavior({}),new easyXDM.stack.QueueBehavior({encode:!0,maxLength:4e3-config.remote.length}),new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"1":stackEls=[new easyXDM.stack.PostMessageTransport(config)];break;case"2":config.isHost&&(config.remoteHelper=resolveUrl(config.remoteHelper)),stackEls=[new easyXDM.stack.NameTransport(config),new easyXDM.stack.QueueBehavior,new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"3":stackEls=[new easyXDM.stack.NixTransport(config)];break;case"4":stackEls=[new easyXDM.stack.SameOriginTransport(config)];break;case"5":stackEls=[new easyXDM.stack.FrameElementTransport(config)];break;case"6":flashVersion||hasFlash(),stackEls=[new easyXDM.stack.FlashTransport(config)]}return stackEls.push(new easyXDM.stack.QueueBehavior({lazy:config.lazy,remove:!0})),stackEls}function chainStack(stackElements){for(var stackEl,defaults={incoming:function(message,origin){this.up.incoming(message,origin)},outgoing:function(message,recipient){this.down.outgoing(message,recipient)},callback:function(success){this.up.callback(success)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},i=0,len=stackElements.length;len>i;i++)stackEl=stackElements[i],apply(stackEl,defaults,!0),0!==i&&(stackEl.down=stackElements[i-1]),i!==len-1&&(stackEl.up=stackElements[i+1]);return stackEl}function removeFromStack(element){element.up.down=element.down,element.down.up=element.up,element.up=element.down=null}var HAS_NAME_PROPERTY_BUG,flashVersion,HAS_FLASH_THROTTLED_BUG,on,un,global=this,channelId=Math.floor(1e4*Math.random()),emptyFn=Function.prototype,reURI=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,reParent=/[\-\w]+\/\.\.\//,reDoubleSlash=/([^:])\/\//g,namespace="",easyXDM={},_easyXDM=window.easyXDM,IFRAME_PREFIX="easyXDM_",useHash=!1;if(isHostMethod(window,"addEventListener"))on=function(target,type,listener){target.addEventListener(type,listener,!1)},un=function(target,type,listener){target.removeEventListener(type,listener,!1)};else{if(!isHostMethod(window,"attachEvent"))throw new Error("Browser not supported");on=function(object,sEvent,fpNotify){object.attachEvent("on"+sEvent,fpNotify)},un=function(object,sEvent,fpNotify){object.detachEvent("on"+sEvent,fpNotify)}}var readyState,domIsReady=!1,domReadyQueue=[];if("readyState"in document?(readyState=document.readyState,domIsReady="complete"==readyState||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==readyState||"interactive"==readyState)):domIsReady=!!document.body,!domIsReady){if(isHostMethod(window,"addEventListener"))on(document,"DOMContentLoaded",dom_onReady);else if(on(document,"readystatechange",function(){"complete"==document.readyState&&dom_onReady()}),document.documentElement.doScroll&&window===top){var doScrollCheck=function(){if(!domIsReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(doScrollCheck,1)}dom_onReady()}};doScrollCheck()}on(window,"load",dom_onReady)}var query=function(input){input=input.substring(1).split("&");for(var pair,data={},i=input.length;i--;)pair=input[i].split("="),data[pair[0]]=decodeURIComponent(pair[1]);return data}(/xdm_e=/.test(location.search)?location.search:location.hash),getJSON=function(){var cached={},obj={a:[1,2,3]},json='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(obj).replace(/\s/g,"")===json?JSON:(Object.toJSON&&Object.toJSON(obj).replace(/\s/g,"")===json&&(cached.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(obj=json.evalJSON(),obj.a&&3===obj.a.length&&3===obj.a[2]&&(cached.parse=function(str){return str.evalJSON()})),cached.stringify&&cached.parse?(getJSON=function(){return cached},cached):null)};apply(easyXDM,{version:"2.4.19.3",query:query,stack:{},apply:apply,getJSONObject:getJSON,whenReady:whenReady,noConflict:noConflict}),easyXDM.DomHelper={on:on,un:un,requiresJSON:function(path){isHostObject(window,"JSON")||document.write('<script type="text/javascript" src="'+path+'"></script>')}},function(){var _map={};easyXDM.Fn={set:function(name,fn){_map[name]=fn},get:function(name,del){if(_map.hasOwnProperty(name)){var fn=_map[name];return del&&delete _map[name],fn}}}}(),easyXDM.Socket=function(config){var stack=chainStack(prepareTransportStack(config).concat([{incoming:function(message,origin){config.onMessage(message,origin)},callback:function(success){config.onReady&&config.onReady(success)}}])),recipient=getLocation(config.remote);this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},this.postMessage=function(message){stack.outgoing(message,recipient)},stack.init()},easyXDM.Rpc=function(config,jsonRpcConfig){if(jsonRpcConfig.local)for(var method in jsonRpcConfig.local)if(jsonRpcConfig.local.hasOwnProperty(method)){var member=jsonRpcConfig.local[method];"function"==typeof member&&(jsonRpcConfig.local[method]={method:member})}var stack=chainStack(prepareTransportStack(config).concat([new easyXDM.stack.RpcBehavior(this,jsonRpcConfig),{callback:function(success){config.onReady&&config.onReady(success)}}]));this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},stack.init()},easyXDM.stack.SameOriginTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send(message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:location.protocol+"//"+location.host+location.pathname,xdm_c:config.channel,xdm_p:4}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),easyXDM.Fn.set(config.channel,function(sendFn){return send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}})):(send=getParentObject().Fn.get(config.channel,!0)(function(msg){pub.up.incoming(msg,targetOrigin)}),setTimeout(function(){pub.up.callback(!0)},0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FlashTransport=function(config){function onMessage(message){setTimeout(function(){pub.up.incoming(message,targetOrigin)},0)}function addSwf(domain){var url=config.swf+"?host="+config.isHost,id="easyXDM_swf_"+Math.floor(1e4*Math.random());easyXDM.Fn.set("flash_loaded"+domain.replace(/[\-.]/g,"_"),function(){easyXDM.stack.FlashTransport[domain].swf=swf=swfContainer.firstChild;for(var queue=easyXDM.stack.FlashTransport[domain].queue,i=0;i<queue.length;i++)queue[i]();queue.length=0}),config.swfContainer?swfContainer="string"==typeof config.swfContainer?document.getElementById(config.swfContainer):config.swfContainer:(swfContainer=document.createElement("div"),apply(swfContainer.style,HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),document.body.appendChild(swfContainer));var flashVars="callback=flash_loaded"+encodeURIComponent(domain.replace(/[\-.]/g,"_"))+"&proto="+global.location.protocol+"&domain="+encodeURIComponent(getDomainName(global.location.href))+"&port="+encodeURIComponent(getPort(global.location.href))+"&ns="+encodeURIComponent(namespace);swfContainer.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+id+"' data='"+url+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+url+"'></param><param name='flashvars' value='"+flashVars+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+flashVars+"' allowScriptAccess='always' wmode='transparent' src='"+url+"' height='1' width='1'></embed></object>"}var pub,frame,targetOrigin,swf,swfContainer;return pub={outgoing:function(message,domain,fn){swf.postMessage(config.channel,message.toString()),fn&&fn()},destroy:function(){try{swf.destroyChannel(config.channel)}catch(e){}swf=null,frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=config.remote,easyXDM.Fn.set("flash_"+config.channel+"_init",function(){setTimeout(function(){pub.up.callback(!0)})}),easyXDM.Fn.set("flash_"+config.channel+"_onMessage",onMessage),config.swf=resolveUrl(config.swf);var swfdomain=getDomainName(config.swf),fn=function(){easyXDM.stack.FlashTransport[swfdomain].init=!0,swf=easyXDM.stack.FlashTransport[swfdomain].swf,swf.createChannel(config.channel,config.secret,getLocation(config.remote),config.isHost),config.isHost&&(HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle&&apply(config.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:6,xdm_s:config.secret}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config))};easyXDM.stack.FlashTransport[swfdomain]&&easyXDM.stack.FlashTransport[swfdomain].init?fn():easyXDM.stack.FlashTransport[swfdomain]?easyXDM.stack.FlashTransport[swfdomain].queue.push(fn):(easyXDM.stack.FlashTransport[swfdomain]={queue:[fn]},addSwf(swfdomain))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.PostMessageTransport=function(config){function _getOrigin(event){if(event.origin)return getLocation(event.origin);if(event.uri)return getLocation(event.uri);if(event.domain)return location.protocol+"//"+event.domain;throw"Unable to retrieve the origin of the event"}function _window_onMessage(event){var origin=_getOrigin(event);origin==targetOrigin&&event.data.substring(0,config.channel.length+1)==config.channel+" "&&pub.up.incoming(event.data.substring(config.channel.length+1),origin)}var pub,frame,callerWindow,targetOrigin;return pub={outgoing:function(message,domain,fn){callerWindow.postMessage(config.channel+" "+message,domain||targetOrigin),fn&&fn()},destroy:function(){un(window,"message",_window_onMessage),frame&&(callerWindow=null,frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){if(targetOrigin=getLocation(config.remote),config.isHost){var waitForReady=function(event){event.data==config.channel+"-ready"&&(callerWindow="postMessage"in frame.contentWindow?frame.contentWindow:frame.contentWindow.document,un(window,"message",waitForReady),on(window,"message",_window_onMessage),setTimeout(function(){pub.up.callback(!0)},0))};on(window,"message",waitForReady),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:1}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config)}else on(window,"message",_window_onMessage),callerWindow="postMessage"in window.parent?window.parent:window.parent.document,callerWindow.postMessage(config.channel+"-ready",targetOrigin),setTimeout(function(){pub.up.callback(!0)},0)},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FrameElementTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send.call(this,message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:5}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),frame.fn=function(sendFn){return delete frame.fn,send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}}):(document.referrer&&getLocation(document.referrer)!=query.xdm_e&&(window.top.location=query.xdm_e),send=window.frameElement.fn(function(msg){pub.up.incoming(msg,targetOrigin)}),pub.up.callback(!0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.NameTransport=function(config){function _sendMessage(message){var url=config.remoteHelper+(isHost?"#_3":"#_2")+config.channel;callerWindow.contentWindow.sendMessage(message,url)}function _onReady(){isHost?2!==++readyCount&&isHost||pub.up.callback(!0):(_sendMessage("ready"),pub.up.callback(!0))}function _onMessage(message){pub.up.incoming(message,remoteOrigin)}function _onLoad(){callback&&setTimeout(function(){callback(!0)},0)}var pub,isHost,callerWindow,remoteWindow,readyCount,callback,remoteOrigin,remoteUrl;return pub={outgoing:function(message,domain,fn){callback=fn,_sendMessage(message)},destroy:function(){callerWindow.parentNode.removeChild(callerWindow),callerWindow=null,isHost&&(remoteWindow.parentNode.removeChild(remoteWindow),remoteWindow=null)},onDOMReady:function(){isHost=config.isHost,readyCount=0,remoteOrigin=getLocation(config.remote),config.local=resolveUrl(config.local),isHost?(easyXDM.Fn.set(config.channel,function(message){isHost&&"ready"===message&&(easyXDM.Fn.set(config.channel,_onMessage),_onReady())}),remoteUrl=appendQueryParameters(config.remote,{xdm_e:config.local,xdm_c:config.channel,xdm_p:2}),apply(config.props,{src:remoteUrl+"#"+config.channel,name:IFRAME_PREFIX+config.channel+"_provider"}),remoteWindow=createFrame(config)):(config.remoteHelper=config.remote,easyXDM.Fn.set(config.channel,_onMessage));var onLoad=function(){var w=callerWindow||this;un(w,"load",onLoad),easyXDM.Fn.set(config.channel+"_load",_onLoad),function test(){"function"==typeof w.contentWindow.sendMessage?_onReady():setTimeout(test,50)}()};callerWindow=createFrame({props:{src:config.local+"#_4"+config.channel},onLoad:onLoad})},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.HashTransport=function(config){function _sendMessage(message){if(_callerWindow){var url=config.remote+"#"+_msgNr++ +"_"+message;(isHost||!useParent?_callerWindow.contentWindow:_callerWindow).location=url}}function _handleHash(hash){_lastMsg=hash,pub.up.incoming(_lastMsg.substring(_lastMsg.indexOf("_")+1),_remoteOrigin)}function _pollHash(){if(_listenerWindow){var href=_listenerWindow.location.href,hash="",indexOf=href.indexOf("#");-1!=indexOf&&(hash=href.substring(indexOf)),hash&&hash!=_lastMsg&&_handleHash(hash)}}function _attachListeners(){_timer=setInterval(_pollHash,pollInterval)}var pub,isHost,_timer,pollInterval,_lastMsg,_msgNr,_listenerWindow,_callerWindow,useParent,_remoteOrigin;return pub={outgoing:function(message){_sendMessage(message)},destroy:function(){window.clearInterval(_timer),(isHost||!useParent)&&_callerWindow.parentNode.removeChild(_callerWindow),_callerWindow=null},onDOMReady:function(){if(isHost=config.isHost,pollInterval=config.interval,_lastMsg="#"+config.channel,_msgNr=0,useParent=config.useParent,_remoteOrigin=getLocation(config.remote),isHost){if(apply(config.props,{src:config.remote,name:IFRAME_PREFIX+config.channel+"_provider"}),useParent)config.onLoad=function(){_listenerWindow=window,_attachListeners(),pub.up.callback(!0)};else{var tries=0,max=config.delay/50;!function getRef(){if(++tries>max)throw new Error("Unable to reference listenerwindow");try{_listenerWindow=_callerWindow.contentWindow.frames[IFRAME_PREFIX+config.channel+"_consumer"]}catch(ex){}_listenerWindow?(_attachListeners(),pub.up.callback(!0)):setTimeout(getRef,50)}()}_callerWindow=createFrame(config)}else _listenerWindow=window,_attachListeners(),useParent?(_callerWindow=parent,pub.up.callback(!0)):(apply(config,{props:{src:config.remote+"#"+config.channel+new Date,name:IFRAME_PREFIX+config.channel+"_consumer"},onLoad:function(){pub.up.callback(!0)}}),_callerWindow=createFrame(config))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.ReliableBehavior=function(){var pub,callback,idOut=0,idIn=0,currentMessage="";return pub={incoming:function(message,origin){var indexOf=message.indexOf("_"),ack=message.substring(0,indexOf).split(",");message=message.substring(indexOf+1),ack[0]==idOut&&(currentMessage="",callback&&callback(!0)),message.length>0&&(pub.down.outgoing(ack[1]+","+idOut+"_"+currentMessage,origin),idIn!=ack[1]&&(idIn=ack[1],pub.up.incoming(message,origin)))},outgoing:function(message,origin,fn){currentMessage=message,callback=fn,pub.down.outgoing(idIn+","+ ++idOut+"_"+message,origin)}}},easyXDM.stack.QueueBehavior=function(config){function dispatch(){if(config.remove&&0===queue.length)return void removeFromStack(pub);if(!waiting&&0!==queue.length&&!destroying){waiting=!0;var message=queue.shift();pub.down.outgoing(message.data,message.origin,function(success){waiting=!1,message.callback&&setTimeout(function(){message.callback(success)},0),dispatch()})}}var pub,destroying,queue=[],waiting=!0,incoming="",maxLength=0,lazy=!1,doFragment=!1;return pub={init:function(){undef(config)&&(config={}),config.maxLength&&(maxLength=config.maxLength,doFragment=!0),config.lazy?lazy=!0:pub.down.init()},callback:function(success){waiting=!1;var up=pub.up;dispatch(),up.callback(success)},incoming:function(message,origin){if(doFragment){var indexOf=message.indexOf("_"),seq=parseInt(message.substring(0,indexOf),10);incoming+=message.substring(indexOf+1),0===seq&&(config.encode&&(incoming=decodeURIComponent(incoming)),pub.up.incoming(incoming,origin),incoming="")}else pub.up.incoming(message,origin)},outgoing:function(message,origin,fn){config.encode&&(message=encodeURIComponent(message));var fragment,fragments=[];if(doFragment){for(;0!==message.length;)fragment=message.substring(0,maxLength),message=message.substring(fragment.length),fragments.push(fragment);for(;fragment=fragments.shift();)queue.push({data:fragments.length+"_"+fragment,origin:origin,callback:0===fragments.length?fn:null})}else queue.push({data:message,origin:origin,callback:fn});lazy?pub.down.init():dispatch()},destroy:function(){destroying=!0,pub.down.destroy()}}},easyXDM.stack.VerifyBehavior=function(config){function startVerification(){mySecret=Math.random().toString(16).substring(2),pub.down.outgoing(mySecret)}var pub,mySecret,theirSecret;return pub={incoming:function(message,origin){var indexOf=message.indexOf("_");-1===indexOf?message===mySecret?pub.up.callback(!0):theirSecret||(theirSecret=message,config.initiate||startVerification(),pub.down.outgoing(message)):message.substring(0,indexOf)===theirSecret&&pub.up.incoming(message.substring(indexOf+1),origin)},outgoing:function(message,origin,fn){pub.down.outgoing(mySecret+"_"+message,origin,fn)},callback:function(){config.initiate&&startVerification()}}},easyXDM.stack.RpcBehavior=function(proxy,config){function _send(data){data.jsonrpc="2.0",pub.down.outgoing(serializer.stringify(data))}function _createMethod(definition,method){var slice=Array.prototype.slice;return function(){var callback,l=arguments.length,message={method:method};l>0&&"function"==typeof arguments[l-1]?(l>1&&"function"==typeof arguments[l-2]?(callback={success:arguments[l-2],error:arguments[l-1]},message.params=slice.call(arguments,0,l-2)):(callback={success:arguments[l-1]},message.params=slice.call(arguments,0,l-1)),_callbacks[""+ ++_callbackCounter]=callback,message.id=_callbackCounter):message.params=slice.call(arguments,0),definition.namedParams&&1===message.params.length&&(message.params=message.params[0]),_send(message)}}function _executeMethod(method,id,fn,params){if(!fn)return void(id&&_send({id:id,error:{code:-32601,message:"Procedure not found."}}));var success,error;id?(success=function(result){success=emptyFn,_send({id:id,result:result})},error=function(message,data){error=emptyFn;var msg={id:id,error:{code:-32099,message:message}};data&&(msg.error.data=data),_send(msg)}):success=error=emptyFn,isArray(params)||(params=[params]);try{var result=fn.method.apply(fn.scope,params.concat([success,error]));undef(result)||success(result)}catch(ex1){error(ex1.message)}}var pub,serializer=config.serializer||getJSON(),_callbackCounter=0,_callbacks={};return pub={incoming:function(message){var data=serializer.parse(message);if(data.method)config.handle?config.handle(data,_send):_executeMethod(data.method,data.id,config.local[data.method],data.params);else{var callback=_callbacks[data.id];data.error?callback.error&&callback.error(data.error):callback.success&&callback.success(data.result),delete _callbacks[data.id]}},init:function(){if(config.remote)for(var method in config.remote)config.remote.hasOwnProperty(method)&&(proxy[method]=_createMethod(config.remote[method],method));pub.down.init()},destroy:function(){for(var method in config.remote)config.remote.hasOwnProperty(method)&&proxy.hasOwnProperty(method)&&delete proxy[method];pub.down.destroy()}}},global.easyXDM=easyXDM}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);
//# sourceMappingURL=libraries--easy-xdm.map

/* For licensing information see http://contextlysitescripts.contextly.com/kit/assets/3.6.1/licenses.txt */
Contextly=window.Contextly||{},Contextly.createClass=function(data){var abstracts=data.abstracts||[],statics=data.statics||{},extend=data.extend||[];extend instanceof Array||(extend=[extend]);var constructor;constructor=data.construct?data.construct:extend.length?function(){for(var i=0;i<extend.length;i++)extend[i].apply(this,arguments)}:function(){};var proto={};delete data.construct,delete data.abstracts,delete data.statics,delete data.extend;for(var i=0;i<extend.length;i++){var parent=extend[i];for(var p in parent)"function"==typeof parent[p]&&"construct"!=p&&(constructor[p]=parent[p]);for(var p in parent.prototype)"function"==typeof parent.prototype[p]&&"constructor"!=p&&(proto[p]=parent.prototype[p])}if(statics.abstracts)for(var p=0;p<statics.abstracts.length;p++)proto[statics.abstracts[p]]=Contextly.abstractMethod(p);for(var p=0;p<abstracts.length;p++)proto[abstracts[p]]=Contextly.abstractMethod(p);proto.instanceOf=function(_class){if(arguments.length>1){for(var res=!0,i=0;i<arguments.length;i++)res=res&&this.instanceOf(arguments[i]);return res}if(constructor===_class)return!0;for(var i=0;i<extend.length;i++)if(extend[i].prototype.instanceOf.call(this,_class))return!0;return _class===Object};for(var p in data)"function"==typeof data[p]&&(proto[p]=data[p]);for(var p in statics)"function"==typeof statics[p]&&(constructor[p]=statics[p]);if("undefined"==typeof constructor.construct&&extend.length){for(var parentStaticConstructors=[],i=0;i<extend.length;i++){var parent=extend[i];"function"==typeof parent.construct&&parentStaticConstructors.push(parent.construct)}parentStaticConstructors.length&&(constructor.construct=function(){for(var i=0;i<parentStaticConstructors.length;i++)parentStaticConstructors[i].call(this)})}return"function"==typeof constructor.construct&&constructor.construct.call(constructor),constructor.prototype=proto,constructor.fn=proto,constructor},Contextly.abstractMethod=function(name){return function(){throw name?name+" is abstract method.":"Abstract method must not be called directly."}},function($){Contextly.Proxy=Contextly.createClass({proxy:function(func,passContext,passArguments){func.guid||(func.guid=$.guid++);var proxy,self=this;return proxy=passArguments?passContext?function(){return Array.prototype.unshift.call(arguments,this),func.apply(self,arguments)}:function(){return func.apply(self,arguments)}:passContext?function(){return func.call(self,this)}:function(){return func.call(self)},proxy.guid=func.guid,proxy},each:function(collection,func){return $.each(collection,this.proxy(func,!0,!0))},eachElement:function(elements,func){return this.each(elements,function(){return arguments[0]=$(arguments[0]),func.apply(this,arguments)})}})}(jQuery),function(){Contextly.Utils=Contextly.createClass({statics:{dateTextDiff:function(date){if(date&&date.length>4){var ending,t=date.split(/[- :]/),js_date=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]),timestamp=js_date.getTime()/1e3,difference=(new Date).getTime()/1e3-timestamp,periods=new Array("sec","min","hour","day","week","month","year","decade"),lengths=new Array("60","60","24","7","4.35","12","10");if(!(difference>0))return"right now";ending="ago";for(var j=0;difference>=lengths[j];j++)difference/=lengths[j];return difference=Math.round(difference),1!=difference&&(periods[j]+="s"),difference+"&nbsp;"+periods[j]+"&nbsp;"+ending}},escape:function(text){return text?text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},escapeSizzleAttrValue:function(value){return value?value.replace('"','\\"'):""},logError:function(){window.console&&"function"==typeof console.error&&console.error.apply(console,arguments)},isEmailValid:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)},isArray:function(o){return"[object Array]"===Object.prototype.toString.call(o)},isString:function(o){return"string"==typeof o||o instanceof String},isEmptyObject:function(o){for(var key in o)return!1;return!0},error:function(msg){throw new Error(msg)},escapeRegexp:function(str){return str?str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):""},parseUrlQueryParameter:function(key,url){var expression="[\\?&]"+this.escapeRegexp(key)+"=([^&#]*)",regexp=new RegExp(expression),results=regexp.exec(url);return null==results?"":results[1]}}})}(jQuery),function(){Contextly.metadataParser=Contextly.metadataParser||{},Contextly.metadataFormats=Contextly.metadataFormats||{},Contextly.metadataParser.Base=Contextly.createClass({statics:{dataExists:Contextly.abstractMethod(),getData:Contextly.abstractMethod(),getCount:function(key){var data=this.getData(key);return Contextly.Utils.isArray(data)&&data.length?data.length:0}}})}(jQuery),function(){Contextly.metadataParser.BaseSingleTag=Contextly.createClass({extend:Contextly.metadataParser.Base,statics:{findSource:Contextly.abstractMethod(),parseSource:Contextly.abstractMethod(),getSource:function(){return"undefined"==typeof this.source&&(this.source=this.findSource()),this.source},dataExists:function(){return!!this.getSource()},getData:function(key){return"undefined"==typeof this.data&&(this.data=this.parseSource()),this.data[key]},parseJson:function(text,fallback){if(text)try{return JSON.parse(text)}catch(e){Contextly.Utils.logError("Unable to parse metadata",e)}return fallback}}})}(jQuery),function(){Contextly.metadataParser.BaseMultiTag=Contextly.createClass({extend:Contextly.metadataParser.Base,statics:{getTags:Contextly.abstractMethod(),getTagValue:Contextly.abstractMethod(),construct:function(){this.parsed={},this.data={}},dataExists:function(){for(var req=["url","title"],i=0;i<req.length;i++)if("undefined"==typeof this.getData(req[i]))return!1;return!0},getSourceValue:function(sourceKey){var tags=this.getTags(sourceKey);if(tags.length){if(1==tags.length)return this.getTagValue(sourceKey,tags);for(var result=[],i=0;i<tags.length;i++){var tagValue=this.getTagValue(sourceKey,tags.eq(i));null!=tagValue&&result.push(tagValue)}return result.length?result:void 0}},getValue:function(key){if(this.propertiesMap[key])for(var i=0;i<this.propertiesMap[key].length;i++){var src=this.propertiesMap[key][i],candidate=this.getSourceValue(src);if(candidate=this.convert(src,candidate),null!=candidate)return candidate}},getData:function(key){if(!this.parsed[key]){this.parsed[key]=!0;var value=this.getValue(key);null!=value&&(this.data[key]=value)}return this.data[key]}}})}(jQuery),function(){Contextly.metadataParser.ForeignHelper=Contextly.createClass({statics:{construct:function(){this.converters=this.getConverters(),this.propertiesMap=this.getPropertiesMap()},getConverters:function(){return{}},getPropertiesMap:function(){return{}},map:function(key,raw,fallback){if("undefined"!=typeof this.propertiesMap[key])for(var i=0;i<this.propertiesMap[key].length;i++){var src=this.propertiesMap[key][i],value=this.convert(src,raw[src]);if("undefined"!=typeof value)return value}return fallback},mapAll:function(raw,fallback){var data={};for(var key in this.propertiesMap){var value=this.map(key,raw,fallback);"undefined"!=typeof value&&(data[key]=value)}return data},convert:function(key,value){return null!=value?null==this.converters[key]?value:this.converters[key](value):void 0},convertToArray:function(value){return Contextly.Utils.isArray(value)?value:[value]},convertToCommaSeparated:function(value){return Contextly.Utils.isArray(value)?value.length?value.join(", "):void 0:value},convertDateIso8601:function(value){var parts=value.match(/^([\d\-]+)(?:T([\d:]+))?/);if(parts){var parsedDate=parts[1].match(/^(\d+)\-(\d+)\-(\d+)$/)||parts[1].match(/^(\d{4})(\d{2})(\d{2})$/);if(parsedDate){var result=parsedDate[1]+"-"+parsedDate[2]+"-"+parsedDate[3],parsedTime=[];parts[2]&&(parsedTime=parts[2].match(/^(\d{2})(?::(\d{2}))?(?::(\d{2}))?$/)||parts[2].match(/^(\d{2})(\d{2})?(\d{2})?$/)||[]);var defaultTime=[null,"12","00","00"];return result+=" "+(parsedTime[1]||defaultTime[1])+":"+(parsedTime[2]||defaultTime[2])+":"+(parsedTime[3]||defaultTime[3])}}},convertSplitByComma:function(value){return Contextly.Utils.isArray(value)?value.length?value:void 0:value.split(/\s*,\s*/)},convertUrlToAbsolute:function(value){if(value){var a=document.createElement("a");return a.href=value,a.protocol+"//"+a.host+a.pathname+a.search+a.hash}}}})}(jQuery),function($){Contextly.metadataParser.Default=Contextly.createClass({extend:Contextly.metadataParser.BaseSingleTag,statics:{findSource:function(){return $('meta[name="contextly-page"][content]:first').attr("content")},parseSource:function(){return this.parseJson(this.getSource(),{})}}})}(jQuery),function($){Contextly.metadataParser.DublinCore=Contextly.createClass({extend:[Contextly.metadataParser.BaseMultiTag,Contextly.metadataParser.ForeignHelper],statics:{getPropertiesMap:function(){return{title:["DC.title"],author_name:["DC.publisher"],pub_date:["DC.date.published"],url:["DC.identifier"]}},getConverters:function(){return{"DC.identifier":this.convertUrlToAbsolute}},getTags:function(sourceKey){return $('meta[name="'+sourceKey+'"][content]:first')},getTagValue:function(sourceKey,tag){return tag.attr("content")}}}),Contextly.metadataFormats.DC=Contextly.metadataParser.DublinCore}(jQuery),function($){Contextly.metadataParser.JsonLd=Contextly.createClass({extend:[Contextly.metadataParser.BaseSingleTag,Contextly.metadataParser.ForeignHelper],statics:{getConverters:function(){return{creator:this.convertToCommaSeparated,founder:this.convertToCommaSeparated,dateCreated:this.convertDateIso8601,articleSection:this.convertToArray,thumbnailUrl:this.convertUrlToAbsolute,url:this.convertUrlToAbsolute}},getPropertiesMap:function(){return{post_id:["articleId"],title:["headline","description"],author_name:["creator","founder"],image:["thumbnailUrl"],pub_date:["dateCreated"],categories:["articleSection"],tags:["keywords"],url:["url"]}},findSource:function(){var result=null;return $('script[type="application/ld+json"]').each(function(){var text=$(this).html();try{var raw=JSON.parse(text);if((null!=raw.headline||null!=raw.description)&&null!=raw.url)return result=raw,!1}catch(e){Contextly.Utils.error("Unable to parse JSON LD element.")}}),result},parseSource:function(){return this.mapAll(this.getSource())}}}),Contextly.metadataFormats.JsonLD=Contextly.metadataParser.JsonLd}(jQuery),function($){Contextly.metadataParser.OpenGraph=Contextly.createClass({extend:[Contextly.metadataParser.BaseMultiTag,Contextly.metadataParser.ForeignHelper],statics:{getPropertiesMap:function(){return{title:["og:title"],image:["og:image"],mod_date:["article:modified_time"],pub_date:["article:published_time"],tags:["article:tag"],categories:["article:section"],url:["og:url"]}},getConverters:function(){return{"article:modified_time":this.convertDateIso8601,"article:published_time":this.convertDateIso8601,"article:tag":this.convertToArray,"article:section":this.convertToArray,"og:image":this.convertUrlToAbsolute,"og:url":this.convertUrlToAbsolute}},getTags:function(sourceKey){var selector='meta[property="'+sourceKey+'"][content]';return"article:tag"!==sourceKey&&(selector+=":first"),$(selector)},getTagValue:function(sourceKey,tag){return tag.attr("content")}}}),Contextly.metadataFormats.OG=Contextly.metadataParser.OpenGraph}(jQuery),function($){Contextly.metadataParser.ParselyPage=Contextly.createClass({extend:[Contextly.metadataParser.BaseSingleTag,Contextly.metadataParser.ForeignHelper],statics:{getPropertiesMap:function(){return{post_id:["post_id"],type:["type"],title:["title"],image:["image_url"],tags:["tags"],url:["link"],author_name:["authors"],categories:["section"],pub_date:["pub_date"]}},getConverters:function(){return{authors:this.convertToCommaSeparated,section:this.convertToArray,pub_date:this.convertDateIso8601,image_url:this.convertUrlToAbsolute,link:this.convertUrlToAbsolute}},findSource:function(){return $('meta[name="parsely-page"][content]:first').attr("content")},parseSource:function(){var source=this.getSource(),raw=this.parseJson(source,{});return this.mapAll(raw)}}}),Contextly.metadataFormats.ParselyPage=Contextly.metadataParser.ParselyPage}(jQuery),function($){Contextly.metadataParser.ParselyTags=Contextly.createClass({extend:[Contextly.metadataParser.BaseMultiTag,Contextly.metadataParser.ForeignHelper],statics:{getPropertiesMap:function(){return{post_id:["post-id"],type:["type"],title:["title"],author_name:["author"],image:["image-url"],pub_date:["pub-date"],categories:["section"],tags:["tags"],url:["link"]}},getConverters:function(){return{"pub-date":this.convertDateIso8601,section:this.convertToArray,tags:this.convertSplitByComma,"image-url":this.convertUrlToAbsolute,link:this.convertUrlToAbsolute}},getTags:function(sourceKey){return $('meta[name="parsely-'+sourceKey+'"][content]:first')},getTagValue:function(sourceKey,tag){return tag.attr("content")}}}),Contextly.metadataFormats.ParselyData=Contextly.metadataParser.ParselyTags}(jQuery),Contextly.BaseSettings=Contextly.createClass({statics:{getServerUrl:function(type){Contextly.data.urls[type]||Contextly.Utils.error(type+" server URL not found.");var urls=Contextly.data.urls[type];if(Contextly.Utils.isString(urls))return urls;var keys={};keys[this.getMode()]=!0,keys[this.isHttps()?"https":"http"]=!0;for(var key in keys)if("undefined"!=typeof urls[key]){if(Contextly.Utils.isString(urls[key])){var url=urls[key];return 0===url.indexOf("//")&&(url=(this.isHttps()?"https":"http")+":"+url),url}urls=urls[key]}Contextly.Utils.error(type+" server URL not found")},getMainServerUrl:function(){return this.getServerUrl("main")},getAPIServerUrl:function(){return this.getServerUrl("api")},getExperienceServerUrl:function(){return this.getServerUrl("experience")},getMetadataParser:function(){if("undefined"==typeof this.metadataParser&&(this.metadataParser=Contextly.metadataParser.Default,!this.metadataParser.dataExists()))for(var formats=this.getSupportedMetadataFormats(),i=0;i<formats.length;i++)if(formats[i].dataExists()){this.metadataParser=formats[i];break}return this.metadataParser},getSupportedMetadataFormats:function(){var result=[];for(var key in Contextly.metadataFormats){var parser=Contextly.metadataFormats[key];if("function"==typeof parser.getPropertiesMap){var map=parser.getPropertiesMap();if(map.post_id){result.unshift(parser);continue}}result.push(parser)}return result},getPostDataForKey:function(key){return this.getMetadataParser().getData(key)},getPostDataForKeyCount:function(key){return this.getMetadataParser().getCount(key)},getAppId:function(){return this.getPostDataForKey("app_id")},getPageId:function(){return this.getPostDataForKey("post_id")},getPostModifiedDate:function(){return this.getPostDataForKey("mod_date")},getPostCreatedDate:function(){return this.getPostDataForKey("pub_date")},getAuthorId:function(){return this.getPostDataForKey("author_id")},getPageUrl:function(){return this.getPostDataForKey("url")},getPostType:function(){return this.getPostDataForKey("type")},getPostCategories:function(){return this.getPostDataForKey("categories")},getPostTags:function(){return this.getPostDataForKey("tags")},getPostCategoriesCount:function(){return this.getPostDataForKeyCount("categories")},getPostTagsCount:function(){return this.getPostDataForKeyCount("tags")},isAdmin:function(){return!1},isBrandingDisplayed:function(){return!0},isHttps:function(){return"https:"===document.location.protocol},getClientInfo:function(){return null},getKitVersion:function(){return Contextly.data.versions.kit},getAssetUrl:function(path,ext){return this.getServerUrl("cdn")+this.getKitVersion()+"/"+path+"."+ext},getMode:function(){var mode=this.getPostDataForKey("mode");return null!=mode?mode:"live"}}}),Contextly.Settings=Contextly.BaseSettings,Contextly.Cookie=Contextly.createClass({statics:{encode:function(s){return encodeURIComponent(s)},decode:function(s){return decodeURIComponent(s)},stringifyCookieValue:function(value){return this.encode(JSON.stringify(value))},parseCookieValue:function(s){var pluses=/\+/g;0===s.indexOf('"')&&(s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{s=decodeURIComponent(s.replace(pluses," "))}catch(e){return}try{return JSON.parse(s)}catch(e){}},read:function(s){return this.parseCookieValue(s)},get:function(key){for(var result=key?void 0:{},cookies=document.cookie?document.cookie.split("; "):[],i=0,l=cookies.length;l>i;i++){var parts=cookies[i].split("="),name=this.decode(parts.shift()),cookie=parts.join("=");if(key&&key===name){result=this.read(cookie);break}key||void 0===(cookie=this.read(cookie))||(result[name]=cookie)}return result},set:function(key,value,options){if(void 0!==value&&!jQuery.isFunction(value)){if(options=jQuery.extend({},options),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[this.encode(key),"=",this.stringifyCookieValue(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}}}}),Contextly.Visitor=Contextly.createClass({statics:{construct:function(){this.guid=null},getCookieName:function(){return"contextly"},initIds:function(response){response&&(response.cookie_id&&!this.getId()&&this.setId(response.cookie_id),response.guid&&this.setGuid(response.guid))},setId:function(cookie_id){Contextly.Cookie.set(this.getCookieName(),{id:cookie_id},{expires:365,path:"/"})},getId:function(){var cookie=Contextly.Cookie.get(this.getCookieName());return cookie&&cookie.id&&"null"!=cookie.id?cookie.id:null},setGuid:function(guid){this.guid=guid},getGuid:function(){return this.guid}}}),Contextly.RESTClient=Contextly.createClass({statics:{getApiRPC:function(){if(!this.api_rpc){var remote_url=Contextly.Settings.getAPIServerUrl()+"/easy_xdm/cors/index.html";this.api_rpc=new easyXDM.Rpc({remote:remote_url},{remote:{request:{}}})}return this.api_rpc},getCommonParams:function(){var s=Contextly.Settings,params={version:s.getKitVersion(),site_path:s.getAppId(),admin:s.isAdmin(),page_id:s.getPageId(),type:s.getPostType(),c_date:s.getPostCreatedDate(),m_date:s.getPostModifiedDate(),c_count:s.getPostCategoriesCount(),t_count:s.getPostTagsCount(),url:s.getPageUrl(),guid:Contextly.Visitor.getGuid()},clientInfo=s.getClientInfo();return null!=clientInfo&&null!=clientInfo.client&&(params.client=clientInfo.client,null!=clientInfo.version&&(params.client+=":"+clientInfo.version)),params},call:function(api_name,api_method,params,callback){var api_url=Contextly.Settings.getAPIServerUrl()+api_name+"/"+api_method+"/";params=jQuery.extend(params,this.getCommonParams());var self=this;this.getApiRPC().request({url:api_url,method:"POST",data:params},function(response){"undefined"!=typeof callback&&self.restCallback(response,callback)})},restCallback:function(response,callback){if(response.data)try{var data=easyXDM.getJSONObject().parse(response.data);callback(data)}catch(e){Contextly.Utils.logError("Unable to parse/handle API response",response,e)}}}}),Contextly.RESTClient.errors={FORBIDDEN:403,SUSPENDED:408},function(){Contextly.CallbackQueue=Contextly.createClass({extend:Contextly.Proxy,construct:function(){this.left=0,this.lastId=0,this.finished=!1,this.reasons={},this.results=[]},addReason:function(callback){var reason,id=++this.lastId;return reason="undefined"!=typeof callback?this.proxy(function(context){var args=Array.prototype.slice.call(arguments,1);callback.apply(context,args),this.onReasonAppeared(id)},!0,!0):this.proxy(function(){this.onReasonAppeared(id)}),this.reasons[id]=!1,this.left++,reason},onReasonAppeared:function(id){this.reasons[id]||(this.reasons[id]=!0,this.left--,this.check())},onQueueComplete:function(){this.finished||(this.finished=!0,this.each(this.results,function(result){var callback=result[0],args=Array.prototype.slice.call(result,1);callback.apply(this,args)}))},appendResult:function(){this.results.push(arguments)},prependResult:function(){this.results.unshift(arguments)},check:function(){0===this.left&&this.onQueueComplete()},isComplete:function(){return this.finished}})}(),function($){Contextly.Transmitter=Contextly.createClass({broadcast:function(type){var args=Array.prototype.slice.call(arguments,1);$(window).triggerHandler(type,args)}})}(jQuery),window.twttr=function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};return d.getElementById(id)||null!=t.ready?t:(js=d.createElement(s),js.id=id,js.src="https://platform.twitter.com/widgets.js",fjs.parentNode.insertBefore(js,fjs),t._e=[],t.ready=function(f){t._e.push(f)},t)}(document,"script","twitter-wjs"),Contextly.Browser=Contextly.createClass({extend:Contextly.Proxy.prototype,statics:{construct:function(){this.features={svg:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}}},hasFeature:function(key){return"function"==typeof this.features[key]&&(this.features[key]=this.features[key]()),this.features[key]},hasSvg:function(){return this.hasFeature("svg")}}}),Contextly.MainServerAjaxClient=Contextly.createClass({statics:{getXhr:function(){if(!this.xhr){var remote_url=Contextly.Settings.getMainServerUrl()+"/easy_xdm/cors/index.html";this.xhr=new easyXDM.Rpc({remote:remote_url},{remote:{request:{}}})}return this.xhr},call:function(url,callback){this.getXhr().request({url:url.replace("http://","https://"),method:"POST"},function(response){callback&&callback(response)})}}}),Contextly.ExperienceRESTClient=Contextly.createClass({extend:[Contextly.RESTClient],statics:{getExperienceRPC:function(){if(!this.experience_rpc){var remote_url=Contextly.Settings.getExperienceServerUrl()+"/easy_xdm/cors/index.html";this.experience_rpc=new easyXDM.Rpc({remote:remote_url},{remote:{request:{}}})}return this.experience_rpc},getCommonParams:function(){var params=Contextly.RESTClient.getCommonParams();return params=jQuery.extend(params,{cookie_id:Contextly.Visitor.getId()})},call:function(api_name,api_method,params,callback){var api_url=Contextly.Settings.getExperienceServerUrl()+api_name+"/"+api_method+"/";params=jQuery.extend(params,this.getCommonParams());var self=this;this.getExperienceRPC().request({url:api_url,method:"POST",data:params},function(response){"undefined"!=typeof callback&&self.restCallback(response,callback)})}}}),function($){Contextly.EventsLogger=Contextly.createClass({statics:{logEvent:function(name,params){this.sendEvent(this.eventTypes.LOG,name,params)},emailEvent:function(name,message,params){params=params||{},params.event_page=window.location.href,null!=message&&(params.event_message=easyXDM.getJSONObject().stringify(message)),this.sendEvent(this.eventTypes.EMAIL,name,params)},tweetEvent:function(name,params){this.sendEvent(this.eventTypes.TWEET,name,params)},sendEvent:function(type,name,params){params=$.extend({event_type:type,event_name:name},params),Contextly.ExperienceRESTClient.call("events","put",params)}}}),Contextly.EventsLogger.eventTypes={EMAIL:"email",LOG:"log",TWEET:"tweet"}}(jQuery),function($){Contextly.overlay=Contextly.overlay||{},Contextly.overlay.Base=Contextly.createClass({extend:[Contextly.Proxy.prototype,Contextly.Transmitter.prototype],statics:{init:function(){if(!this.initialized){this.initialized=!0;var map={window:window,document:document,html:"html",body:"body"};for(var key in map)this[key]=$(map[key]);this.animating=0}},ns:function(eventType){return eventType+".contextlyOverlay"},open:function(element,options){this.init(),this.animating||(this.setOptions(options),this.lockBodyScroll(),this.renderOverlay(),this.renderDialog(element),this.refreshDialogSizes(),this.broadcast(Contextly.overlay.broadcastTypes.BEFORE_OPEN),this.animateOpening())},renderOverlay:function(){return this.overlay?void this.overlay.show():(this.overlay=$('<div class="ctx-overlay" />').appendTo("body"),!0)},renderDialog:Contextly.abstractMethod(),getAnimatedElements:function(markAsAnimating){var elements=this.overlay.add(this.dialog);return markAsAnimating&&(this.animating=elements.length),elements},animateOpening:function(){this.getAnimatedElements(!0).css({opacity:0}).animate({opacity:1},{duration:this.options.duration,complete:this.proxy(this.onOpeningComplete)})},onAnimationComplete:function(){return this.animating--,this.animating<0&&(this.animating=0),!this.animating},onOpeningComplete:function(){this.onAnimationComplete()&&(this.bindHandlers(),this.broadcast(Contextly.overlay.broadcastTypes.AFTER_OPEN))},bindHandlers:function(){this.window.bind(this.ns("resize"),this.proxy(this.onWindowResize)),this.options.closeOnEsc&&this.window.bind(this.ns("keyup"),this.proxy(this.onKeyUp,!1,!0)),this.options.closeOnOverlayClick&&this.overlay.bind(this.ns("click"),this.proxy(this.close))},close:function(){this.animating||$.isFunction(this.options.onClose)&&this.options.onClose()===!1||(this.broadcast(Contextly.overlay.broadcastTypes.BEFORE_CLOSE),this.unbindHandlers(),this.animateClosing())},unbindHandlers:function(){this.window.unbind(this.ns("resize")).unbind(this.ns("keypress")),this.overlay.unbind(this.ns("click"))},animateClosing:function(){this.getAnimatedElements(!0).animate({opacity:0},{duration:this.options.duration,complete:this.proxy(this.onClosingComplete)})},onClosingComplete:function(){this.onAnimationComplete()&&(this.destroyDialog(),this.destroyOverlay(),this.unlockBodyScroll(),this.broadcast(Contextly.overlay.broadcastTypes.AFTER_CLOSE))},destroyDialog:Contextly.abstractMethod(),destroyOverlay:function(){this.overlay.hide()},onKeyUp:function(e){27===e.which&&this.close()},onWindowResize:function(){this.refreshDialogSizes()},setOptions:function(options){if(options){for(var sizes=["width","height"],i=0;i<sizes.length;i++){var size=sizes[i],type=typeof options[size];"undefined"===type||"number"!==type&&"string"!==type||(options[size]={value:options[size],min:0,max:0})}this.options=options.extend?$.extend(!0,this.options,options):$.extend(!0,this.getDefaultOptions(),options)}else this.options=this.getDefaultOptions()},getDefaultOptions:function(){return{spacing:40,duration:200,width:{value:"auto",min:0,max:0},height:{value:"auto",min:0,max:0},closeOnEsc:!0,closeOnOverlayClick:!0,extend:!1,onClose:null,dataKey:"contextlyOverlay"}},broadcast:function(type){return Contextly.Transmitter.prototype.broadcast.call(this,type,this)},setDialogDimension:function(dimension,dialogSize){this.dialog.css(dimension,dialogSize)},setDialogPosition:function(coordinate,windowSize,dialogSize){var dialogPosition=Math.floor((windowSize-dialogSize)/2);this.dialog.css(coordinate,dialogPosition)},refreshDialogSize:function(dimension,coordinate,options){var dialogSize,windowSize=this.window[dimension]();switch(options.value){case"window":dialogSize=windowSize-2*this.options.spacing,dialogSize=this.applyDialogSizeLimits(dialogSize,options),this.setDialogDimension(dimension,dialogSize),this.setDialogPosition(coordinate,windowSize,dialogSize);break;case"auto":var map={width:"outerWidth",height:"outerHeight"},dimensionFunc=map[dimension];dialogSize=this.dialog[dimensionFunc](),this.setDialogPosition(coordinate,windowSize,dialogSize);break;default:"number"!=typeof options.value&&$.error("Unsupported overlay "+dimension+" value: "+options.value),dialogSize=options.value,this.setDialogDimension(dimension,dialogSize),this.setDialogPosition(coordinate,windowSize,dialogSize)}},refreshDialogSizes:function(){var dimensions={width:"left",height:"top"};for(var dimension in dimensions){var coordinate=dimensions[dimension],sideOptions=this.options[dimension];this.refreshDialogSize(dimension,coordinate,sideOptions)}},applyDialogSizeLimits:function(value,limits){return limits.min&&value<limits.min?value=limits.min:limits.max&&value>limits.max&&(value=limits.max),value},lockBodyScroll:function(){var data={scroll:{top:this.window.scrollTop(),left:this.window.scrollLeft()},style:this.body.attr("style")},css={position:"fixed",top:-data.scroll.top,left:-data.scroll.left,width:"100%"};this.document.height()>this.window.height()&&(css["overflow-y"]="scroll"),this.body.data(this.options.dataKey,data).css(css)},unlockBodyScroll:function(){var data=this.body.data(this.options.dataKey);data&&(this.body.attr("style",data.style||" "),this.window.scrollTop(data.scroll.top).scrollLeft(data.scroll.left))}}}),Contextly.overlay.broadcastTypes={BEFORE_OPEN:"contextlyOverlayBeforeOpen",AFTER_OPEN:"contextlyOverlayAfterOpen",BEFORE_CLOSE:"contextlyOverlayBeforeClose",AFTER_CLOSE:"contextlyOverlayAfterClose"}}(jQuery),function($){Contextly.overlay.Dynamic=Contextly.createClass({extend:Contextly.overlay.Base,statics:{getDialogHtml:Contextly.abstractMethod(),renderDialog:function(data){if(this.dialog)this.dialog.show();else{var html=this.getDialogHtml();this.dialog=$(html).appendTo("body")}this.renderContent(data)},destroyDialog:function(){this.destroyContent(),this.dialog.hide()},renderContent:Contextly.abstractMethod(),destroyContent:Contextly.abstractMethod()}})}(jQuery),Contextly.color=Contextly.color||{},Contextly.color.RGB=Contextly.createClass({construct:function(){if(1===arguments.length){var matches,input=arguments[0];(matches=input.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/))?(this.red=parseInt(matches[1],16),this.green=parseInt(matches[2],16),this.blue=parseInt(matches[3],16)):(matches=input.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/))?(this.red=parseInt(matches[1]+matches[1],16),this.green=parseInt(matches[2]+matches[2],16),this.blue=parseInt(matches[3]+matches[3],16)):Contextly.Utils.error("Unable to parse color "+input)}else 3===arguments.length?(this.red=arguments[0],this.green=arguments[1],this.blue=arguments[2]):Contextly.Utils.error("Wrong number of arguments passed to the RGB color constructor.")},toHSV:function(){var red=this.red/255,green=this.green/255,blue=this.blue/255,min=Math.min(red,green,blue),max=Math.max(red,green,blue),value=max,delta=max-min;if(0==delta)return new Contextly.color.HSV(0,0,100*value);var hue,saturation=0;return 0==max?(saturation=0,hue=-1,new Contextly.color.HSV(hue,saturation,value)):(saturation=delta/max,hue=red==max?(green-blue)/delta:green==max?2+(blue-red)/delta:4+(red-green)/delta,hue*=60,0>hue&&(hue+=360),new Contextly.color.HSV(hue,100*saturation,100*value))},toString:function(){for(var output="#",pad="00",colors=[this.red,this.green,this.blue],i=0;i<colors.length;i++){var color=Math.round(colors[i]);color=color.toString(16),color=pad.substr(0,pad.length-color.length)+color,output+=color}return output}}),Contextly.color.HSV=Contextly.createClass({construct:function(h,s,v){this.h=h,this.s=s,this.v=v},brightness:function(updates){var v=this.v,min=updates.min||0,max=updates.max||100;return"undefined"!=typeof updates.delta&&(v=Math.max(Math.min(v+updates.delta,max),min)),new Contextly.color.HSV(this.h,this.s,v)},toRGB:function(){var R,G,B,h=this.h/360,s=this.s/100,v=this.v/100;if(0==s)R=255*v,G=255*v,B=255*v;else{var var_h=6*h;6==var_h&&(var_h=0);var var_r,var_g,var_b,var_i=Math.floor(var_h),var_1=v*(1-s),var_2=v*(1-s*(var_h-var_i)),var_3=v*(1-s*(1-(var_h-var_i)));0==var_i?(var_r=v,var_g=var_3,var_b=var_1):1==var_i?(var_r=var_2,var_g=v,var_b=var_1):2==var_i?(var_r=var_1,var_g=v,var_b=var_3):3==var_i?(var_r=var_1,var_g=var_2,var_b=v):4==var_i?(var_r=var_3,var_g=var_1,var_b=v):(var_r=v,var_g=var_1,var_b=var_2),R=255*var_r,G=255*var_g,B=255*var_b}return new Contextly.color.RGB(R,G,B)}}),function($){Contextly.CssManager=Contextly.createClass({statics:{loadFile:function(url,key,callback){var link=document.createElement("link");if(link.type="text/css",link.rel="stylesheet","function"==typeof callback){var done=!1,onSuccess=function(){done||(link.onload=null,link.onreadystatechange=null,null!==timer&&(clearTimeout(timer),timer=null),callback.call(link,key))};link.onload=onSuccess,link.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||onSuccess()};var timer=null,obj=document.createElement("object");
obj.width=1,obj.height=1,obj.type="text/css",obj.onload=function(){obj.onload=null,obj.parentNode.removeChild(obj),timer=setTimeout(onSuccess,10)},obj.data=url,$(obj).css({position:"absolute",top:0,right:0}).appendTo("body")}link.href=url,$(link).attr({"data-ctx-key":key}).appendTo("head")},getFileElement:function(key){return $('head link[data-ctx-key="'+Contextly.Utils.escapeSizzleAttrValue(key)+'"]')},removeFile:function(key){this.getFileElement(key).remove()},loadCode:function(code,key){code=code.replace("</style>","\\3C/style>");var html='<style type="text/css" data-ctx-key="'+Contextly.Utils.escape(key)+'">'+code+"</style>";$(html).appendTo("head")},getCodeElement:function(key){return $('head style[data-ctx-key="'+Contextly.Utils.escapeSizzleAttrValue(key)+'"]')},removeCode:function(key){this.getCodeElement(key).remove()}}}),Contextly.CssManager.broadcastTypes={FILE_LOADING:"contextlyCssFileLoading",FILE_LOADED:"contextlyCssFileLoaded",FILE_REMOVED:"contextlyCssFileRemoved",CODE_LOADED:"contextlyCssCodeLoaded",CODE_REMOVED:"contextlyCssCodeRemoved"}}(jQuery),function($){Contextly.JsManager=Contextly.createClass({statics:{loadFile:function(url,key,callback){var head=$("head:first")[0]||document.documentElement,script=document.createElement("script");if("function"==typeof callback){var done=!1,onSuccess=function(){done||(done=!0,script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),callback.call(script,key))};script.onload=onSuccess,script.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||onSuccess()}}$(script).attr({"data-ctx-key":key}),script.src=url,head.insertBefore(script,head.firstChild)},removeFile:function(){}}}),Contextly.CssManager.broadcastTypes={FILE_LOADING:"contextlyJsFileLoading",FILE_LOADED:"contextlyJsFileLoaded"}}(jQuery),function($){Contextly.FontManager=Contextly.createClass({extend:[Contextly.Proxy.prototype,Contextly.Transmitter.prototype],statics:{construct:function(){this.left=0,this.fonts={},this.callbacks=[],this.fallbackWidths={}},getContainerStyle:function(font){var style="position: absolute !important; white-space: nowrap !important; font-size: 128px !important; width: auto !important; top: -9999px !important; left: 0 !important;";return style+=font?" font-family: "+font+" !important":" display: none !important"},getContainer:function(){return"undefined"==typeof this.container&&(this.container=$("<div/>").attr("style",this.getContainerStyle()).text(new Array(40).join("wmkgil")).appendTo("body")),this.container},getFontWidth:function(font,fallback){fallback&&(font+=","+fallback);var container=this.getContainer().attr("style",this.getContainerStyle(font)),width=container.width();return container.attr("style",this.getContainerStyle()),width},getFallbackFonts:function(){return["serif","sans-serif","monospace"]},fontExists:function(font){for(var fallbacks=this.getFallbackFonts(),i=0;i<fallbacks.length;i++){var fallback=fallbacks[i];if("undefined"==typeof this.fallbackWidths[fallback]&&(this.fallbackWidths[fallback]=this.getFontWidth(fallback)),this.getFontWidth(font,fallback)!==this.fallbackWidths[fallback])return!0}return!1},onFontFailed:function(font){this.left--,this.fonts[font]=this.fontStates.FAILED,this.broadcast(this.broadcastTypes.FONT_FAILED,font),this.onLoadingComplete()},onFontLoaded:function(font){this.left--,this.fonts[font]=this.fontStates.LOADED,this.broadcast(this.broadcastTypes.FONT_LOADED,font),this.onLoadingComplete()},onLoadingComplete:function(){this.left>0||(this.each(this.callbacks,function(item){var fonts=item.fonts,callback=item.callback,states={};this.each(fonts,function(font){states[font]=this.fonts[font]});try{callback(states)}catch(e){Contextly.Utils.logError("FontLoader callback failed.",item,e)}}),this.broadcast(this.broadcastTypes.LOADED))},startLoading:function(s){0==this.left&&this.broadcast(this.broadcastTypes.LOADING),this.left+=s.fonts.length;for(var i=0;i<s.fonts.length;i++){var font=s.fonts[i];this.fonts[font]=this.fontStates.LOADING,this.broadcast(this.broadcastTypes.FONT_LOADING,font)}var config={classes:!1,fontactive:this.proxy(this.onFontLoaded,!1,!0),fontinactive:this.proxy(this.onFontFailed,!1,!0)};config[s.provider]=$.extend({},s.options,{families:s.fonts}),WebFont.load(config)},load:function(specs){var s=$.extend({provider:"google",fonts:[],callback:null,options:{}},specs);"function"==typeof s.callback&&this.callbacks.push({fonts:s.fonts,callback:s.callback});for(var load=[],i=0;i<s.fonts.length;i++){var font=s.fonts[i];"undefined"==typeof this.fonts[font]&&(this.fontExists(font)?this.fonts[font]=this.fontStates.EXISTS:load.push(font))}load.length?(s.fonts=load,this.startLoading(s)):this.onLoadingComplete()}}}),Contextly.FontManager.fontStates={LOADING:"loading",LOADED:"loaded",EXISTS:"exists",FAILED:"failed"},Contextly.FontManager.broadcastTypes={LOADING:"contextlyFontsLoading",LOADED:"contextlyFontsLoaded",FONT_LOADING:"contextlyFontLoading",FONT_LOADED:"contextlyFontLoaded",FONT_FAILED:"contextlyFontFailed"}}(jQuery),function(){Contextly.assets=Contextly.assets||{},Contextly.AssetManager=Contextly.createClass({extend:[Contextly.Proxy.prototype,Contextly.Transmitter.prototype],statics:{construct:function(){this.packages={}},getConfig:function(name){return Contextly.assets[name]||Contextly.Utils.error("Package assets not found: "+name),Contextly.assets[name]},remove:function(name){var config=this.getConfig(name);config.include&&this.each(config.include,function(dependency){this.remove(dependency)});var base=config.base?config.base+"/":"";this.each(config.css||{},function(path){Contextly.CssManager.removeFile(base+path)}),this.each(config.js||{},function(path){Contextly.JsManager.removeFile(base+path)}),delete this.packages[name],this.broadcast(Contextly.AssetManager.broadcastTypes.REMOVED,name)},render:function(name,queue){if("undefined"==typeof this.packages[name]){var config=this.getConfig(name);queue=queue||new Contextly.CallbackQueue,this.packages[name]=Contextly.AssetManager.packageStates.LOADING,this.broadcast(Contextly.AssetManager.broadcastTypes.LOADING,name,config,queue),queue.prependResult(this.proxy(this.onRenderingComplete,!1,!0),name),config.include&&this.each(config.include,function(dependency){this.render(dependency,queue)});var base=config.base?config.base+"/":"";this.each(config.css||{},function(path){var url=Contextly.Settings.getAssetUrl(base+path,"css");Contextly.CssManager.loadFile(url,base+path,queue.addReason())}),this.each(config.js||{},function(path){var url=Contextly.Settings.getAssetUrl(base+path,"js");Contextly.JsManager.loadFile(url,base+path,queue.addReason())})}},onRenderingComplete:function(name){this.packages[name]=Contextly.AssetManager.packageStates.LOADED,this.broadcast(Contextly.AssetManager.broadcastTypes.LOADED,name)}}}),Contextly.AssetManager.packageStates={LOADING:"loading",LOADED:"loaded"},Contextly.AssetManager.broadcastTypes={LOADING:"contextlyAssetsLoading",LOADED:"contextlyAssetsLoaded",REMOVED:"contextlyAssetsRemoved"}}(),function($){Contextly.widget=Contextly.widget||{},Contextly.widget.types={SNIPPET:"snippet",SIDEBAR:"sidebar",AUTO_SIDEBAR:"auto-sidebar",STORYLINE_SUBSCRIBE:"storyline-subscribe",SIDERAIL:"side-rail",SOCIAL:"social"},Contextly.widget.styles={TEXT:"default",TABS:"tabs",BLOCKS:"blocks",BLOCKS2:"blocks2",FLOAT:"float"},Contextly.widget.sideRailStyles={DEFAULT:"default",H_SQUARE:"h-square",H_LETTER:"h-letter"},Contextly.widget.linkTypes={PREVIOUS:"previous",RECENT:"recent",WEB:"web",INTERESTING:"interesting",CUSTOM:"custom",PROMO:"sticky"},Contextly.widget.recommendationTypes={VIDEO:10,PRODUCT:9,COOKIE:8,EVERGREEN:7,OPTIMIZATION:6},Contextly.widget.broadcastTypes={DISPLAYED:"contextlyWidgetDisplayed",IN_VIEWPORT:"contextlyWidgetInViewport",LAYOUT_CHANGED:"contextlyWidgetLayoutChanged"},Contextly.widget.eventNames={MODULE_VIEW:"module_view",CAROUSEL_NAVIGATION:"carousel_navigation"},Contextly.widget.index=0,Contextly.widget.Base=Contextly.createClass({extend:[Contextly.Proxy,Contextly.Transmitter],abstracts:["getWidgetHTML"],construct:function(widget,containers){this.widget=widget,this.containers=containers,this.widget_elements=null,this.widget_index=++Contextly.widget.index},getWidget:function(){return this.widget},getWidgetType:function(){return this.widget_type},getSettings:function(){return this.getWidget().settings},getWidgetIndex:function(){return this.widget_index},markWithWidgetIndex:function(elements){$(elements).data("ctxWidgetIndex",this.getWidgetIndex())},widgetIndexMatches:function(element){return $(element).data("ctxWidgetIndex")===this.getWidgetIndex()},getWidgetStyleClass:function(){return"default-widget"},getWidgetElements:function(){return null===this.widget_elements&&(this.widget_elements=this.getWidgetContainers().find("."+this.getWidgetStyleClass())),this.widget_elements},getWidgetContainers:function(){return this.containers.getElements()},getEventsNamespace:function(){return"ctxWidget"},nsEvent:function(type){var ns="."+this.getEventsNamespace();return type=type?type.split(/\s+/).join(ns+" "):"",type+=ns},displayHTML:function(html){this.getWidgetContainers().html(html)},appendHTML:function(html){this.getWidgetContainers().append(html)},loadAssets:function(queue){var name=this.getAssetsPackageName();null!=name&&Contextly.AssetManager.render(name,queue),this.loadCssCode(queue),this.loadFonts(queue)},removeAssets:function(){var name=this.getAssetsPackageName();null!=name&&Contextly.AssetManager.remove(name),this.removeCssCode()},display:function(){var widget_html=this.getWidgetHTML();this.displayHTML(widget_html),this.attachHandlers(),this.broadcastWidgetDisplayed()},attachHandlers:function(){var handlers=this.getHandlers.apply(this,arguments);for(var name in handlers)this[name].call(this)},getHandlers:function(){return{}},broadcast:function(type){var args=[type,this.widget_type,this];arguments.length>1&&Array.prototype.push.apply(args,Array.prototype.slice.call(arguments,1)),Contextly.Transmitter.fn.broadcast.apply(this,args)},broadcastWidgetDisplayed:function(){this.broadcast(Contextly.widget.broadcastTypes.DISPLAYED)},getCssCodeKey:function(){return"widgets/settings:"+this.getWidgetType()},loadCssCode:function(){var key=this.getCssCodeKey();if(!Contextly.CssManager.getCodeElement(key).length){var code=this.getCustomCssCode();code&&Contextly.CssManager.loadCode(code,key)}},removeCssCode:function(){var key=this.getCssCodeKey();Contextly.CssManager.removeCode(key)},loadFonts:function(queue){var fonts=this.getSettings().external_fonts;fonts&&Contextly.FontManager.load({fonts:fonts,callback:queue.addReason()})},getAssetsPackageName:function(){},getCustomCssCode:function(){},escape:function(text){return Contextly.Utils.escape(text)},logEvent:function(name,params){params=this.alterLoggedEventParams(params),Contextly.EventsLogger.logEvent(name,params)},alterLoggedEventParams:function(params){return params.event_widget_type=this.getWidgetType(),params}})}(jQuery),Contextly.widget.CssCustomBuilder=Contextly.createClass({statics:{buildCSSRule:function(entry,selectors,property,value){if(!value)return"";Contextly.Utils.isArray(selectors)||(selectors=[selectors]);for(var result="",i=0;i<selectors.length;i++)i&&(result+=", "),result+=entry+" "+selectors[i];return result+=" {"+property+": "+value+"}"}}}),function($){Contextly.widget.ResponsiveLayout=Contextly.createClass({getLayoutModes:function(){return{}},setUpResponsiveLayout:function(){if(!Contextly.Utils.isEmptyObject(this.getLayoutModes())){this.checkLayoutThresholds();var checkCount=0,interval=setInterval(this.proxy(function(){checkCount++,checkCount>5&&clearInterval(interval),this.checkLayoutThresholds()}),500);$(window).resize(this.proxy(this.checkLayoutThresholds)).load(this.proxy(function(){clearInterval(interval),this.checkLayoutThresholds()}))}},sizeMatchesThresholds:function(size,thresholds){return size>=thresholds[0]&&(!thresholds[1]||size<thresholds[1])},checkLayoutThresholds:function(){var modes=this.getLayoutModes(),elements=this.getWidgetElements();this.eachElement(elements,function(element){var width=element.width();this.each(modes,function(thresholds,name){return this.sizeMatchesThresholds(width,thresholds)?(this.setLayoutMode(element,name),!1):void 0})})},buildLayoutClass:function(mode){return"ctx-"+mode},setLayoutMode:function(element,mode){var key="ctxLayoutMode",lastMode=element.data(key);if(mode!==lastMode){var firstTime=null==lastMode;firstTime||element.removeClass(this.buildLayoutClass(lastMode)),element.data(key,mode),element.addClass(this.buildLayoutClass(mode)),firstTime||this.broadcast(Contextly.widget.broadcastTypes.LAYOUT_CHANGED,mode)}}})}(jQuery),function($){Contextly.widget.TweetsRenderer=Contextly.createClass({queueTweetsRendering:function(){twttr.ready(this.proxy(this.onTwitterReady))},getTweetContainers:Contextly.abstractMethod(),getTweetContainer:Contextly.abstractMethod(),onTwitterReady:function(){this.bindTwitterEvents(),this.renderTweets(this.getWidgetElements())},renderTweets:function(widgetElements){var tweetContainers=this.getTweetContainers(widgetElements);tweetContainers.length&&(this.markWithWidgetIndex(tweetContainers),this.eachElement(tweetContainers,this.renderTweet))},renderTweet:function(element){var id=element.attr("data-tweet-id");twttr.widgets.createTweet(id,element[0],{cards:"hidden",conversation:"none"})},bindTwitterEvents:function(){var types=["click","tweet","follow","retweet","favorite"];this.each(types,function(eventName){this.bindTwitterEvent(eventName,this.onTweetInteraction)}),this.bindTwitterEvent("rendered",this.onTweetRendered)},bindTwitterEvent:function(type,callback){twttr.events.bind(type,this.proxy(function(e){var link=this.getTweetContainer(e.target).filter(this.proxy(this.widgetIndexMatches,!0));link.length&&callback.call(this,e,link)},!1,!0))},onTweetRendered:function(e){$(e.target).contents().find("blockquote").bind("click",this.proxy(this.onTweetClick,!0,!0)),this.getTweetContainer(e.target).triggerHandler("contextlyTweetRendered")},getTweetFrameElement:function(element){var doc=element.ownerDocument;if(!doc)return null;var win=doc.defaultView||doc.parentWindow;return win?win.frameElement:null},onTweetClick:function(blockquote,e){var frameElement=this.getTweetFrameElement(blockquote);if(frameElement){var link=this.getTweetContainer(frameElement);if(link.length){var targetSelector='a[data-scribe^="element:"]',target=$(e.target);if(target.is(targetSelector)||(target=target.parents(targetSelector+":first"),target.length)){var tweetId=$(blockquote).attr("data-tweet-id");if(tweetId){var scribeType=target.attr("data-scribe").replace(/^element:/,"");if(-1===$.inArray(scribeType,["reply","retweet","favorite"])){var href=target.attr("href");if("url"===scribeType){var expandedUrl=target.attr("data-expanded-url");if(expandedUrl){href=expandedUrl;var nativeUrl=link.attr("data-native-url");if(expandedUrl.toLowerCase()===nativeUrl.toLowerCase()&&!this.onTweetTargetUrlClick(blockquote,e,link))return}}this.logTweetEvent("link",this.alterLoggedEventParams({event_element:scribeType,event_tweet_id:tweetId,event_url:href}))}}}}}},onTweetTargetUrlClick:function(){return!0},onTweetInteraction:function(e,link){var tweetId=link.attr("data-tweet-id");tweetId&&this.logTweetEvent(e.type,this.alterLoggedEventParams({event_element:e.region,event_tweet_id:tweetId}))},logTweetEvent:function(name,params){params=this.alterLoggedEventParams(params),Contextly.EventsLogger.tweetEvent(name,params)}})}(jQuery),function($){Contextly.widget.ViewWatcher=Contextly.createClass({extend:[Contextly.Proxy.prototype],statics:{construct:function(){this.widgets={},this.pollTimer=null,this.$window=$(window)},start:function(){this.isActive()||(this.pollTimer=setInterval(this.proxy(this.checkWidgetsVisibility),300))},stop:function(){this.isActive()&&(clearInterval(this.pollTimer),this.pollTimer=null)},isActive:function(){return!!this.pollTimer},watch:function(widget){Contextly.Utils.isEmptyObject(this.widgets)&&this.start();var index=widget.getWidgetIndex();this.widgets[index]=widget},unwatch:function(widget){var index=widget.getWidgetIndex();delete this.widgets[index],Contextly.Utils.isEmptyObject(this.widgets)&&this.stop()},isWatched:function(widget){var index=widget.getWidgetIndex();return"undefined"!=typeof this.widgets[index]},getViewport:function(){var viewport={top:this.$window.scrollTop(),left:this.$window.scrollLeft()};return viewport.right=viewport.left+this.$window.width(),viewport.bottom=viewport.top+this.$window.height(),viewport},isElementInsideViewport:function(el,viewport){var bounds=el.offset();bounds.right=bounds.left+el.outerWidth(),bounds.bottom=bounds.top+el.outerHeight();var isOutsideViewport=viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom;return!isOutsideViewport},checkWidgetsVisibility:function(){this.each(this.widgets,function(widget){var viewport=this.getViewport(),elements=widget.getWidgetElements();this.eachElement(elements,function(element,index){var targetElement=widget.getViewWatcherElement(index,element);return this.isElementInsideViewport(targetElement,viewport)?(widget.onWidgetInViewport(),!1):void 0})})}}}),Contextly.widget.ViewHandler=Contextly.createClass({findViewWatcherElement:Contextly.abstractMethod(),getViewWatcherElement:function(index,widgetElement){return this.widget_view_element=this.widget_view_element||[],null==this.widget_view_element[index]&&(this.widget_view_element[index]=this.findViewWatcherElement(widgetElement)),this.widget_view_element[index]},attachWidgetViewHandler:function(){return this.widget_view_happened||Contextly.widget.ViewWatcher.isWatched(this)?void Contextly.Utils.logError("Widget view handler attempted to bind after the widget view event has been recorded or polling is in progress."):void Contextly.widget.ViewWatcher.watch(this)},onWidgetInViewport:function(){if(Contextly.widget.ViewWatcher.unwatch(this),!this.widget_view_happened){this.widget_view_happened=!0;var guid=Contextly.Visitor.getGuid();null!=guid&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:guid,event_success:!0}),this.broadcast(Contextly.widget.broadcastTypes.IN_VIEWPORT)}}})}(jQuery),function($){Contextly.widget.BaseLinksList=Contextly.createClass({extend:[Contextly.widget.Base,Contextly.widget.ResponsiveLayout],construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_view_happened=!1},getScreenWidth:function(){return $(window).width()},hasWidgetData:function(){return!1},getLinksLimit:function(){return 0},isDisplaySection:function(section){var display_section=-1!=$.inArray(section,this.widget.settings.display_sections),have_to_display=this.widget.links&&this.widget.links[section]&&this.widget.links[section].length>0;return display_section&&have_to_display},display:function(){var widgetHasData=this.hasWidgetData();if(widgetHasData){var widget_html=this.getWidgetHTML();this.displayHTML(widget_html)}else this.getWidgetContainers().empty();this.attachHandlers(widgetHasData),this.broadcastWidgetDisplayed()},getHandlers:function(widgetHasData){var handlers=Contextly.widget.Base.prototype.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.setUpResponsiveLayout=!0),handlers},onVideoLinkClick:function(target,e){e.preventDefault();var link=$(target),data={videoUrl:link.attr("href"),videoTitle:link.attr("title")};Contextly.overlay.Video.open(data);var contextly_url=link.attr("contextly-url");Contextly.MainServerAjaxClient.call(contextly_url)},attachLinksPopups:function(){this.getWidgetElements().find("a[rel='ctx-video-dataurl']").click(this.proxy(this.onVideoLinkClick,!0,!0))},getImageDimension:function(){return this.getImageDimensionFor(this.getSettings().images_type)},getImageDimensionFor:function(image_type){image_type=image_type.replace("square","").replace("letter","");var dimensions=image_type.split("x"),w=0,h=0;return 2==dimensions.length&&(w=parseInt(dimensions[0]),h=parseInt(dimensions[1])),{width:w,height:h}},getImagesHeight:function(){var image_dimension=this.getImageDimension();return image_dimension.height},getImagesWidth:function(){var image_dimension=this.getImageDimension();return image_dimension.width},getWidgetLinks:function(){return this.getWidget()&&this.getWidget().links?this.getWidget().links:null},getModuleType:function(){return this.getSettings().display_type},getWidgetSectionLinks:function(section){var widget_links=this.getWidgetLinks();return widget_links&&widget_links[section]?widget_links[section]:null},getLinkThumbnailUrl:function(link){return link.thumbnail_url?link.thumbnail_url:null},getLinkIcon:function(link){return link.video?'<span class="ctx-icon ctx-icon-video"></span>':link.tweet?'<span class="ctx-icon ctx-icon-twitter"></span>':""},escape:function(text){return Contextly.Utils.escape(text)},getEventTrackingHtml:function(link){var settings=this.getSettings(),html=' onmousedown="';return link.video||(html+="this.href='"+this.escape(link.url)+"';"),settings&&settings.utm_enable&&(html+=this.getTrackLinkJSHtml(link)),html+='"'},getLinkATag:function(link,content){return'<a href="'+this.escape(link.native_url)+'" title="'+this.escape(link.title)+"\" class='ctx-clearfix ctx-nodefs' "+this.getEventTrackingHtml(link)+">"+content+"</a>"},getVideoLinkATag:function(link,content){return'<a rel="ctx-video-dataurl" class=\'ctx-clearfix ctx-nodefs\' href="'+this.escape(link.native_url)+'" title="'+this.escape(link.title)+'" contextly-url="'+link.url+'" '+this.getEventTrackingHtml(link)+">"+content+"</a>"},getTweetLinkATag:function(link,content){return'<a rel="ctx-tweet-dataurl" class=\'ctx-clearfix ctx-nodefs\' href="'+this.escape(link.native_url)+'" title="'+this.escape(link.title)+'" contextly-url="'+link.url+'" '+this.getEventTrackingHtml(link)+">"+content+"</a>"},getTrackLinkJSHtml:function(link){var widget_type=this.escape(this.getWidgetType()),link_type=this.escape(link.type),link_url=this.escape(link.url),link_title=this.escape(link.title);return this.escape("Contextly.PageEvents.trackLink('"+widget_type+"','"+link_type+"','"+link_url+"','"+link_title+"');")},getLinkHTML:function(link,index){return link.video?this.getLinkHTMLVideo(link,index):link.tweet?this.getLinkHTMLTweet(link,index):this.getLinkHTMLNormal(link,index)},getInnerLinkHTML:function(link){return link.title},getLinkHTMLVideo:function(link,index){return"<div class='ctx-link ctx-"+index+"'>"+this.getVideoLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLTweet:function(link,index){return"<div class='ctx-link ctx-"+index+"'>"+this.getTweetLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLNormal:function(link,index){return"<div class='ctx-link ctx-"+index+"'><div class='ctx-link-title'>"+this.getLinkATag(link,this.getInnerLinkHTML(link))+"</div></div>"},isDisplayContextlyLogo:function(){return Contextly.Settings.isBrandingDisplayed()},getBrandingButtonHtml:function(){if(!this.isDisplayContextlyLogo())return"";var div="<div class='ctx-branding ctx-clearfix'>";return div+="<a href='https://contextly.com' class='ctx-branding-link ctx-nodefs'>Powered by</a>",div+="</div>"},attachBrandingHandlers:function(){this.isDisplayContextlyLogo()&&this.getWidgetContainers().find(".ctx-branding-link").click(function(event){event.preventDefault(),Contextly.overlay.Branding.open()})}})}(jQuery),function(){Contextly.widget.BaseFlatLinksList=Contextly.createClass({extend:Contextly.widget.BaseLinksList,getLinksHTML:function(){var html="";if(this.hasWidgetData())for(var limit=this.getLinksLimit(),links=this.widget.links,i=0;i<links.length&&!(limit&&i>=limit);i++){var link=links[i];link&&link.id&&link.title&&(html+=this.getLinkHTML(link,i+1))}return html},hasWidgetData:function(){return this.widget.links&&this.widget.links.length}})}(jQuery),function(){Contextly.widget.TextSnippet=Contextly.createClass({extend:[Contextly.widget.BaseLinksList,Contextly.widget.ViewHandler],construct:function(){Contextly.widget.BaseLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SNIPPET},getAssetsPackageName:function(){return"widgets/snippet/"+this.getSettings().display_type},getWidgetStyleClass:function(){return"ctx-content-text"},getWidgetClasses:function(){var classes=["ctx-module","ctx-nodefs",this.getWidgetStyleClass()];return Contextly.Browser.hasSvg()||classes.push("ctx-no-svg"),classes},getWidgetHTML:function(){var div="",sections=this.widget.settings.display_sections;div+="<div class='"+this.escape(this.getWidgetClasses().join(" "))+"'>",div+="<div class='ctx-sections-container ctx-clearfix'>";for(var i=0;i<sections.length;i++){var section_name=sections[i];if(this.isDisplaySection(section_name)){var section_key=section_name+"_subhead",section_header=this.widget.settings[section_key],section_classes=["ctx-section","ctx-section-"+this.escape(section_name)];i%2===0&&i+1===sections.length&&section_classes.push("ctx-wide"),div+="<div class='"+section_classes.join(" ")+"'>",section_header&&(div+="<div class='ctx-links-header'><p class='ctx-nodefs'>"+this.escape(section_header)+"</p></div>"),div+="<div class='ctx-links-content'>"+this.getLinksHTMLOfType(section_name)+"</div>",div+="</div>"}}return div+="</div>",div+="</div>",div+=this.getBrandingButtonHtml()},hasWidgetData:function(){if(this.widget.links){var links=this.widget.links;for(var prop in links)if(links.hasOwnProperty(prop)&&links[prop].length)return!0}return!1},getLinksHTMLOfType:function(type){var html="",widget=this.widget;if(widget.links&&widget.links[type]){var placeCounter=0;for(var link_idx in widget.links[type]){var link=widget.links[type][link_idx];link.id&&link.title&&(html+=this.getLinkHTML(link,++placeCounter))}}return html},getInnerLinkHTML:function(link){var icon=this.getLinkIcon(link);return""===icon&&(icon='<span class="ctx-icon ctx-bullet"></span>'),icon+link.title},getHandlers:function(widgetHasData){var handlers=Contextly.widget.BaseLinksList.fn.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.attachLinksPopups=!0,handlers.attachBrandingHandlers=!0,Contextly.Settings.isAdmin()||(handlers.attachWidgetViewHandler=!0)),handlers},getCustomCssCode:function(){return Contextly.widget.TextCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},buildLayoutClass:function(mode){return"ctx-module-"+mode},getLayoutModes:function(){return{mobile:[0,450],"default":[450]}},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-section .ctx-link:first")},broadcastWidgetDisplayed:function(){Contextly.widget.BaseLinksList.fn.broadcastWidgetDisplayed.apply(this,arguments);var guid=Contextly.Visitor.getGuid();null!=guid&&this.logEvent(Contextly.widget.eventNames.MODULE_VIEW,{event_guid:guid,event_success:!1})}})}(jQuery),Contextly.widget.TextCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-text .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector=[".ctx-content-text .ctx-link",".ctx-content-text .ctx-link a"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),selector=[".ctx-content-text .ctx-sections-container",".ctx-content-text .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),result}}}),function($){Contextly.widget.BaseBlocksSnippet=Contextly.createClass({extend:[Contextly.widget.TextSnippet,Contextly.widget.TweetsRenderer],getLinksLimit:function(){return 6},getLinksHTMLOfType:function(type){var html="",widget=this.widget;if(widget.links&&widget.links[type]){var placeCounter=0,links_limit=this.getLinksLimit();for(var link_idx in widget.links[type]){var link=widget.links[type][link_idx];if(placeCounter++,placeCounter>links_limit)break;link.id&&link.title&&(html+=this.getLinkHTML(link,placeCounter))}}return html},getWidgetHTML:function(){var div="";div+="<div class='"+this.escape(this.getWidgetClasses().join(" "))+"'>";var sections=this.widget.settings.display_sections;div+="<div class='ctx-sections-container ctx-nomar'>";for(var i=0;i<sections.length;i++){var section_name=sections[i];if(this.isDisplaySection(section_name)){var section_key=section_name+"_subhead",section_header=this.widget.settings[section_key],section_classes=["ctx-section","ctx-clearfix","ctx-section-"+section_name];div+="<div class='"+this.escape(section_classes.join(" "))+"'>",section_header&&(div+="<div class='ctx-links-header'><p class='ctx-nodefs'>"+this.escape(section_header)+"</p></div>"),div+="<div class='ctx-links-content ctx-nodefs ctx-clearfix'>",div+=this.getLinksHTMLOfType(section_name),div+="</div></div>"}}return div+="</div>",div+=this.getBrandingButtonHtml(),div+="</div>"},getLinkHTMLVideo:function(link,linkCounter){return"<div class='ctx-link ctx-"+linkCounter+"'>"+this.getVideoLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLTweet:function(link,linkCounter){return"<div class='ctx-link ctx-"+linkCounter+"' data-tweet-id='"+this.escape(link.tweet)+"'>"+this.getTweetLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getLinkHTMLNormal:function(link,linkCounter){return"<div class='ctx-link ctx-"+linkCounter+"'>"+this.getLinkATag(link,this.getInnerLinkHTML(link))+"</div>"},getHandlers:function(widgetHasData){var handlers=Contextly.widget.TextSnippet.prototype.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.queueTweetsRendering=!0),handlers},getTweetContainers:function(widgetContainers){return widgetContainers.find(".ctx-link[data-tweet-id]")},getTweetContainer:function(frameElement){return $(frameElement).parents(".ctx-link.ctx-tweet:first")},onTweetTargetUrlClick:function(blockquote,e,tweetContainer){var contextlyUrl=tweetContainer.attr("data-contextly-url");return Contextly.MainServerAjaxClient.call(contextlyUrl),!1},renderTweet:function(element){var a=element.find('a[rel="ctx-tweet-dataurl"]:first'),nativeUrl=a.attr("href"),contextlyUrl=a.attr("contextly-url");element.attr("data-native-url",nativeUrl).attr("data-contextly-url",contextlyUrl).empty().addClass("ctx-tweet"),element.parents(".ctx-section:first").not(".ctx-social-section").addClass("ctx-social-section"),Contextly.widget.TweetsRenderer.fn.renderTweet.apply(this,arguments)}})}(jQuery),function($){Contextly.widget.BlocksSnippet=Contextly.createClass({extend:Contextly.widget.BaseBlocksSnippet,getHandlers:function(widgetHasData){var handlers=Contextly.widget.BaseBlocksSnippet.fn.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.attachLinksHover=!0),handlers},attachLinksHover:function(){this.getWidgetElements().find(".ctx-link").bind("mouseenter",this.proxy(this.onLinkMouseEnter,!0,!0)).bind("mouseleave",this.proxy(this.onLinkMouseLeave,!0,!0))},onLinkMouseEnter:function(element){var link=$(element),p=link.find(".ctx-link-title p").stop(!0,!0),startHeight=p.height();link.addClass("ctx-expanded");var endHeight=p.height();return startHeight>=endHeight?void link.removeClass("ctx-expanded"):void p.css("height",startHeight).animate({height:endHeight},{duration:200,complete:function(){p.css("height","auto")}})},onLinkMouseLeave:function(element){var link=$(element),p=link.find(".ctx-link-title p").stop(!0,!0);if(link.is(".ctx-expanded")){var startHeight=p.height();link.removeClass("ctx-expanded");var endHeight=p.height();link.addClass("ctx-expanded"),p.css("height",startHeight).animate({height:endHeight},{duration:200,complete:function(){p.css("height",""),link.removeClass("ctx-expanded")
}})}},getInnerLinkHTML:function(link){var inner_html="<div class='ctx-link-title'><p class='ctx-nodefs'>"+this.getLinkIcon(link)+" "+link.title+"</div>";return this.getLinkThumbnailUrl(link)&&(inner_html+="<div class='ctx-link-image'><img src='"+link.thumbnail_url+"' class='ctx-nodefs' /></div>"),inner_html},getWidgetStyleClass:function(){return"ctx-content-block"},getCustomCssCode:function(){return Contextly.widget.BlocksCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},getLayoutModes:function(){return{mobile:[0,200],tablet:[200,450],"default":[450,650],sec5:[650,790],sec6:[790]}}})}(jQuery),Contextly.widget.BlocksCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-block .ctx-links-header p";if(css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector=".ctx-content-block .ctx-link-title",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),selector=[".ctx-content-block .ctx-sections-container",".ctx-content-block .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),selector=".ctx-content-block",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),selector=".ctx-content-block .ctx-link-title",css.overlay_color){result+=this.buildCSSRule(entry,selector,"background",css.overlay_color);try{var color=new Contextly.color.RGB(css.overlay_color),rgba="rgba("+color.red+","+color.green+","+color.blue+",0.85)";result+=this.buildCSSRule(entry,selector,"background",rgba)}catch(e){Contextly.Utils.logError("Unable to parse the overlay color "+css.overlay_color)}}return result}}}),function(){Contextly.widget.Blocks2Snippet=Contextly.createClass({extend:Contextly.widget.BaseBlocksSnippet,getWidgetStyleClass:function(){return"ctx-content-block2"},getInnerLinkHTML:function(link){var inner_html="";return this.getLinkThumbnailUrl(link)&&(inner_html+="<div class='ctx-link-image'><img src='"+link.thumbnail_url+"' class='ctx-nodefs' /></div>"),inner_html+="<div class='ctx-link-title'><p class='ctx-nodefs'>"+this.getLinkIcon(link)+" "+link.title+"</p></div>"},getCustomCssCode:function(){return Contextly.widget.Blocks2CssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},getLayoutModes:function(){return{mobile:[0,400],"default":[400,650],sec5:[650,790],sec6:[790]}}})}(jQuery),Contextly.widget.Blocks2CssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-block2 .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector=".ctx-content-block2 .ctx-link-title p",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),selector=[".ctx-content-block2 .ctx-sections-container",".ctx-content-block2 .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),selector=".ctx-content-block2",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),result}}}),function(){Contextly.widget.FloatSnippet=Contextly.createClass({extend:Contextly.widget.BaseBlocksSnippet,getWidgetStyleClass:function(){return"ctx-content-float"},getLinksLimit:function(){return this.getSettings().links_limit},getInnerLinkHTML:function(link){var inner_html="";return this.getLinkThumbnailUrl(link)&&(inner_html+="<div class='ctx-link-image'><img src='"+link.thumbnail_url+"' class='ctx-nodefs' /></div>"),inner_html+="<div class='ctx-link-title'><p class='ctx-nodefs'>"+this.getLinkIcon(link)+" "+link.title+"</p></div>"},getCustomCssCode:function(){return Contextly.widget.FloatCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},getLayoutModes:function(){return{mobile:[0,240],medium:[240,400],normal:[400,700],wide:[700]}}})}(jQuery),Contextly.widget.FloatCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-float .ctx-links-header p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector=[".ctx-content-float .ctx-link",".ctx-content-float .ctx-link-title p"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),css.links_color&&(result+=this.buildCSSRule(entry,selector[1],"color",css.links_color)),selector=[".ctx-content-float .ctx-sections-container",".ctx-content-float .ctx-section"],css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),selector=".ctx-content-float",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),result}}}),function(){Contextly.widget.Sidebar=Contextly.createClass({extend:Contextly.widget.BaseFlatLinksList,construct:function(){Contextly.widget.BaseFlatLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SIDEBAR},getWidgetStyleClass:function(){return"ctx-content-sidebar"},getWidgetHTML:function(){var html="",title=this.widget.name;title&&(html+="<div class='ctx-sb-title'><p>"+this.escape(title)+"</p></div>");var description=this.widget.description;description&&(html+="<div class='ctx-sb-description'><p>"+this.escape(description)+"</p></div>"),html+="<div class='ctx-sb-content'>"+this.getLinksHTML()+"</div>";var classes=["ctx-sidebar",this.getWidgetStyleClass(),"ctx-sidebar-"+this.widget.layout,"ctx-clearfix"];return"<div class='"+this.escape(classes.join(" "))+"'>"+html+"</div>"},getLinkATag:function(link,content){return'<a href="'+this.escape(link.native_url)+'" title="'+this.escape(link.title)+"\" class='ctx-clearfix ctx-nodefs ctx-no-images' "+this.getEventTrackingHtml(link)+">"+content+"</a>"},getLinkHTML:function(link){var html="";if(link.thumbnail_url){var image_href,image_html="<img src='"+link.thumbnail_url+"' />";image_href=link.video?this.getVideoLinkATag(link,image_html):this.getLinkATag(link,image_html),html+="<div class='ctx-sb-img'>"+image_href+"</div>"}var linkContent=link.title;link.thumbnail_url||(linkContent='<span class="ctx-icon ctx-bullet"></span>'+linkContent),this.widget.settings.display_link_dates&&link.publish_date&&(linkContent+="<br /><span class='ctx-pub-date'>"+Contextly.Utils.dateTextDiff(link.publish_date)+"</span>");var a;a=link.video?this.getVideoLinkATag(link,linkContent):this.getLinkATag(link,linkContent);var classes=["ctx-sb-text"];return link.thumbnail_url||classes.push("ctx-sb-no-thumbnail"),html+="<div class='"+classes.join(" ")+"'><p>"+a+"</p></div>",html="<div class='ctx-sb-link'><div class='ctx-sb-fotmater ctx-clearfix'>"+html+"</div></div>"},getAssetsPackageName:function(){return"widgets/sidebar/default"},getCustomCssCode:function(){return Contextly.widget.SidebarCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())},setUpResponsiveLayout:function(){if("wide"===this.widget.layout){var elements=this.getWidgetElements();this.eachElement(elements,function(element){this.setLayoutMode(element,"mobile")})}else Contextly.widget.BaseFlatLinksList.prototype.setUpResponsiveLayout.apply(this,arguments)},getLayoutModes:function(){return{mobile:[0,400],"default":[400]}},checkLayoutThresholds:function(){var elements=this.getWidgetElements();if(this.getScreenWidth()<=540)this.eachElement(elements,function(element){this.setLayoutMode(element,"mobile")});else{var modes=this.getLayoutModes();this.eachElement(elements,function(element){var width=element.parent().width();this.each(modes,function(thresholds,name){return this.sizeMatchesThresholds(width,thresholds)?(this.setLayoutMode(element,name),!1):void 0})})}},buildLayoutClass:function(mode){return"ctx-sidebar-"+mode}})}(jQuery),Contextly.widget.SidebarCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-content-sidebar .ctx-sb-title p";if(css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector=".ctx-content-sidebar .ctx-sb-description p",css.description_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.description_font_family)),css.description_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.description_font_size)),css.description_color&&(result+=this.buildCSSRule(entry,selector,"color",css.description_color)),selector=[".ctx-content-sidebar .ctx-sb-link",".ctx-content-sidebar .ctx-sb-text p"],css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_font_size&&(result+=this.buildCSSRule(entry,selector[0],"font-size",css.links_font_size)),selector=".ctx-content-sidebar .ctx-sb-text a",css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),selector=[".ctx-content-sidebar",".ctx-content-sidebar .ctx-sb-title",".ctx-content-sidebar .ctx-sb-description",".ctx-content-sidebar .ctx-sb-content"],css.line_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.line_color)),selector=".ctx-content-sidebar .ctx-sb-img",settings.display_thumbnails&&settings.images_type){var matches=settings.images_type.match(/^(?:letter|square)(\d+)/i);matches[1]&&(result+=this.buildCSSRule(entry,selector,"max-width",matches[1]+"px"))}return selector=".ctx-content-sidebar",css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),result}}}),function(){Contextly.widget.AutoSidebar=Contextly.createClass({extend:Contextly.widget.Sidebar,construct:function(){Contextly.widget.BaseLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.AUTO_SIDEBAR,this.widget.id||(this.widget.name=this.widget.settings.default_name,this.widget.description=this.widget.settings.default_description,this.widget.layout=this.widget.settings.default_layout)},getCustomCssCode:function(){return Contextly.widget.SidebarCssCustomBuilder.buildCSS("."+this.containers.getTypeClass(),this.getSettings())}})}(jQuery),function(){Contextly.widget.Siderail=Contextly.createClass({extend:Contextly.widget.BaseFlatLinksList,construct:function(){Contextly.widget.BaseFlatLinksList.apply(this,arguments),this.widget_type=Contextly.widget.types.SIDERAIL},getWidgetStyleClass:function(){return"ctx-siderail-"+this.getSettings().theme},getWidgetHTML:function(){var html="",s=this.getSettings();s.title&&(html+="<div class='ctx-sr-title'><p>"+this.escape(s.title)+"</p></div>"),html+="<div class='ctx-sr-content'>"+this.getLinksHTML()+"</div>";var classes=["ctx-siderail",this.getWidgetStyleClass()];return"<div class='"+this.escape(classes.join(" "))+"'>"+html+"</div>"},getLinkATag:function(link,content){return'<a href="'+this.escape(link.native_url)+'" title="'+this.escape(link.title)+"\" class='ctx-clearfix ctx-nodefs' "+this.getEventTrackingHtml(link)+">"+content+"</a>"},getLinkHTML:function(link,index){var link_content="";link.thumbnail_url&&(link_content="<div class='ctx-link-image'><img class='ctx-nodefs' src='"+this.escape(link.thumbnail_url)+"' /></div>");var title=link.title,icon=this.getLinkIcon(link);icon&&(title=icon+" "+title),link_content+="<div class='ctx-link-title'><p class='ctx-nodefs'>"+title+"</p></div>";var a;a=link.video?this.getVideoLinkATag(link,link_content):this.getLinkATag(link,link_content);var classes=["ctx-link","ctx-"+index];return link.thumbnail_url||classes.push("ctx-no-thumbnail"),"<div class='"+classes.join(" ")+"'>"+a+"</div>"},getHandlers:function(widgetHasData){var handlers=Contextly.widget.BaseFlatLinksList.prototype.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.attachLinksPopups=!0),handlers},getAssetsPackageName:function(){return"widgets/siderail/"+this.getSettings().theme},getCustomCssCode:function(){return Contextly.widget.SiderailCssCustomBuilder.buildCSS("."+this.getWidgetStyleClass(),this.getSettings())}})}(jQuery),function(){Contextly.widget.SiderailHSquare=Contextly.createClass({extend:Contextly.widget.Siderail,getLinksLimit:function(){return 6},buildLayoutClass:function(mode){return"ctx-siderail-"+mode},getHandlers:function(widgetHasData){var handlers=Contextly.widget.Siderail.prototype.getHandlers.apply(this,arguments);return widgetHasData&&(handlers.setUpResponsiveLayout=!0),handlers},getLayoutModes:function(){return{sec1:[0,236],sec2:[236,414],sec3:[414,592],sec4:[592,740],sec5:[740,888],sec6:[888]}}})}(jQuery),function(){Contextly.widget.SiderailHLetter=Contextly.createClass({extend:Contextly.widget.SiderailHSquare,getLayoutModes:function(){return{sec1:[0,296],sec2:[296,489],sec3:[489,712],sec4:[712,990],sec5:[990,1188],sec6:[1188]}}})}(jQuery),Contextly.widget.SiderailCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-sr-title p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector=".ctx-link",css.links_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.links_font_size)),selector=".ctx-link-title p",css.links_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.links_font_family)),css.links_color&&(result+=this.buildCSSRule(entry,selector,"color",css.links_color)),selector="",css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),result}}}),function(){Contextly.widget.StoryLineSubscribe=Contextly.createClass({extend:Contextly.widget.Base,construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_type=Contextly.widget.types.STORYLINE_SUBSCRIBE},getWidgetLogo:function(){var s=this.getSettings(),iconClasses=["ctx-subscribe-logo"];return"single-color"===s.css.logo?iconClasses.push("ctx-icon","ctx-icon-logo"):iconClasses.push("ctx-image-logo"),'<i class="'+this.escape(iconClasses.join(" "))+'"></i>'},getWidgetLabel:function(){return'<span class="ctx-subscribe-label">'+this.escape(this.getSettings().title)+"</span>"},getWidgetHTML:function(){var s=this.getSettings(),linkClasses=["ctx-subscribe-link",this.getWidgetStyleClass()];return linkClasses.push("ctx-height-"+(s.css.height||"middle")),s.css.button_shadow&&linkClasses.push("ctx-box-shadow"),s.css.text_shadow&&linkClasses.push("ctx-text-shadow"),Contextly.Browser.hasSvg()||linkClasses.push("ctx-no-svg"),'<a href="javascript:" class="'+this.escape(linkClasses.join(" "))+'"><span class="ctx-subscribe-row">'+this.getWidgetLogo()+this.getWidgetLabel()+"</span></a>"},attachStoryLineButtonHandler:function(){this.getWidgetContainers().find(".ctx-subscribe-link").click(this.proxy(this.displayStoryLinePopup,!1,!0))},displayStoryLinePopup:function(e){e.preventDefault(),Contextly.overlay.StoryLineSubscribe.open({email_confirmed:this.widget.email_confirmed,subscribe_newsletter:this.widget.settings.subscribe_newsletter,subscribe_newsletter_title:this.widget.settings.subscribe_newsletter_title})},getCustomCssCode:function(){var entry={id:"#"+this.containers.getId(),container:"."+this.containers.getTypeClass(),widget:"."+this.containers.getTypeClass()+" .ctx-subscribe-link."+this.getWidgetStyleClass()};return Contextly.widget.StorylineSubscribeCssCustomBuilder.buildCSS(entry,this.getSettings())},getWidgetStyleClass:function(){var theme=this.getSettings().theme||"transparent";return"ctx-theme-"+theme},suppressTransitions:function(){var selector,containers=this.getWidgetContainers();selector="split-button"===this.getSettings().theme?".ctx-subscribe-label, .ctx-subscribe-logo":".ctx-subscribe-link";var suppressed=containers.find(selector).addClass("ctx-no-transitions");setTimeout(function(){suppressed.removeClass("ctx-no-transitions")},1)},getAssetsPackageName:function(){return"widgets/storyline/"+this.getSettings().theme},display:function(){var widget_html=this.getWidgetHTML();this.displayHTML(widget_html),this.suppressTransitions(),this.attachHandlers(),this.broadcastWidgetDisplayed()},getHandlers:function(){var handlers=Contextly.widget.Base.prototype.getHandlers.apply(this,arguments);return handlers.attachStoryLineButtonHandler=!0,handlers}})}(jQuery),Contextly.widget.StorylineSubscribeCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",id=entry.id,container=entry.container,widget=entry.widget,isTransparent="transparent"==settings.theme,isButton="button"==settings.theme,isSplitButton="split-button"==settings.theme,isColossus="colossus"==settings.theme;if("undefined"!=typeof settings.css.alignment&&(result+=this.buildCSSRule(container,"","text-align",settings.css.alignment),result+=this.buildCSSRule(id,"","text-align",settings.css.alignment)),"undefined"!=typeof settings.css.font_family&&(result+=this.buildCSSRule(widget,"","font-family",settings.css.font_family)),"undefined"!=typeof settings.css.font_size&&(result+=this.buildCSSRule(widget,"","font-size",settings.css.font_size)),"undefined"!=typeof settings.css.text_transform&&(result+=this.buildCSSRule(widget,"","text-transform",settings.css.text_transform)),"undefined"!=typeof settings.css.text_color&&(isTransparent||isButton||isColossus?result+=this.buildCSSRule(widget,"","color",settings.css.text_color):isSplitButton&&(result+=this.buildCSSRule(widget,".ctx-subscribe-label","color",settings.css.text_color))),"undefined"!=typeof settings.css.border_radius&&(result+=this.buildCSSRule(widget,"","border-radius",settings.css.border_radius),isSplitButton&&(result+=this.buildCSSRule(widget,".ctx-subscribe-logo","border-top-left-radius",settings.css.border_radius),result+=this.buildCSSRule(widget,".ctx-subscribe-logo","border-bottom-left-radius",settings.css.border_radius),result+=this.buildCSSRule(widget,".ctx-subscribe-label","border-top-right-radius",settings.css.border_radius),result+=this.buildCSSRule(widget,".ctx-subscribe-label","border-bottom-right-radius",settings.css.border_radius))),"undefined"!=typeof settings.css.background_color)if(isTransparent)result+=this.buildCSSRule(widget,"","background-color",settings.css.background_color);else{var colors=this.generateBackgroundColors(settings.css.background_color);isButton||isColossus?(result+=this.buildCSSRule(widget,"","background-color",colors.normal),result+=this.buildCSSRule(widget,"","border-color",colors.border),result+=this.buildCSSRule(widget+":hover","","background-color",colors.hover)):isSplitButton&&(result+=this.buildCSSRule(widget,".ctx-subscribe-label","background-color",colors.normal),result+=this.buildCSSRule(widget,".ctx-subscribe-label","border-color",colors.border),result+=this.buildCSSRule(widget+":hover",".ctx-subscribe-label","background-color",colors.hover))}if(isTransparent&&"undefined"!=typeof settings.css.shadow_color&&(result+=this.buildCSSRule(widget+":hover","","color",settings.css.shadow_color),result+=this.buildCSSRule(widget+":hover","","box-shadow","0 0 3px "+settings.css.shadow_color)),isSplitButton&&("undefined"!=typeof settings.css.logo_color&&(result+=this.buildCSSRule(widget,".ctx-subscribe-logo","color",settings.css.logo_color)),"undefined"!=typeof settings.css.logo_background_color)){var logoColors=this.generateBackgroundColors(settings.css.logo_background_color);result+=this.buildCSSRule(widget,".ctx-subscribe-logo","background-color",logoColors.normal),result+=this.buildCSSRule(widget,".ctx-subscribe-logo","border-color",logoColors.border),result+=this.buildCSSRule(widget+":hover",".ctx-subscribe-logo","background-color",logoColors.hover)}return settings.css.custom_code&&(result+=settings.css.custom_code),result},generateBackgroundColors:function(original){try{var hsv=new Contextly.color.RGB(original).toHSV(),hover=hsv.brightness({delta:-10}).toRGB().toString(),border=hsv.brightness({delta:-20,max:70}).toRGB().toString();return{normal:original,hover:hover,border:border}}catch(e){return Contextly.Utils.logError("Unable to get darker color for mouse over effect and border from ",original,e),{normal:original,hover:original,border:original}}}}}),function($){Contextly.overlay.StoryLineSubscribe=Contextly.createClass({extend:Contextly.overlay.Base,statics:{open:function(options){Contextly.overlay.Base.open.call(this,null,options)},renderOverlay:function(){var init=Contextly.overlay.Base.renderOverlay.apply(this,arguments);init&&this.overlay.addClass("ctx-storyline-overlay")},isEmailConfirmed:function(){return this.options.email_confirmed},isNewsletterInputEnabled:function(){return!this.isEmailConfirmed()&&this.options.subscribe_newsletter},renderDialog:function(){var isConfirmed=this.isEmailConfirmed(),isNewsletterEnabled=this.isNewsletterInputEnabled();if(this.dialog)this.dialog.show(),this.getMessage().hide(),this.getInputRows().show(),this.getEmailInput().val(""),isNewsletterEnabled&&(this.getNewsletterCheckbox()[0].checked=!0);else{var inputs="";isConfirmed||(inputs='<div class="ctx-email-row ctx-input-row"><input type="email" class="ctx-email" placeholder="Email address" /></div>',isNewsletterEnabled&&(inputs+='<div class="ctx-newsletter-row ctx-input-row"><input class="ctx-newsletter" type="checkbox" id="ctx-storyline-subscribe-newsletter" checked="checked"> <label class="ctx-newsletter-label" for="ctx-storyline-subscribe-newsletter">'+Contextly.Utils.escape(this.options.subscribe_newsletter_title)+"</label></div>"));var classes=["ctx-overlay-dialog"];Contextly.Browser.hasSvg()||classes.push("ctx-no-svg");var content='<div id="ctx-storyline-popup" class="'+classes.join(" ")+'"><div class="ctx-header"><span class="ctx-header-title">Follow this Storyline</span></div><div class="ctx-body"><div class="ctx-message-row"></div>'+inputs+'<div class="ctx-follow-row ctx-input-row"><button class="ctx-follow"><div class="ctx-follow-label">Follow</div><div class="ctx-icon ctx-icon-hourglass"></div></button></div><div class="ctx-terms-row">Don\'t worry. We <b>don\'t</b> spam, and <b>never</b> sell or rent addresses.</div></div><div class="ctx-footer ctx-clearfix"><a class="ctx-how-link" target="_blank" href="http://contextly.com/follow-up-explained">How does this work?</a><a class="ctx-logo-link" target="_blank" href="http://contextly.com">Powered by</a></div></div>';this.dialog=$(content).appendTo("body")}},bindHandlers:function(){Contextly.overlay.Base.bindHandlers.apply(this,arguments),this.getSubmit().bind(this.ns("click"),this.proxy(this.onSubmit,!1,!0)),this.getEmailInput().bind(this.ns("keypress"),this.proxy(this.onEmailInputKeyPress,!1,!0))},unbindHandlers:function(){Contextly.overlay.Base.unbindHandlers.apply(this,arguments),this.getSubmit().unbind(this.ns("click")),this.getEmailInput().unbind(this.ns("keypress"))},destroyDialog:function(){this.dialog.hide()},onEmailInputKeyPress:function(e){13==e.which&&this.onSubmit(e)},onOpeningComplete:function(){Contextly.overlay.Base.onOpeningComplete.apply(this,arguments),this.animating||(this.isEmailConfirmed()?this.subscribeToStoryLine():this.registerButtonClick())},onSubmit:function(e){e.preventDefault();var params={};if(!this.isEmailConfirmed()){var email=$.trim(this.getEmailInput().val());if(!email||!Contextly.Utils.isEmailValid(email))return void this.errorMessage("Please enter valid email address.");params.email=email,this.isNewsletterInputEnabled()&&(params.subscribe_newsletter=this.getNewsletterCheckbox().is(":checked")?1:0)}this.subscribeToStoryLine(params)},registerButtonClick:function(){Contextly.ExperienceRESTClient.call("storylines","button-click")},subscribeToStoryLine:function(params){this.lockSubmit(),this.hideMessage(),params=params||{};var callback=this.proxy(this.onSubscribeComplete,!1,!0);this.isEmailConfirmed()?Contextly.ExperienceRESTClient.call("storylines","button-click",params,callback):Contextly.ExperienceRESTClient.call("storylines","subscribe",params,callback)},onSubscribeComplete:function(response){if(this.unlockSubmit(),response&&response.success)this.successMessage(response.confirmed?"We added this story to your FollowUp list.":"Almost done! Check your email.");else{var message="Something went wrong.";response&&response.error&&(message=response.error),this.errorMessage(message)}},lockSubmit:function(){this.getSubmit().attr("disabled","disabled").addClass("ctx-progress")},unlockSubmit:function(){this.getSubmit().removeAttr("disabled").removeClass("ctx-progress")},getMessage:function(){return this.dialog.find(".ctx-message-row")},getEmailInput:function(){return this.dialog.find(".ctx-email")},getNewsletterCheckbox:function(){return this.dialog.find(".ctx-newsletter")},getSubmit:function(){return this.dialog.find(".ctx-follow")},getInputRows:function(){return this.dialog.find(".ctx-input-row")},showMessage:function(text,className){var message=this.getMessage(),duration=this.options.duration,fadeIn=this.proxy(function(){message.removeClass("ctx-success ctx-error ctx-info").addClass(className).text(text).animate({opacity:1},duration)});message.is(":visible")?(duration/=2,message.stop(!0).animate({opacity:0},duration,fadeIn)):(message.css("opacity",0).show(),fadeIn()),this.refreshDialogSizes()},hideMessage:function(){var message=this.getMessage();message.is(":visible")&&message.stop(!0).animate({opacity:.2},this.options.duration)},errorMessage:function(message){this.showMessage(message,"ctx-error")},successMessage:function(message){this.getInputRows().hide(),this.showMessage(message,"ctx-success"),setTimeout(this.proxy(this.close),3e3)}}})}(jQuery),Contextly.widget.SocialCssCustomBuilder=Contextly.createClass({extend:Contextly.widget.CssCustomBuilder,statics:{buildCSS:function(entry,settings){var result="",css=settings.css||{};css.custom_code&&(result+=css.custom_code);var selector=".ctx-title p";return css.title_font_family&&(result+=this.buildCSSRule(entry,selector,"font-family",css.title_font_family)),css.title_font_size&&(result+=this.buildCSSRule(entry,selector,"font-size",css.title_font_size)),css.title_color&&(result+=this.buildCSSRule(entry,selector,"color",css.title_color)),selector="",css.border_color&&(result+=this.buildCSSRule(entry,selector,"border-color",css.border_color)),css.background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.background_color)),selector=".ctx-slick-arrow:before",css.arrow_foreground_color&&(result+=this.buildCSSRule(entry,selector,"color",css.arrow_foreground_color)),css.arrow_background_color&&(result+=this.buildCSSRule(entry,selector,"background-color",css.arrow_background_color)),selector=".ctx-tweet.ctx-icon-hourglass:before",css.arrow_foreground_color&&(result+=this.buildCSSRule(entry,selector,"color",css.arrow_foreground_color)),result}}}),function($){Contextly.widget.Social=Contextly.createClass({extend:[Contextly.widget.Base,Contextly.widget.TweetsRenderer,Contextly.widget.ViewHandler,Contextly.widget.ResponsiveLayout],construct:function(){Contextly.widget.Base.apply(this,arguments),this.widget_type=Contextly.widget.types.SOCIAL,this.widget_displayed=!1},hasWidgetData:function(){var links=this.getWidget().links;return links&&links.length},display:function(){this.hasWidgetData()?this.queueTweetsRendering():(this.getWidgetContainers().empty(),this.broadcastWidgetDisplayed())},onTwitterReady:function(){var widget_html=this.getWidgetHTML();this.displayHTML(widget_html),this.setUpResponsiveLayout(),this.bindTwitterEvents(),this.setUpSlick(),this.tweets_rendering_queue=new Contextly.CallbackQueue,this.tweets_rendering_queue.appendResult(this.proxy(this.onAllTweetsRendered)),this.renderTweets(this.getWidgetElements())},onAllTweetsRendered:function(){this.widget_displayed||(this.widget_displayed=!0,this.attachWidgetViewHandler(),this.attachNavigationEvents(),this.broadcastWidgetDisplayed())},getWidgetStyleClass:function(){return"ctx-social-"+this.getSettings().theme},getWidgetHTML:function(){var html="",s=this.getSettings();s.title&&(html+="<div class='ctx-title'><p>"+this.escape(s.title)+"</p></div>"),html+="<div class='ctx-content ctx-clearfix'><div class='ctx-tweets'>"+this.getLinksHTML()+"</div></div>";var classes=["ctx-social-widget",this.getWidgetStyleClass()];return"<div class='"+this.escape(classes.join(" "))+"'>"+html+"</div>"},getLinkHTML:function(link){return'<div class="ctx-tweet ctx-icon ctx-icon-hourglass" data-tweet-id="'+this.escape(link.tweet)+'" data-native-url="'+this.escape(link.native_url)+'" data-contextly-url="'+this.escape(link.url)+'"></div>'},getLinksHTML:function(){var html="";if(this.hasWidgetData())for(var links=this.getWidget().links,i=0;i<links.length;i++)html+=this.getLinkHTML(links[i]);return html},getLayoutModes:function(){return{mobile:[0,350],"1-tweet":[350,1040],"2-tweets":[1040,1510],"3-tweets":[1510,1980],wide:[1980]}},setUpSlick:function(){this.eachElement(this.getWidgetElements(),function(widgetElement){var slickElement=widgetElement.find(".ctx-tweets"),data={widgetElement:widgetElement};callback=this.proxy(this.onSlickBeforeRefresh,!1,!0),slickElement.bind(this.nsEvent("beforeRefresh"),data,callback);var callback=this.proxy(this.onSlickAfterRefresh,!1,!0);slickElement.bind(this.nsEvent("refresh"),data,callback);var slick=new Contextly.Slick(slickElement,{infinite:!0,slidesToShow:4,slidesToScroll:1,touchMove:!1,draggable:!1,centerMode:!0,centerPadding:"50px",zIndex:5,respondTo:"slider",responsive:[{breakpoint:1511,settings:{slidesToShow:3}},{breakpoint:1041,settings:{slidesToShow:2}},{breakpoint:571,settings:{slidesToShow:1}},{breakpoint:351,settings:{slidesToShow:1,centerPadding:"8px"}}]});widgetElement.data("ctxSlick",slick)})},onSlickBeforeRefresh:function(e){e.data&&e.data.widgetElement&&this.getTweetContainers(e.data.widgetElement).empty().addClass("ctx-icon ctx-icon-hourglass")},onSlickAfterRefresh:function(e){e.data&&e.data.widgetElement&&this.renderTweets(e.data.widgetElement)},buildLayoutClass:function(mode){return"ctx-social-"+mode},getAssetsPackageName:function(){return"widgets/social/carousel"
},getCustomCssCode:function(){return Contextly.widget.SocialCssCustomBuilder.buildCSS("."+this.getWidgetStyleClass(),this.getSettings())},getTweetContainers:function(widgetElements){return widgetElements.find(".ctx-tweet[data-tweet-id]")},getTweetContainer:function(frameElement){return $(frameElement).parents(".ctx-tweet:first")},onTweetTargetUrlClick:function(blockquote,e,tweetContainer){var contextlyUrl=tweetContainer.attr("data-contextly-url");return Contextly.MainServerAjaxClient.call(contextlyUrl),!1},renderTweet:function(element){element.unbind("contextlyTweetRendered").one("contextlyTweetRendered",this.proxy(function(el){var $el=$(el);$el.removeClass("ctx-icon ctx-icon-hourglass");var $iframe=$el.find("iframe.twitter-tweet"),$frameDoc=$iframe.contents(),$html=$frameDoc.find("html:first");if($html.length){var height=$html.height();height>0&&$iframe.height(height),$html.find("div.EmbeddedTweet").css("cursor","default"),$frameDoc[0].addEventListener&&$frameDoc[0].addEventListener("click",function(e){var $target=$(e.target);$target.is("a")||$target.parents("a:first").length||e.stopPropagation()},!0)}},!0)),this.tweets_rendering_queue.isComplete()||element.one("contextlyTweetRendered",this.tweets_rendering_queue.addReason()),Contextly.widget.TweetsRenderer.fn.renderTweet.apply(this,arguments)},findViewWatcherElement:function(widgetElement){return widgetElement.find(".ctx-tweets")},attachNavigationEvents:function(){this.getWidgetElements().find(".ctx-tweets").bind(this.nsEvent("beforeChange"),this.proxy(this.onSlickNavigation,!1,!0))},onSlickNavigation:function(e,slick,prev,next){var diff=Math.abs(prev-next);if(diff)if(1===diff)next>prev?this.onSlickNext():this.onSlickPrev();else if(this.hasWidgetData()){var linksNum=this.getWidget().links.length;0===prev&&next===linksNum-1?this.onSlickPrev():0===next&&prev===linksNum-1&&this.onSlickNext()}},onSlickPrev:function(){this.logEvent(Contextly.widget.eventNames.CAROUSEL_NAVIGATION,{event_direction:"previous"})},onSlickNext:function(){this.logEvent(Contextly.widget.eventNames.CAROUSEL_NAVIGATION,{event_direction:"next"})}})}(jQuery),function($){Contextly.overlay.Branding=Contextly.createClass({extend:Contextly.overlay.Base,statics:{open:function(options){Contextly.overlay.Base.open.call(this,null,options)},renderOverlay:function(){var init=Contextly.overlay.Base.renderOverlay.apply(this,arguments);init&&this.overlay.addClass("ctx-brd-overlay")},renderDialog:function(){if(this.dialog)this.dialog.show();else{var classes=["ctx-overlay-dialog"];Contextly.Browser.hasSvg()||classes.push("ctx-no-svg");var content='<div id="ctx-branding-content" class="'+Contextly.Utils.escape(classes.join(" "))+'">';content+='<div id="ctx-brd-modal">',content+='<div id="ctx-brd-logo"></div>',content+='<div id="ctx-brd-text-head"></div>',content+='<div id="ctx-brd-text"><p>Contextly recommends interesting and related stories using a unique combination of algorithms and editorial choices.<br><br>Publishers or advertisers who would like to learn more about Contextly can contact us&nbsp;<a href="http://contextly.com/sign-up/publishers/" target="_blank">here</a>.<br><br>We respect <a href="http://contextly.com/privacy/" target="_blank">readers&#8217; privacy </a>.&nbsp;</p></div>',content+="</div>",content+='<a href="javascript:" id="ctx-brd-close">X</a>',content+="</div>",this.dialog=$(content).appendTo("body")}},destroyDialog:function(){this.dialog.hide()},bindHandlers:function(){Contextly.overlay.Base.bindHandlers.apply(this,arguments),$("#ctx-brd-close").bind(this.ns("click"),this.proxy(this.close))},unbindHandlers:function(){Contextly.overlay.Base.unbindHandlers.apply(this,arguments),$("#ctx-brd-close").unbind(this.ns("click"))}}})}(jQuery),function($){Contextly.overlay.Video=Contextly.createClass({extend:Contextly.overlay.Dynamic,statics:{renderOverlay:function(){var init=Contextly.overlay.Base.renderOverlay.apply(this,arguments);init&&this.overlay.addClass("ctx-video-overlay")},getDialogHtml:function(){return'<div class="ctx-overlay-dialog ctx-video-modal"><div class="ctx-video"></div><div class="ctx-loading"></div><p class="ctx-video-title"></p><a href="#" class="ctx-video-close">&#215;</a><div class="ctx-social"></div></div>'},getFacebookLikeHtml:function(videoUrl){return'<iframe src="//www.facebook.com/plugins/like.php?href='+Contextly.Utils.escape(videoUrl)+'&amp;width=100&amp;layout=button&amp;action=like&amp;show_faces=true&amp;share=true&amp;height=20&amp;locale=en_US" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:20px;" allowTransparency="true"></iframe>'},getTweetButtonHtml:function(videoId,videoTitle){var videoIdEncoded=encodeURIComponent(videoId),videoTitleEncoded=encodeURIComponent(videoTitle);return"<iframe allowtransparency='true' frameborder='0' scrolling='no' src='//platform.twitter.com/widgets/tweet_button.html?text="+Contextly.Utils.escape(videoTitleEncoded)+"&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D"+Contextly.Utils.escape(videoIdEncoded)+"' style='width:98px; height:20px;'></iframe>"},renderContent:function(data){var videoId=Contextly.Utils.parseUrlQueryParameter("v",data.videoUrl),videoSrc="//www.youtube.com/embed/"+videoId+"?rel=1&autoplay=1";this.content=this.content||{},this.content.title=this.content.title||this.dialog.find(".ctx-video-title"),this.content.title.text(data.videoTitle);var videoHtml='<iframe src="'+Contextly.Utils.escape(videoSrc)+'" frameborder="no" class="ctx-video-frame"></iframe>';this.content.video=$(videoHtml).appendTo(this.dialog.find(".ctx-video"));var socialHtml=this.getFacebookLikeHtml(data.videoUrl)+this.getTweetButtonHtml(videoId,data.videoTitle);this.content.social=$(socialHtml).appendTo(this.dialog.find(".ctx-social"))},destroyContent:function(){this.content.title.empty(),this.content.video.remove(),this.content.social.remove(),delete this.content.video,delete this.content.social},bindHandlers:function(){Contextly.overlay.Dynamic.bindHandlers.apply(this,arguments),this.dialog.find(".ctx-video-close").bind(this.ns("click"),this.proxy(this.close))},unbindHandlers:function(){Contextly.overlay.Dynamic.unbindHandlers.apply(this,arguments),this.dialog.find(".ctx-video-close").unbind(this.ns("click"))}}})}(jQuery),function($){Contextly.PageEvents=Contextly.createClass({statics:{trackLink:function(widget_type,link_type,link_url,link_title){if(widget_type&&link_type&&link_url&&link_title){var category="Contextly",action="";action=widget_type===Contextly.widget.types.SIDEBAR?"Sidebar_":"Module_",action+=link_type==Contextly.widget.linkTypes.WEB?"External_":link_type==Contextly.widget.linkTypes.PREVIOUS||link_type==Contextly.widget.linkTypes.RECENT?"Related_":link_type==Contextly.widget.linkTypes.PROMO?"Promo_":link_type.charAt(0).toUpperCase()+link_type.slice(1)+"_";var page_type="Post",url_parts=link_url.split("?"),url_params=url_parts[1].split(":");if(url_params.length>=3){var algorithm_id=url_params[3];algorithm_id==Contextly.widget.recommendationTypes.PRODUCT?page_type="Product":algorithm_id==Contextly.widget.recommendationTypes.VIDEO&&(page_type="Video")}action+=page_type;var label_limit=30,label=link_title;label.length>label_limit&&(label=label.substr(0,label_limit));try{"undefined"!=typeof window.ga&&$.isFunction(ga)?ga("send","event",category,action,label):"undefined"!=typeof window._gaq?_gaq.push(["_trackEvent",category,action,label]):"undefined"!=typeof window.pageTracker&&pageTracker._trackEvent(category,action,label)}catch(e){Contextly.Utils.logError("Unable to track link click",e)}}}}})}(jQuery),function($){Contextly.widget.BaseContainers=Contextly.createClass({construct:function(widget){this.widget=widget},getElements:function(){return null==this.elements&&(this.elements=this.findElements()),this.elements},findElements:function(){var result=$("."+this.getClass());if(!result.length){var id=this.getId();null!=id&&(result=$("#"+id))}return result},getTypeClass:Contextly.abstractMethod(),getClass:function(){return this.getTypeClass()},getId:function(){return null}}),Contextly.widget.SnippetContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-module-container"},getId:function(){return"ctx-module"}}),Contextly.widget.SidebarContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-sidebar-container"},getClass:function(){return this.widget&&null!=this.widget.id?"ctx-sidebar-container--"+this.widget.id:this.getTypeClass()},getId:function(){return this.widget&&null!=this.widget.id?"contextly-"+this.widget.id:void 0}}),Contextly.widget.AutoSidebarContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-autosidebar-container"},getClass:function(){return this.widget&&null!=this.widget.id?"ctx-autosidebar-container--"+this.widget.id:this.getTypeClass()},getId:function(){return this.widget&&null!=this.widget.id?"contextly-"+this.widget.id:void 0}}),Contextly.widget.StoryLineSubscribeContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-subscribe-container"},getId:function(){return"ctx-sl-subscribe"}}),Contextly.widget.SiderailContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-siderail-container"}}),Contextly.widget.SocialContainers=Contextly.createClass({extend:Contextly.widget.BaseContainers,getTypeClass:function(){return"ctx-social-container"}})}(jQuery),Contextly.widget.Factory=Contextly.createClass({statics:{construct:function(){this.containers={}},getContainerClass:function(type){switch(type){case Contextly.widget.types.SIDEBAR:return Contextly.widget.SidebarContainers;case Contextly.widget.types.AUTO_SIDEBAR:return Contextly.widget.AutoSidebarContainers;case Contextly.widget.types.STORYLINE_SUBSCRIBE:return Contextly.widget.StoryLineSubscribeContainers;case Contextly.widget.types.SIDERAIL:return Contextly.widget.SiderailContainers;case Contextly.widget.types.SOCIAL:return Contextly.widget.SocialContainers;default:return Contextly.widget.SnippetContainers}},getContainer:function(type,widget){var containerClass=this.getContainerClass(type);return containerClass?new containerClass(widget):null},getWidgetClass:function(type,theme){switch(type){case Contextly.widget.types.SIDEBAR:return Contextly.widget.Sidebar;case Contextly.widget.types.AUTO_SIDEBAR:return Contextly.widget.AutoSidebar;case Contextly.widget.types.STORYLINE_SUBSCRIBE:return Contextly.widget.StoryLineSubscribe;case Contextly.widget.types.SIDERAIL:switch(theme){case Contextly.widget.sideRailStyles.H_SQUARE:return Contextly.widget.SiderailHSquare;case Contextly.widget.sideRailStyles.H_LETTER:return Contextly.widget.SiderailHLetter;default:return Contextly.widget.Siderail}case Contextly.widget.types.SOCIAL:return Contextly.widget.Social;default:switch(theme){case Contextly.widget.styles.TEXT:return Contextly.widget.TextSnippet;case Contextly.widget.styles.TABS:case Contextly.widget.styles.BLOCKS:return Contextly.widget.BlocksSnippet;case Contextly.widget.styles.BLOCKS2:return Contextly.widget.Blocks2Snippet;case Contextly.widget.styles.FLOAT:return Contextly.widget.FloatSnippet}}},getWidget:function(widget){if(!widget)return null;var widgetTheme=widget.settings.display_type||widget.settings.theme,widgetClass=this.getWidgetClass(widget.type,widgetTheme);if(!widgetClass)return null;var container=this.getContainer(widget.type,widget);return new widgetClass(widget,container)}}}),function(){Contextly.PageView=Contextly.createClass({extend:[Contextly.Proxy.prototype,Contextly.Transmitter.prototype],statics:{construct:function(){this.widgetsLoading=!1},getWidgetLoadingFlags:function(){var result={},types=Contextly.widget.types,map={load_snippet:types.SNIPPET,load_side_rail:types.SIDERAIL,load_sidebar:types.SIDEBAR,load_auto_sidebar:types.AUTO_SIDEBAR,load_storyline_subscribe:types.STORYLINE_SUBSCRIBE,load_social:types.SOCIAL};for(var flag in map){var type=map[flag];result[flag]=!!Contextly.widget.Factory.getContainer(type).getElements().length}return result},loadWidgets:function(){if(!this.widgetsLoading){this.widgetsLoading=!0;var callback=this.proxy(this.onWidgetsLoadingComplete,!1,!0),params=this.getWidgetLoadingFlags();Contextly.RESTClient.call("pagewidgets","get",params,callback)}},onWidgetsLoadingComplete:function(response){response&&response.success&&response.entry?this.onWidgetsLoadingSuccess(response):this.onWidgetsLoadingError(response)},onWidgetsLoadingSuccess:function(response){this.broadcast(Contextly.PageView.broadcastTypes.LOADED,response),Contextly.Visitor.initIds(response),this.updatePostAction(response),this.loadWidgetAssets(response)},onWidgetsLoadingError:function(response){this.widgetsLoading=!1,this.broadcast(Contextly.PageView.broadcastTypes.FAILED,response)},extractWidgetsData:function(response){var result=[];return this.each(response.entry,function(collection){Contextly.Utils.isArray(collection)&&collection.length&&this.each(collection,function(data){data&&data.type&&result.push(data)})}),result},loadWidgetAssets:function(response){var queue=new Contextly.CallbackQueue,widgets=[],widgetsData=this.extractWidgetsData(response);this.each(widgetsData,function(data){var widget=Contextly.widget.Factory.getWidget(data);widget&&(widget.loadAssets(queue),widgets.push(widget))}),queue.appendResult(this.proxy(this.displayWidgets,!1,!0),widgets),queue.check()},displayWidgets:function(widgets){this.widgetsLoading=!1,this.each(widgets,function(widget){widget.display()}),this.broadcast(Contextly.PageView.broadcastTypes.DISPLAYED,widgets)},updatePostAction:function(response){response.entry.update&&Contextly.RESTClient.call("postsimport","put")}}}),Contextly.PageView.broadcastTypes={LOADED:"contextlyWidgetsLoaded",FAILED:"contextlyWidgetsFailed",DISPLAYED:"contextlyWidgetsDisplayed"},Contextly.load=function(){Contextly.PageView.loadWidgets()}}(),Contextly.data=Contextly.data||{},function(d){d.urls={cdn:{http:"https://rest.contextly.com/kit/assets/",https:"https://rest.contextly.com/kit/assets/"},main:{dev:"//dev.contextly.com/",live:"//contextly.com/"},cp:{dev:"https://dev.contextly.com/",live:"https://contextly.com/"},api:{dev:"//devrest.contextly.com/",live:"//rest.contextly.com/"},experience:{dev:"//devexperience.contextly.com/",live:"//experience.contextly.com/"}},d.versions={kit:"3.6.1"}}(Contextly.data),Contextly.assets=Contextly.assets||{},function(a){a["widgets/sidebar/default"]={css:["widgets--sidebar--default"]},a["widgets/siderail/default"]={css:["widgets--siderail--default"]},a["widgets/siderail/h-letter"]={css:["widgets--siderail--h-letter"]},a["widgets/siderail/h-square"]={css:["widgets--siderail--h-square"]},a["widgets/snippet/blocks"]={css:["widgets--snippet--blocks"]},a["widgets/snippet/blocks2"]={css:["widgets--snippet--blocks2"]},a["widgets/snippet/default"]={css:["widgets--snippet--default"]},a["widgets/snippet/float"]={css:["widgets--snippet--float"]},a["widgets/social/carousel"]={css:["widgets--social--carousel"],js:["widgets--social--carousel"]},a["widgets/storyline/button"]={css:["widgets--storyline--button"]},a["widgets/storyline/colossus"]={css:["widgets--storyline--colossus"]},a["widgets/storyline/split-button"]={css:["widgets--storyline--split-button"]},a["widgets/storyline/transparent"]={css:["widgets--storyline--transparent"]}}(Contextly.assets);
//# sourceMappingURL=widgets--page-view.map

/* For licensing information see http://contextlysitescripts.contextly.com/kit/assets/3.6.1/licenses.txt */
!function(){Contextly.metadataParser.WHO=Contextly.createClass({extend:Contextly.metadataParser.DublinCore,statics:{getPropertiesMap:function(){var map=Contextly.metadataParser.DublinCore.getPropertiesMap.apply(this,arguments);return map.post_id=["webit_document_id"],map},dataExists:function(){return null!=this.getData("post_id")}}}),Contextly.metadataFormats={},Contextly.metadataFormats.WHO=Contextly.metadataParser.WHO}(jQuery),function(){Contextly.WHOSettings=Contextly.createClass({extend:Contextly.BaseSettings,statics:{detectWhoLanguage:function(){var matches=/\/([a-z]{2})(?:\/[^\/]*)?$/i.exec(document.location.pathname);return!matches||matches.length<2?"en":matches[1]},getAppId:function(){if(null==this.whoAppId){var lang=this.detectWhoLanguage();this.whoAppId="who_"+lang}return this.whoAppId}}}),Contextly.Settings=Contextly.WHOSettings}();
//# sourceMappingURL=mods--who.map
