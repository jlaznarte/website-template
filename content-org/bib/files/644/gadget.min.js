(function(){var a=function(){this.key="616daef638f56a44b3cc9fdccbd4386f";this.newsSources={};this.issns={"01406736":true,"14702045":true,"14733099":true,"02779536":true,"07475632":true,"01956663":true,"03069877":true,"00283932":true,"1356689X":true,"00039993":true,"01960644":true,"1054139X":true,"07493797":true,"00221031":true,"03601315":true,"03009572":true,"09209964":true,"00029343":true,"00150282":true,"03014215":true,"00928674":true,"08966273":true,"09609822":true,"01695347":true,"13646613":true,"2214109X":true};this.group=this.getGroup();this.barGroup=1;this.donutGroup=0;this.showHighlights=true;this.showSharing=true};a.prototype.getGroup=function(){var c=/\baltmetric_group=([^;]+)\b/.exec(document.cookie),b;if(c){b=parseInt(c[1],10)}else{b=(Math.floor(Math.random()*10)%2)+1;document.cookie="altmetric_group="+b}return b};a.prototype.fetch=function(b,c){gadgets.sciverse.makeRequest("http://api.altmetric.com/v1/fetch/doi/"+b+"?include_sources=news&include_sections=counts,images,posts,altmetric_score,citation&key="+this.key,c,{CONTENT_TYPE:"JSON"})};a.prototype.getNewsSources=function(b){gadgets.io.makeRequest("http://assets.altmetric.com/javascript/top_news_sources.json",function(c){if(c.errors.length===0){var e,d={},f=c.data.news_sources.length;for(e=0;e<f;e+=1){d[c.data.news_sources[e]]=true}b(d)}},{CONTENT_TYPE:"JSON"})};a.prototype.getSources=function(b){gadgets.io.makeRequest("http://assets.altmetric.com/javascript/sources.json",function(c){if(c.errors.length===0){var e,g,d={},f=c.data.sources.length;for(e=0;e<f;e+=1){g=c.data.sources[e];d[g.fetch_api_key]={template:g.legend_text,color:g.dark_colour,label:g.tab_label,position:g.position};if(g.fetch_api_key==="news"){d[g.fetch_api_key].label="news sources"}if(g.fetch_api_key==="blogs"){d[g.fetch_api_key].label="blogs"}}b(d)}},{CONTENT_TYPE:"JSON"})};a.prototype.render=function(d,b){var c=this;if(this.group===this.barGroup){b.className="bar_group"}else{b.className="donut_group"}this.renderTitle(b);this.renderDonut(d,b);this.renderSources(d,b);this.getNewsSources(function(e){c.newsSources=e;c.renderHighlights(d,b);if(c.showSharing){c.renderSharingButtons(d,b,false)}c.trackLinks();gadgets.window.adjustHeight(1);setTimeout(gadgets.window.adjustHeight,1)});gadgets.sciverse.makeMeVisible()};a.prototype.renderTitle=function(c){var b=document.createElement("div");b.id="title_panel";b.innerHTML="Article level metrics";c.appendChild(b)};a.prototype.renderSharingButtons=function(h,c,g){var b=document.createElement("div"),d=[],f="",e;b.id="share_panel";if(h.citation.hasOwnProperty("doi")){e=encodeURIComponent("http://dx.doi.org/"+h.citation.doi)}else{if(h.citation.hasOwnProperty("links")){e=encodeURIComponent(h.citation.links[0])}}if(e!==undefined){if(h.citation.hasOwnProperty("title")){f=encodeURIComponent(h.citation.title)}d.push("<div class='share_button'><a data-label='twitter_share' target='_new' href='https://twitter.com/intent/tweet?related=elsevierconnect,sciencedirect,altmetric&text="+f+"&url="+e+"'><img src='http://assets.altmetric.com/images/social/twitter.png'/> Twitter</a></div>");d.push("<div class='share_button'><a data-label='facebook_share' target='_new' href='https://www.facebook.com/sharer/sharer.php?u="+e+"'><img src='http://assets.altmetric.com/images/social/facebook.png'/> Facebook</a></div>");d.push("<div class='share_button'><a data-label='googleplus_share' target='_new' href='https://plus.google.com/share?url="+e+"'><img src='http://assets.altmetric.com/images/social/googleplus.png'/> Google+</a></div>");if(g){b.className="stacked"}else{b.className="line"}b.innerHTML="<div id='share_panel_label'>Share this article</div><div id='share_buttons_set'>"+d.join("")+"</div>";c.appendChild(b)}};a.prototype.renderDonut=function(e,b){var f=document.createElement("img"),d=document.createElement("a"),c=document.createElement("span");f.src=e.images.small;f.width=64;f.height=f.width;f.id="donut-image";if(this.group===this.barGroup){f.src=e.images.medium;f.id="bar-image";if(/style=(\w+)/.test(f.src)){f.src=f.src.replace(/style=(\w+)/,"style=bar")}else{f.src=f.src+"&style=bar"}f.width=80;f.height=18;f.align="top"}d.href="#";d.id="donut-canvas-link";d.className="clearfix";d.setAttribute("data-label","Details page for "+e.citation.doi);d.appendChild(f);if(this.group===this.barGroup){c.innerHTML=Math.ceil(e.altmetric_score.score);c.id="donut-score";d.appendChild(c)}a.click(d,function(g){if(g&&g.preventDefault){g.preventDefault()}gadgets.views.requestNavigateTo(new gadgets.views.View("canvas"),{doi:e.citation.doi},"")});b.appendChild(d)};a.prototype.ordinalize=function(f){var d=f.toString(),e=d.slice(-1),c=d.slice(-2),b="";switch(e){case"1":b=c==="11"?"th":"st";break;case"2":b=c==="12"?"th":"nd";break;case"3":b=c==="13"?"th":"rd";break;default:b="th";break}return d+b};a.prototype.random=function(b){return b[Math.floor(Math.random()*b.length)]};a.prototype.findHighlights=function(h,f,e,b,d){var i,g,c;if(f.hasOwnProperty(e)){i=f[e].rank;g=f[e].total_number_of_other_articles;c=f[e].percentile;if(i===1){h.push("This is the <b>highest scoring article</b> "+b)}else{if(i<=10){h.push("This is the <b>"+this.ordinalize(i)+" highest scoring article</b> "+b)}}if(g>50){if(c>=90){h.push('In terms of the <a target="_new" href="http://support.altmetric.com/knowledgebase/articles/84649-about-altmetric-and-the-altmetric-score">Altmetric score</a> this article <b>has done particularly well</b>, scoring higher than '+c+"% of "+d)}else{if(c>=75){h.push('In terms of the <a target="_new" href="http://support.altmetric.com/knowledgebase/articles/84649-about-altmetric-and-the-altmetric-score">Altmetric score</a> this article <b>has done well</b>, scoring higher than '+c+"% of "+d)}else{if(c>=50){h.push('In terms of the <a target="_new" href="http://support.altmetric.com/knowledgebase/articles/84649-about-altmetric-and-the-altmetric-score">Altmetric score</a> this article <b>has gotten more attention than average</b>, scoring higher than '+c+"% of "+d)}}}}}};a.prototype.renderSources=function(f,c){var e=this,d,b=document.createElement("div");if(this.group===this.barGroup){b.className="bar_panel"}else{b.className="donut_panel"}this.getSources(function(g){var l=0,k=[],i="",h,j;b.id="panel";for(h in f.counts){if(f.counts.hasOwnProperty(h)&&h!=="total"){j=g[h];if(j&&j.label){k.push([f.counts[h].posts_count,j.label])}}}l=k.length;k.sort(function(n,m){return m[0]-n[0]});for(d=0;d<l;d+=1){if(d>0){if(d===l-1){i=i+" and "}else{if(l>1){i=i+", "}}}i=i+k[d][1]}b.innerHTML="<p>This article has gotten attention from "+i+". </p>";e.renderCanvasLink(f,b.firstChild);e.trackLinks();gadgets.window.adjustHeight(1);setTimeout(gadgets.window.adjustHeight,1)});c.appendChild(b)};a.prototype.renderHighlights=function(e,b){var d,h=[],f,k,c,g=[],j="This article was covered by ";if((e.altmetric_score.hasOwnProperty("context_for_score"))&&(e.counts.total.posts_count>3)){this.findHighlights(h,e.altmetric_score.context_for_score,"this_journal","in this journal that we have seen so far.","other articles in this journal.");this.findHighlights(h,e.altmetric_score.context_for_score,"similar_age_this_journal_3m","compared to other articles published in this journal and in the same time period.","articles from the same journal published in the same time period.");this.findHighlights(h,e.altmetric_score.context_for_score,"all","ever tracked by Altmetric.","other articles ever tracked by Altmetric.")}if(e.posts.hasOwnProperty("news")){c=e.posts.news.length;for(f=0;f<c;f+=1){k=e.posts.news[f];if(k.hasOwnProperty("author")&&this.newsSources.hasOwnProperty(k.author.name)){g.push('<a target="_blank" href="'+k.url+'">'+k.author.name+"</a>")}}if(g.length>=5){g=g.slice(0,4)}if(g.length>=1){for(f=0;f<g.length;f+=1){j+=g[f];if(f<(g.length-2)){j+=", "}else{if(f<(g.length-1)){j+=" and "}}}if(g.length<e.posts.news.length){j+=", amongst other outlets."}else{j+="."}h=[j]}}if(h.length){d=document.createElement("p");if(this.group===this.barGroup){d.className="bar_panel"}d.id="highlight";d.innerHTML=this.random(h);if(this.showHighlights){b.appendChild(d)}}};a.prototype.trackLinks=function(){var d,c=this,b=document.getElementsByTagName("a"),e=b.length,f=function(g){return function(){var i,j,h;if(g.hasAttribute("data-category")){i=g.getAttribute("data-category")}else{i="Group "+c.group}if(g.hasAttribute("data-action")){j=g.getAttribute("data-action")}else{j="Click"}if(g.hasAttribute("data-label")){h=g.getAttribute("data-label")}else{h=g.href}window._gaq.push(["_trackEvent",i,j,h])}};for(d=0;d<e;d+=1){a.click(b[d],f(b[d]))}};a.prototype.renderFooter=function(b){var c=document.createElement("div");c.innerHTML='<p class="footer">This app is provided by <a target="_blank" href="http://www.altmetric.com">Altmetric</a>. <a target="_blank" href="http://support.altmetric.com/knowledgebase/articles/237840-altmetric-for-sciencedirect">Learn more here</a>.</p>';b.appendChild(c.firstChild)};a.click=function(b,d){var c;if(b.addEventListener){b.addEventListener("click",d,false)}else{if(b.attachEvent){b.attachEvent("onclick",d)}else{if(b.onclick){c=b.onclick;b.onclick=function(){c();d()}}else{b.onclick=d}}}};a.prototype.renderCanvasLink=function(d,b){var c=document.createElement("span");c.innerHTML='<a href="#" data-label="Details page for '+d.citation.doi+'" id="canvas-link">Click for more details.</a>';a.click(c.firstChild,function(f){if(f&&f.preventDefault){f.preventDefault()}gadgets.views.requestNavigateTo(new gadgets.views.View("canvas"),{doi:d.citation.doi},"")});b.appendChild(c)};(function(){var b=document.createElement("link");b.href="http://assets.altmetric.com/widgets/sciencedirect/gadget.min.css?v=1";b.rel="stylesheet";document.documentElement.firstChild.appendChild(b)}());window._gaq=[["_setAccount","UA-54928-23"],["_trackPageview"]];(function(){var c=document.createElement("script"),b=document.getElementsByTagName("script")[0];c.type="text/javascript";c.async=true;c.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";b.parentNode.insertBefore(c,b)}());gadgets.sciverse.getContextInfo(function(c){var b=new a();if(b.issns.hasOwnProperty(c.issn)){b.fetch(c.doi,function(d){var e=document.getElementById("profile");if(d.errors.length===0){b.render(d.data,e)}})}})}());
